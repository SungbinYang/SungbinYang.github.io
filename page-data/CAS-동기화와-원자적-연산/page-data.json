{
    "componentChunkName": "component---src-template-post-tsx",
    "path": "/CAS-동기화와-원자적-연산/",
    "result": {"data":{"allMarkdownRemark":{"nodes":[{"fields":{"slug":"/책임-할당하기/"},"timeToRead":8,"frontmatter":{"title":"[오브젝트] 책임 할당하기","series":"오브젝트"}},{"fields":{"slug":"/객체지향-기본-원칙/"},"timeToRead":4,"frontmatter":{"title":"[오브젝트] 객체지향 기본 원칙","series":"오브젝트"}},{"fields":{"slug":"/절차적인-설계-개선하기/"},"timeToRead":7,"frontmatter":{"title":"[오브젝트] 절차적인 설계 개선하기","series":"오브젝트"}},{"fields":{"slug":"/영화-예매-도메인/"},"timeToRead":2,"frontmatter":{"title":"[오브젝트] 영화 예매 도메인","series":"오브젝트"}},{"fields":{"slug":"/자바18부터-자바21까지/"},"timeToRead":19,"frontmatter":{"title":"[모던 자바] 자바18부터 자바21까지","series":"모던 자바"}},{"fields":{"slug":"/자바12부터-자바17까지/"},"timeToRead":17,"frontmatter":{"title":"[모던 자바] 자바12부터 자바17까지","series":"모던 자바"}},{"fields":{"slug":"/자바9-자바10-자바11/"},"timeToRead":29,"frontmatter":{"title":"[모던 자바] 자바9, 자바10, 자바11","series":"모던 자바"}},{"fields":{"slug":"/함수형-프로그래밍/"},"timeToRead":10,"frontmatter":{"title":"[자바 고급3] 함수형 프로그래밍","series":"자바 고급3"}},{"fields":{"slug":"/병렬-스트림/"},"timeToRead":25,"frontmatter":{"title":"[자바 고급3] 병렬 스트림","series":"자바 고급3"}},{"fields":{"slug":"/디폴트-메서드/"},"timeToRead":6,"frontmatter":{"title":"[자바 고급3] 디폴트 메서드","series":"자바 고급3"}},{"fields":{"slug":"/Optional/"},"timeToRead":17,"frontmatter":{"title":"[자바 고급3] Optional","series":"자바 고급3"}},{"fields":{"slug":"/스트림API3-컬렉터/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급3] 스트림 API3 - 컬렉터","series":"자바 고급3"}},{"fields":{"slug":"/스트림API2-기능/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급3] 스트림 API2 - 기능","series":"자바 고급3"}},{"fields":{"slug":"/스트림API1-기본/"},"timeToRead":10,"frontmatter":{"title":"[자바 고급3] 스트림 API1 - 기본","series":"자바 고급3"}},{"fields":{"slug":"/메서드-참조/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급3] 메서드 참조","series":"자바 고급3"}},{"fields":{"slug":"/람다-vs-익명-클래스/"},"timeToRead":4,"frontmatter":{"title":"[자바 고급3] 람다 vs 익명 클래스","series":"자바 고급3"}},{"fields":{"slug":"/람다-활용/"},"timeToRead":18,"frontmatter":{"title":"[자바 고급3] 람다 활용","series":"자바 고급3"}},{"fields":{"slug":"/함수형-인터페이스/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급3] 함수형 인터페이스","series":"자바 고급3"}},{"fields":{"slug":"/람다/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급3] 람다","series":"자바 고급3"}},{"fields":{"slug":"/람다가-필요한-이유/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급3] 람다가 필요한 이유","series":"자바 고급3"}},{"fields":{"slug":"/HTTP-서버-활용/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급2] HTTP 서버 활용","series":"자바 고급2"}},{"fields":{"slug":"/애노테이션/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급2] 애노테이션","series":"자바 고급2"}},{"fields":{"slug":"/리플렉션/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급2] 리플렉션","series":"자바 고급2"}},{"fields":{"slug":"/HTTP-서버-만들기/"},"timeToRead":25,"frontmatter":{"title":"[자바 고급2] HTTP 서버 만들기","series":"자바 고급2"}},{"fields":{"slug":"/HTTP-기본-이론/"},"timeToRead":5,"frontmatter":{"title":"[자바 고급2] HTTP 기본 이론","series":"자바 고급2"}},{"fields":{"slug":"/채팅-프로그램/"},"timeToRead":21,"frontmatter":{"title":"[자바 고급2] 채팅 프로그램","series":"자바 고급2"}},{"fields":{"slug":"/네트워크-프로그램2/"},"timeToRead":16,"frontmatter":{"title":"[자바 고급2] 네트워크 프로그램2","series":"자바 고급2"}},{"fields":{"slug":"/네트워크-프로그램1/"},"timeToRead":18,"frontmatter":{"title":"[자바 고급2] 네트워크 프로그램1","series":"자바 고급2"}},{"fields":{"slug":"/네트워크-기본-이론/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급2] 네트워크 - 기본 이론","series":"자바 고급2"}},{"fields":{"slug":"/File-Files/"},"timeToRead":8,"frontmatter":{"title":"[자바 고급2] File, Files","series":"자바 고급2"}},{"fields":{"slug":"/IO-활용/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급2] I/O 활용","series":"자바 고급2"}},{"fields":{"slug":"/IO-기본2/"},"timeToRead":6,"frontmatter":{"title":"[자바 고급2] I/O 기본2","series":"자바 고급2"}},{"fields":{"slug":"/IO-기본1/"},"timeToRead":15,"frontmatter":{"title":"[자바 고급2] I/O 기본1","series":"자바 고급2"}},{"fields":{"slug":"/문자-인코딩/"},"timeToRead":10,"frontmatter":{"title":"[자바 고급2] 문자 인코딩","series":"자바 고급2"}},{"fields":{"slug":"/스레드-풀과-Executor-프레임워크2/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] 스레드 풀과 Executor 프레임워크2","series":"자바 고급1"}},{"fields":{"slug":"/스레드-풀과-Executor-프레임워크1/"},"timeToRead":20,"frontmatter":{"title":"[자바 고급1] 스레드 풀과 Executor 프레임워크1","series":"자바 고급1"}},{"fields":{"slug":"/동시성-컬렉션/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급1] 동시성 컬렉션","series":"자바 고급1"}},{"fields":{"slug":"/CAS-동기화와-원자적-연산/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] CAS - 동기화와 원자적 연산","series":"자바 고급1"}},{"fields":{"slug":"/생산자-소비자-문제2/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급1] 생산자 소비자 문제2","series":"자바 고급1"}},{"fields":{"slug":"/생산자-소비자-문제1/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] 생산자 소비자 문제1","series":"자바 고급1"}},{"fields":{"slug":"/고급-동기화-concurrent-Lock/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급1] 고급 동기화 - concurrent.Lock","series":"자바 고급1"}},{"fields":{"slug":"/동기화-synchronized/"},"timeToRead":7,"frontmatter":{"title":"[자바 고급1] 동기화 - synchronized","series":"자바 고급1"}},{"fields":{"slug":"/메모리-가시성/"},"timeToRead":5,"frontmatter":{"title":"[자바 고급1] 메모리 가시성","series":"자바 고급1"}},{"fields":{"slug":"/스레드-제어와-생명주기2/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급1] 스레드 제어와 생명주기2","series":"자바 고급1"}},{"fields":{"slug":"/스레드-제어와-생명주기1/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급1] 스레드 제어와 생명주기1","series":"자바 고급1"}},{"fields":{"slug":"/스레드-생성과-실행/"},"timeToRead":8,"frontmatter":{"title":"[자바 고급1] 스레드 생성과 실행","series":"자바 고급1"}},{"fields":{"slug":"/프로세스와-스레드-소개/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급1] 프로세스와 스레드 소개","series":"자바 고급1"}},{"fields":{"slug":"/컬렉션-프레임워크-순회-정렬-전체-정리/"},"timeToRead":16,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - 순회, 정렬, 전체 정리","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-Map-Stack-Queue/"},"timeToRead":7,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - Map, Stack, Queue","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-Set/"},"timeToRead":6,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - Set","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-HashSet/"},"timeToRead":11,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - HashSet","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-Hash/"},"timeToRead":6,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - Hash","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-List/"},"timeToRead":17,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - List","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-LinkedList/"},"timeToRead":14,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - LinkedList","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-ArrayList/"},"timeToRead":15,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - ArrayList","series":"자바 중급2"}},{"fields":{"slug":"/제네릭2/"},"timeToRead":14,"frontmatter":{"title":"[자바 중급2] 제네릭2","series":"자바 중급2"}},{"fields":{"slug":"/제네릭1/"},"timeToRead":9,"frontmatter":{"title":"[자바 중급2] 제네릭1","series":"자바 중급2"}},{"fields":{"slug":"/예외처리2-실습/"},"timeToRead":17,"frontmatter":{"title":"[자바 중급1] 예외처리2 - 실습","series":"자바 중급1"}},{"fields":{"slug":"/예외처리1-이론/"},"timeToRead":12,"frontmatter":{"title":"[자바 중급1] 예외처리1 - 이론","series":"자바 중급1"}},{"fields":{"slug":"/중첩-클래스-내부-클래스2/"},"timeToRead":9,"frontmatter":{"title":"[자바 중급1] 중첩 클래스, 내부 클래스2","series":"자바 중급1"}},{"fields":{"slug":"/중첩-클래스-내부-클래스1/"},"timeToRead":11,"frontmatter":{"title":"[자바 중급1] 중첩 클래스, 내부 클래스1","series":"자바 중급1"}},{"fields":{"slug":"/날짜와-시간/"},"timeToRead":24,"frontmatter":{"title":"[자바 중급1] 날짜와 시간","series":"자바 중급1"}},{"fields":{"slug":"/열거형-enum/"},"timeToRead":7,"frontmatter":{"title":"[자바 중급1] 열거형-enum","series":"자바 중급1"}},{"fields":{"slug":"/래퍼-Class-클래스/"},"timeToRead":11,"frontmatter":{"title":"[자바 중급1] 래퍼, Class 클래스","series":"자바 중급1"}},{"fields":{"slug":"/String-클래스/"},"timeToRead":10,"frontmatter":{"title":"[자바 중급1] String 클래스","series":"자바 중급1"}},{"fields":{"slug":"/불변-객체/"},"timeToRead":7,"frontmatter":{"title":"[자바 중급1] 불변 객체","series":"자바 중급1"}},{"fields":{"slug":"/Object-클래스/"},"timeToRead":10,"frontmatter":{"title":"[자바 중급1] Object 클래스","series":"자바 중급1"}},{"fields":{"slug":"/다형성과-설계/"},"timeToRead":5,"frontmatter":{"title":"[자바 기본] 다형성과 설계","series":"자바 기본"}},{"fields":{"slug":"/다형성2/"},"timeToRead":10,"frontmatter":{"title":"[자바 기본] 다형성2","series":"자바 기본"}},{"fields":{"slug":"/다형성1/"},"timeToRead":8,"frontmatter":{"title":"[자바 기본] 다형성1","series":"자바 기본"}},{"fields":{"slug":"/상속/"},"timeToRead":7,"frontmatter":{"title":"[자바 기본] 상속","series":"자바 기본"}},{"fields":{"slug":"/final/"},"timeToRead":4,"frontmatter":{"title":"[자바 기본] final","series":"자바 기본"}},{"fields":{"slug":"/자바-메모리-구조와-static/"},"timeToRead":10,"frontmatter":{"title":"[자바 기본] 자바 메모리 구조와 static","series":"자바 기본"}},{"fields":{"slug":"/접근-제어자/"},"timeToRead":5,"frontmatter":{"title":"[자바 기본] 접근 제어자","series":"자바 기본"}},{"fields":{"slug":"/패키지/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 패키지","series":"자바 기본"}},{"fields":{"slug":"/생성자/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 생성자","series":"자바 기본"}},{"fields":{"slug":"/객체-지향-프로그래밍/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 객체 지향 프로그래밍","series":"자바 기본"}},{"fields":{"slug":"/기본형과-참조형/"},"timeToRead":8,"frontmatter":{"title":"[자바 기본] 기본형과 참조형","series":"자바 기본"}},{"fields":{"slug":"/클래스와-데이터/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 클래스와 데이터","series":"자바 기본"}},{"fields":{"slug":"/99클럽-day10/"},"timeToRead":2,"frontmatter":{"title":"[99클럽] 면접반 10일차","series":"면접"}},{"fields":{"slug":"/99클럽-day9/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 9일차","series":"면접"}},{"fields":{"slug":"/메서드/"},"timeToRead":8,"frontmatter":{"title":"[자바 입문] 메서드","series":"자바 입문"}},{"fields":{"slug":"/배열/"},"timeToRead":7,"frontmatter":{"title":"[자바 입문] 배열","series":"자바 입문"}},{"fields":{"slug":"/훈련/"},"timeToRead":3,"frontmatter":{"title":"[자바 입문] 훈련","series":"자바 입문"}},{"fields":{"slug":"/스코프-형변환/"},"timeToRead":5,"frontmatter":{"title":"[자바 입문] 스코프, 형변환","series":"자바 입문"}},{"fields":{"slug":"/반복문/"},"timeToRead":6,"frontmatter":{"title":"[자바 입문] 반복문","series":"자바 입문"}},{"fields":{"slug":"/조건문/"},"timeToRead":7,"frontmatter":{"title":"[자바 입문] 조건문","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day8/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 8일차","series":"면접"}},{"fields":{"slug":"/책-관리-예제-백엔드-개발/"},"timeToRead":6,"frontmatter":{"title":"[스프링 입문] 책 관리 예제 - 백엔드 개발","series":"스프링"}},{"fields":{"slug":"/연산자/"},"timeToRead":6,"frontmatter":{"title":"[자바 입문] 연산자","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day7/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 7일차","series":"면접"}},{"fields":{"slug":"/변수/"},"timeToRead":8,"frontmatter":{"title":"[자바 입문] 변수","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day6/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 6일차","series":"면접"}},{"fields":{"slug":"/스프링-웹-개발-기초/"},"timeToRead":2,"frontmatter":{"title":"[스프링 입문] 스프링 웹 개발 기초","series":"스프링"}},{"fields":{"slug":"/프로젝트-환경설정/"},"timeToRead":5,"frontmatter":{"title":"[스프링 입문] 프로젝트 환경 설정","series":"스프링"}},{"fields":{"slug":"/Hello-World/"},"timeToRead":6,"frontmatter":{"title":"[자바 입문] Hello World","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day5/"},"timeToRead":2,"frontmatter":{"title":"[99클럽] 면접반 5일차","series":"면접"}},{"fields":{"slug":"/99클럽-day4/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 4일차","series":"면접"}},{"fields":{"slug":"/Multi-Modules-프로젝트/"},"timeToRead":12,"frontmatter":{"title":"[Gradle] Multi Modules 프로젝트","series":"gradle"}},{"fields":{"slug":"/99클럽-day3/"},"timeToRead":3,"frontmatter":{"title":"[99클럽] 면접반 3일차","series":"면접"}},{"fields":{"slug":"/Core-Type에-대한-이해/"},"timeToRead":7,"frontmatter":{"title":"[Gradle] Core Type에 대한 이해","series":"gradle"}},{"fields":{"slug":"/99클럽-day2/"},"timeToRead":2,"frontmatter":{"title":"[99클럽] 면접반 2일차","series":"면접"}},{"fields":{"slug":"/Groovy-언어의-기본/"},"timeToRead":8,"frontmatter":{"title":"[Gradle] Groovy 언어의 기본","series":"gradle"}},{"fields":{"slug":"/99클럽-day1/"},"timeToRead":6,"frontmatter":{"title":"[99클럽] 면접반 1일차","series":"면접"}},{"fields":{"slug":"/Gradle-기본/"},"timeToRead":9,"frontmatter":{"title":"[Gradle] Gradle 기본","series":"gradle"}},{"fields":{"slug":"/중요한-것은-포기하지-않는-마음/"},"timeToRead":3,"frontmatter":{"title":"2025년 1분기 회고(feat. 중요한 것은 포기하지 않는 마음)","series":"일상 이야기"}},{"fields":{"slug":"/Gradle-Introduction/"},"timeToRead":4,"frontmatter":{"title":"[Gradle] Introduction","series":"gradle"}},{"fields":{"slug":"/IntelliJ-플러그인/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 플러그인","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-Git-Github/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ IDEA] Git & Github","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-디버깅/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ IDEA] 디버깅","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-리팩토링/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 리팩토링","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-자동완성/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 자동완성","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-검색/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 검색","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-포커스/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 포커스","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-코드-Edit/"},"timeToRead":4,"frontmatter":{"title":"[IntelliJ IDEA] 코드 Edit","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-소개/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 소개","series":"인텔리제이"}},{"fields":{"slug":"/2024년-주니어-개발자-회고록/"},"timeToRead":3,"frontmatter":{"title":"2024년 주니어 개발자 회고록","series":"일상 이야기"}},{"fields":{"slug":"/WDD/"},"timeToRead":1,"frontmatter":{"title":"WDD(Why-Driven-Development)","series":"생각정리"}},{"fields":{"slug":"/내가-개발자-커리어를-시작한-이유/"},"timeToRead":4,"frontmatter":{"title":"내가 개발자 커리어를 시작한 이유","series":"일상"}},{"fields":{"slug":"/블로그-이관-및-회고/"},"timeToRead":3,"frontmatter":{"title":"블로그 이관 및 회고","series":"일상 이야기"}},{"fields":{"slug":"/Spring-Boot-3.2.x-더-이상-바이트코드를-구문-분석하여-매개변수-이름을-추론하려고-시도하지-않습니다/"},"timeToRead":3,"frontmatter":{"title":"Spring Boot 3.2.x 더 이상 바이트코드를 구문 분석하여 매개변수 이름을 추론하려고 시도하지 않습니다.","series":"트러블 슈팅"}},{"fields":{"slug":"/라떼-개발자/"},"timeToRead":2,"frontmatter":{"title":"라떼 개발자","series":"생각정리"}},{"fields":{"slug":"/2023년-주니어-개발자-회고록/"},"timeToRead":5,"frontmatter":{"title":"2023년 주니어 개발자 회고록","series":"일상 이야기"}}],"group":[{"fieldValue":"gradle","totalCount":5},{"fieldValue":"면접","totalCount":10},{"fieldValue":"모던 자바","totalCount":3},{"fieldValue":"생각정리","totalCount":2},{"fieldValue":"스프링","totalCount":3},{"fieldValue":"오브젝트","totalCount":4},{"fieldValue":"인텔리제이","totalCount":9},{"fieldValue":"일상","totalCount":1},{"fieldValue":"일상 이야기","totalCount":4},{"fieldValue":"자바 고급1","totalCount":13},{"fieldValue":"자바 고급2","totalCount":14},{"fieldValue":"자바 고급3","totalCount":13},{"fieldValue":"자바 기본","totalCount":12},{"fieldValue":"자바 입문","totalCount":9},{"fieldValue":"자바 중급1","totalCount":10},{"fieldValue":"자바 중급2","totalCount":10},{"fieldValue":"트러블 슈팅","totalCount":1}]},"markdownRemark":{"id":"a72a48fa-4f6c-5e8b-8dba-0f54fb54a334","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApUlEQVQoz6WRPQvCQAyG+///R6GKm6AndhIcrNaiXVzEaqVaPym9Xs67XuIgiEvFw2whPDxJXof+KOf7uD4cUWtLGJGIHpMA2PDdWpgBqRyNOfMVkTHmV/ilSW7QjfPF+hRnpVC1hVkb3Nxla54NVpczVw1bN8Co9TbJw7QIdsX+Wtk9DHklXU+3O6bXl66HIG1gIQTzIVrCNJSzCJWyzLnp0A/4CfW+SjF6WKSqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"배너 이미지\"\n        title=\"배너 이미지\"\n        src=\"/static/3189e9c0404650ccc6c5ffc998bc8717/2bef9/banner.png\"\n        srcset=\"/static/3189e9c0404650ccc6c5ffc998bc8717/6f3f2/banner.png 256w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/01e7c/banner.png 512w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/2bef9/banner.png 1024w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/71c1d/banner.png 1536w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/e8950/banner.png 2000w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>해당 블로그 글은 <a href=\"https://inf.run/6oSgn\">영한님의 인프런 강의</a>를 바탕으로 쓰여진 글입니다.</p>\n</blockquote>\n<h2>원자적 연산 - 소개</h2>\n<p>컴퓨터 과학에서 사용하는 <strong>원자적 연산</strong>의 의미는 해당 연산이 더 이상 나눌 수 없는 단위로 수행된다는 것을 의미한다. 즉, 원자적 연산은 중단되지 않고, 다른 연산과 간섭 없이 완전히 실행되거나 전혀 실행되지 않는 성질을 가지고 있다. 쉽게 이야기해서 멀티스레드 상황에서 다른 스레드의 간섭 없이 안전하게 처리되는 연산이라는 뜻이다.</p>\n<p>예를 들어 <code>int i = 1;</code>이라는 코드가 대표적인 원자적 연산이다. 그냥 변수에 대입만 하면 되기 때문에 여러 스레드가 와도 값이 안전하여 스레드 세이프하다. 하지만 아래와 같은 연산은 원자적 연산이 아니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\">i <span class=\"token operator\">=</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\ni<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>위의 두 코드는 서로 같은 코드이며 원리는 다음과 같다.</p>\n<ul>\n<li>변수 i의 값을 읽는다.</li>\n<li>읽은 변수 i 값에 1을 더한다.</li>\n<li>더한 값을 다시 i에 대입힌다.</li>\n</ul>\n<p>만약 이 과정은 여러 단계가 포함되어 있다. 즉, 해당 연산 과정에서 여러 스레드가 동시에 접근하면 이상한 값이 나올 확률이 있다. 즉, 스레드 세이프하지 않다.</p>\n<h2>원자적 연산 - 시작</h2>\n<p>원자적이지 않은 연산을 멀티스레드 환경에서 실행하면 어떤 문제가 발생하는지 코드로 알아보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IncrementInteger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위와 같은 인터페이스를 정의하였다. 메서드는 단순하다. 증가하는 로직과 값을 가져오는 로직이다. 이것을 보고 위의 상황을 구현하려는거구나라고 파악이 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BasicInteger</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IncrementInteger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> value<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        value<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이제 인터페이스를 구현한 구현체를 작성하였다. 정말 단순한 로직이다. 이제 사용하는 <code>main</code> 메서드를 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ThreadUtils</span><span class=\"token punctuation\">.</span><span class=\"token static\">sleep</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IncrementThreadMain</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">THREAD_COUNT</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IncrementInteger</span> incrementInteger<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Runnable</span> runnable <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            incrementInteger<span class=\"token punctuation\">.</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">></span></span> threads <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">THREAD_COUNT</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            threads<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">:</span> threads<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            thread<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> incrementInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>incrementInteger<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" result: \"</span> <span class=\"token operator\">+</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위의 코드는 1000개의 스레드를 만들어서 각자 로직을 실행하게 해두었다. 그리고 <code>value++;</code>연산은 너무 빠르게 수행되기에 <code>sleep</code>을 걸어두었다. 또한 <code>main</code>메서드가 값을 받아서 확인하게끔 하려고 <code>join</code> 메서드도 걸어두었다.</p>\n<p>이제 우리는 알 것이다. 값이 1000이 안 나온다는 사실을. 그러면 이것을 어떻게 해결할까?</p>\n<h2>원자적 연산 - volatile, synchronized</h2>\n<p>그러면 먼저 <code>volatile</code> 키워드를 넣어서 해결해보자. 물론 이 상황은 메모리 가시성 문제가 아니라서 해결이 안될 것이라고 알 수 있다. 그래도 일단 확인은 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">VolatileInteger</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IncrementInteger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">int</span> value<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        value<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>멤버 변수에 <code>volatile</code> 키워드만 붙여주었다. 하지만 문제는 여전히 1000이 나오지를 않는다. <code>volatile</code>은 여러 CPU 사이에 발생하는 캐시 메모리와 메인 메모리가 동기화 되지 않는 문제를 해결할 뿐이다. <code>volatile</code>을 사용하면 CPU의 캐시 메모리를 무시하고, 메인 메모리를 직접 사용하도록 한다. 하지만 지금 이 문제는 캐시 메모리가 영향을 줄 수는 있지만, 캐시 메모리를 사용하지 않고, 메인 메모리를 직접 사용해도 여전히 발생하는 문제이다. 이 문제는 연산 자체가 나누어져 있기 때문에 발생한다. <code>volatile</code>은 연산 차제를 원자적으로 묶어주는 기능이 아니다.</p>\n<p>이렇게 연산이 단계별로 나눠져 있다면 <code>synchronized</code>나 <code>Lock</code>을 사용해야 한다. 그러면 <code>synchronized</code>를 이용해서 해결해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SyncInteger</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IncrementInteger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> value<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        value<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 작성함으로 동시성 문제가 해결이 되었다. 또한 <code>synchronized</code>를 붙이면 메모리 가시성 문제도 해결되기 때문에 <code>volatile</code> 키워드는 제거해줘도 된다.</p>\n<h2>원자적 연산 - AtomicInteger</h2>\n<p>자바는 멀티스레드 상황에서 안전하게 증가 연산을 수행할 수 있는 <code>AtomicInteger</code>라는 클래스를 제공한다. 그러면 해당 클래스를 사용해서 코드를 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AtomicInteger</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAtomicInteger</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IncrementInteger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">AtomicInteger</span> atomicInteger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>멤버 변수로 <code>value</code> 대신에 <code>AtomicInteger</code>를 사용하였고 생성자 파라미터로 초기값을 지정해줄 수 있다. 그리고 증가는 <code>++</code>대신에 <code>incrementAndGet()</code> 메서드를 사용한다. 즉, 증가하고 반환하는 메서드이다. <code>AtomicInteger</code>는 멀티스레드 상황에 안전하고 또 다양한 값 증가, 감소 연산을 제공한다. 특정 값을 증가하거나 감소해야 하는데 여러 스레드가 해당 값을 공유해야 한다면, <code>AtomicInteger</code>를 사용하면 된다.</p>\n<blockquote>\n<p>✅ 참고</p>\n<p><code>AtomicInteger</code>,<code>AtomicLong</code>,<code>AtomicBoolean</code>등 다양한 <code>AtomicXxx</code> 클래스가 존재한다.</p>\n</blockquote>\n<h2>원자적 연산 - 성능 테스트</h2>\n<p>그러면 성능 분석을 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>increment</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IncrementPerformanceMain</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">long</span> <span class=\"token constant\">COUNT</span> <span class=\"token operator\">=</span> <span class=\"token number\">100_000_000</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BasicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">VolatileInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SyncInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyAtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IncrementInteger</span> incrementInteger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">long</span> startMs <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">COUNT</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            incrementInteger<span class=\"token punctuation\">.</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">long</span> endMs <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>incrementInteger<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" : ms = \"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>endMs <span class=\"token operator\">-</span> startMs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>BasicInteger</h3>\n<ul>\n<li>가장 빠르다.</li>\n<li>CPU 캐시를 적극 사용한다. CPU 캐시의 위력을 알 수 있다.</li>\n<li>안전한 임계 영역도 없고, <code>volatile</code>도 사용하지 않기 때문에 멀티스레드 상황에는 사용할 수 없다.</li>\n<li>단일 스레드에서 사용한다.</li>\n</ul>\n<h3>VolatileInteger</h3>\n<ul>\n<li><code>volatile</code>을 사용해서 CPU 캐시를 사용하지 않고 메인 메모리를 사용한다.</li>\n<li>안전한 임계 영역이 없기 때문에 멀티스레드 상황에는 사용할 수 없다.</li>\n<li>단일 스레드에 사용하기에도 <code>BasicInteger</code>보다 느리기 때문에 꼭 필요한 상황에서 사용해야 한다.</li>\n<li>멀티 스레드 상황에도 위험하다.</li>\n</ul>\n<h3>SyncInteger</h3>\n<ul>\n<li><code>synchronized</code>를 사용한 안전한 임계 영역이 있기 때문에 멀티스레드 상황에도 안전하게 사용할 수 있다.</li>\n<li><code>MyAtomicInteger</code> 보다 성능이 느리다.</li>\n</ul>\n<h3>MyAtomicInteger</h3>\n<ul>\n<li>자바가 제공하는 <code>AtomicInteger</code>를 사용한다. 멀티스레드 상황에 안전하게 사용할 수 있다.</li>\n<li>성능도 <code>synchronized</code>,<code>Lock(ReentrantLock)</code>을 사용하는 경우보다 1.5 ~ 2배 정도 빠르다.</li>\n</ul>\n<p><code>AtomicInteger</code>가 제공하는 <code>incrementAndGet()</code> 메서드는 락을 사용하지 않고, 원자적 연산을 만들어낸다. 그래서 락을 사용하는 방식에 비해 빠른 것이다.</p>\n<h2>CAS 연산1</h2>\n<h3>락 기반 문제점</h3>\n<p>락 기법은 다음과 같은 과정을 거친다.</p>\n<ul>\n<li>락이 있는지 확인한다.</li>\n<li>락이 있다면 락을 획득한다.</li>\n<li>작업을 한다.</li>\n<li>락을 반납한다.</li>\n</ul>\n<p>락은 특정 자원을 보호하기 위해 스레드가 해당 자원에 대한 접근하는 것을 제한한다. 락이 걸려 있는 동안 다른 스레드들은 해당 자원에 접근할 수 없고, 락이 해제될 때까지 대기해야 한다. 또한 락 기반 접근에서는 락을 획득하고 해제하는 데 시간이 소요된다. 즉, 이런 과정이 10000번의 연산이 있다면 10000번을 모두 같은 과정으로 해야한다. 즉, 상당히 무거운 과정이다.</p>\n<h3>CAS</h3>\n<p>이런 문제를 해결하기 위해 락을 걸지 않고 원자적인 연산을 수행할 수 있는 방법이 있는데, 이것을 CAS 연산이라 한다. 이 방법은 락을 사용하지 않기 때문에 락 프리 기법이라 한다. 참고로 CAS 연산은 락을 완전히 대체하는 것은 아니고, <strong>작은 단위의 일부 영역에 적용</strong>할 수 있다. 기본은 락을 사용하고, 특별한 경우에 CAS를 적용할 수 있다고 생각하면 된다. 코드를 통해 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AtomicInteger</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CasMainV1</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">AtomicInteger</span> atomicInteger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start value = \"</span> <span class=\"token operator\">+</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">boolean</span> result1 <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSet</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result1 = \"</span> <span class=\"token operator\">+</span> result1 <span class=\"token operator\">+</span> <span class=\"token string\">\", value = \"</span> <span class=\"token operator\">+</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">boolean</span> result2 <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSet</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result2 = \"</span> <span class=\"token operator\">+</span> result2 <span class=\"token operator\">+</span> <span class=\"token string\">\", value = \"</span> <span class=\"token operator\">+</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>AtomicXxx</code> 클래스는 <code>compareAndSet()</code> 메서드를 제공한다. 첫번째 파라미터의 값이 맞는지 확인 후, 맞다면 두번째 파라미터 값으로 변경하고 <code>true</code>를 반환한다. 그렇지 않다면 변경하지 않고 <code>false</code>를 반환한다. 여기서 중요한 것은 이 연산이 원자적으로 수행된다는 점이다. 그럼 독자들은 의문이 들 것이다. 딱 봐도 비교하는 과정과 변경하는 과정 2개의 단계로 이루어져 있는데 이게 왜 원자적 연산일까?</p>\n<p>CAS 연산은 이렇게 원자적이지 않은 두 개의 연산을 CPU 하드웨어 차원에서 특별하게 하나의 원자적인 연산으로 묶어서 제공하는 기능이다. 이것은 소프트웨어가 제공하는 기능이 아니라 하드웨어가 제공하는 기능이다. 대부분의 현대 CPU들은 CAS 연산을 위한 명령어를 제공한다. 즉, 소프트웨어 차원이 아닌 하드웨어 차원으로 원자적 연산을 보장해주는 메서드이다. 하나의 스레드가 점유한다면 다른 스레드는 침범하지 못하게 하드웨어 차원에서 막아준다. 그럼 이 기능을 통해 락을 대체할 수 있다고들 많이 한다. 어떻게 락을 대체할 수 있을까?</p>\n<h2>CAS 연산2</h2>\n<p>어떤 값을 하나 증가하는 <code>value++</code> 연산은 원자적 연산이 아니다.</p>\n<ul>\n<li>value의 값을 읽는다.</li>\n<li>value의 값을 하나 증가 시킨다.</li>\n<li>증가한 value의 값을 value에 저장한다.</li>\n</ul>\n<p>이렇게 풀어만 봐도 벌써 3단계나 되는 원작적이지 못한 연산인 것이다. 그럼 이 부분을 CAS 연산을 통하여 <code>AtomicInteger</code>에서 제공하는 <code>incrementAndGet()</code> 메서드를 직접 구현해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AtomicInteger</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CasMainV2</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">AtomicInteger</span> atomicInteger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start value = \"</span> <span class=\"token operator\">+</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">int</span> resultValue1 <span class=\"token operator\">=</span> <span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span>atomicInteger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resultValue1 = \"</span> <span class=\"token operator\">+</span> resultValue1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">int</span> resultValue2 <span class=\"token operator\">=</span> <span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span>atomicInteger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resultValue2 = \"</span> <span class=\"token operator\">+</span> resultValue2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtomicInteger</span> atomicInteger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> getValue<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">boolean</span> result<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n            getValue <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getValue: \"</span> <span class=\"token operator\">+</span> getValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            result <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSet</span><span class=\"token punctuation\">(</span>getValue<span class=\"token punctuation\">,</span> getValue <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result: \"</span> <span class=\"token operator\">+</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> getValue <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>CAS 연산을 사용하면 여러 스레드가 같은 값을 사용하는 상황에서도 락을 걸지 않고, 안전하게 값을 증가할 수 있다. 여기서는 락을 걸지 않고 CAS 연산을 사용해서 값을 증가했다. <code>do~while</code>문을 통하여 먼저 <code>atomicInteger</code> 값을 읽는다. 읽은 후에는 <code>comapreAndSet()</code> 메서드로 CAS 연산을 수행하여 해당 값이 맞으면 1을 증가시키는 로직이다. 그리고 성공하면 <code>true</code>를 실패하면 <code>false</code>를 반환하면 반복문을 탈출한다.</p>\n<p>지금은 <code>main</code> 스레드 하나로 순서대로 실행되기 때문에 CAS 연산이 실패하는 상황을 볼 수 없다. 우리가 기대하는 실패하는 상황은 연산의 중간에 다른 스레드가 값을 변경해버리는 것이다. 멀티스레드로 실행해서 CAS 연산이 실패하는 경우에 어떻게 작동하는지 알아보자.</p>\n<h2>CAS 연산3</h2>\n<p>멀티스레드를 사용해서 중간에 다른 스레드가 먼저 값을 증가시켜 버리는 경우를 알아보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AtomicInteger</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ThreadUtils</span><span class=\"token punctuation\">.</span><span class=\"token static\">sleep</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CasMainV3</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">THREAD_COUNT</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">AtomicInteger</span> atomicInteger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicInteger</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start value = \"</span> <span class=\"token operator\">+</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Runnable</span> runnable <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span>atomicInteger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">></span></span> threads <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">THREAD_COUNT</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>runnable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            threads<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">:</span> threads<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            thread<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">getClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSimpleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" resultValue: \"</span> <span class=\"token operator\">+</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">incrementAndGet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtomicInteger</span> atomicInteger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">int</span> getValue<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">boolean</span> result<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n            getValue <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getValue: \"</span> <span class=\"token operator\">+</span> getValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            result <span class=\"token operator\">=</span> atomicInteger<span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSet</span><span class=\"token punctuation\">(</span>getValue<span class=\"token punctuation\">,</span> getValue <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"result: \"</span> <span class=\"token operator\">+</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> getValue <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>2개의 스레드가 나눠서 연산을 시행하였다. 예를들어 첫번째 스레드가 <code>atomicInteger.get()</code>을 통하여 값을 얻어온다. 그리고 <code>TIMED_WAITING</code> 상태로 가면서 다른 스레드가 또 값을 얻어오고 <code>TIMED_WAITING</code>상태로 간다. 그런데 우연히 마지막으로 대기상태로 간 스레드가 바로 깨어나서 값을 변경한다. 그리고 반복문을 빠져나간다. 그리고 첫번째 스레드가 깨어나 값을 변경하려고 하나 값이 달라서 다시 반복문 재수행 후 값을 증가시키는 로직이다.</p>\n<p><code>AtomicInteger</code>가 제공하는 <code>incrementAndGet()</code> 코드도 앞서 우리가 직접 작성한 <code>incrementAndGet()</code> 코드와 똑같이 CAS를 활용하도록 작성되어 있다. CAS를 사용하면 락을 사용하지 않지만, 대신에 다른 스레드가 값을 먼저 증가해서 문제가 발생하는 경우 루프를 돌며 재시도를 하는 방식을 사용한다. 동작과정은 아래와 같다.</p>\n<ul>\n<li>현재 변수의 값을 읽어온다.</li>\n<li>변수의 값을 1 증가시킬 때, 원래 값이 같은지 확인한다. (CAS 연산 사용)</li>\n<li>동일하다면 증가된 값을 변수에 저장하고 종료한다.</li>\n<li>동일하지 않다면 다른 스레드가 값을 중간에 변경한 것이므로, 다시 처음으로 돌아가 위 과정을 반복한다.</li>\n</ul>\n<p>두 스레드가 동시에 실행되면서 문제가 발생하는 상황을 스레드가 충돌했다고 표현한다.</p>\n<p>이 과정에서 충돌이 발생할 때마다 반복해서 다시 시도하므로, 결과적으로 락 없이 데이터를 안전하게 변경할 수 있다. CAS를 사용하는 방식은 충돌이 드물게 발생하는 환경에서는 락을 사용하지 않으므로 높은 성능을 발휘할 수 있다. 이는 락을 사용하는 방식과 비교했을 때, 스레드가 락을 획득하기 위해 대기하지 않기 때문에 대기 시간과 오버헤드가 줄어드는 장점이 있다.</p>\n<p>그러나 충돌이 빈번하게 발생하는 환경에서는 성능에 문제가 될 수 있다. 여러 스레드가 자주 동시에 동일한 변수의 값을 변경하려고 시도할 때, CAS는 자주 실패하고 재시도해야 하므로 성능 저하가 발생할 수 있다. 이런 상황에서는 반복문을 계속 돌기 때문에 CPU 자원을 많이 소모하게 된다.</p>\n<h3>CAS vs 락</h3>\n<ul>\n<li>락 방식\n<ul>\n<li>비관적(pessimistic) 접근법</li>\n<li>데이터에 접근하기 전에 항상 락을 획득</li>\n<li>다른 스레드의 접근을 막음</li>\n<li>\"다른 스레드가 방해할 것이다\"라고 가정</li>\n</ul>\n</li>\n<li>CAS 방식\n<ul>\n<li>낙관적(optimistic) 접근법</li>\n<li>락을 사용하지 않고 데이터에 바로 접근</li>\n<li>충돌이 발생하면 그때 재시도</li>\n<li>\"대부분의 경우 충돌이 없을 것이다\"라고 가정</li>\n</ul>\n</li>\n</ul>\n<p>정리하면 충돌이 많이 없는 경우에 CAS 연산이 빠른 것을 확인할 수 있다. 그럼 충돌이 많이 발생하지 않는 연산은 어떤 것이 있을까? 언제 CAS 연산을 사용하면 좋을까? 사실 간단한 CPU 연산은 너무 빨리 처리되기 때문에 충돌이 자주 발생하지 않는다. 충돌이 발생하기도 전에 이미 연산을 완료하는 경우가 더 많다. 즉, 일반적인 간단한 연산인데 동시성 이슈가 발생할 우려가 있을 것 같으면 CAS를 사용하는게 더 좋을 것이다. 만약 락을 사용한다면 하나의 스레드가 락을 얻어 작업 수행 후 락을 반납하기까지 무거운 과정을 거치는게 매우 무거울 것이다.</p>\n<h2>CAS 락 구현1</h2>\n<p>CAS는 단순한 연산 뿐만 아니라, 락을 구현하는데 사용할 수도 있다. 먼저 CAS를 사용하지 말고 락을 먼저 구현해보고 그 이후에 CAS를 이용하여 락을 구현해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>spinlock</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ThreadUtils</span><span class=\"token punctuation\">.</span><span class=\"token static\">sleep</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpinLockBad</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">volatile</span> <span class=\"token keyword\">boolean</span> lock <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 시도\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                lock <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 실패 - 스핀 대\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 완료\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        lock <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 반납 완료\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위와 같이 코드를 구현했다. 로직은 간단하다. 락이 있는지 유무를 조건문으로 판단하고 락이 없다면 락을 <code>true</code>로 변경하고 반복문을 빠져나간다. 이제 이 코드를 사용하는 <code>main</code> 메서드를 만들어보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>spinlock</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpinLockMain</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">SpinLockBad</span> spinLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SpinLockBad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Runnable</span> task <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            spinLock<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// 임계 영역</span>\n                <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"비즈니스 로직 실행\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n                spinLock<span class=\"token punctuation\">.</span><span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Thread</span> t1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>task<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thread-1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Thread</span> t2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>task<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Thread-2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        t1<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        t2<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>결과를 확인하면 이상하게 나올 것이다. 즉, 두개의 스레드가 동시에 락을 획득하고 동시에 작업 수행 후, 동시에 락을 반납한다. 뭔가 우리가 생각하는 락 기법과는 다르다. 이 둘은 한 번에 하나의 스레드만 실행해야 한다. 따라서 <code>synchronized</code> 또는 <code>Lock</code>을 사용해서 두 코드를 동기화해서 안전한 임계 영역을 만들어야 한다. 여기서 다른 해결 방안도 있다. 바로 두 코드를 하나로 묶어서 원자적으로 처리하는 것이다. CAS 연산을 사용하면 두 연산을 하나로 묶어서 하나의 원자적인 연산으로 처리할 수 있다. 락의 사용 여부를 확인하고, 그 값이 기대하는 값과 같다면 변경하는 것이다. 이것은 CAS 연산에 딱 들어 맞는다!</p>\n<h2>CAS 락 구현2</h2>\n<p>이제 CAS 락을 사용해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">.</span>cas<span class=\"token punctuation\">.</span>spinlock</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>atomic<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AtomicBoolean</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpinLock</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">AtomicBoolean</span> lock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtomicBoolean</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 시도\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>lock<span class=\"token punctuation\">.</span><span class=\"token function\">compareAndSet</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 실패 - 스핀 대기\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 획득 완료\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">unlock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        lock<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"락 반납 완료\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>구현은 단순하다. <code>AtomicBoolean</code>을 사용하여 초기값을 <code>false</code>로 세팅하고 <code>compareAndSet()</code> 메서드를 이용하여 <code>false</code>면 <code>true</code>\n로 세팅하는 것이다. 즉, 스레드가 락을 획득하면 while문을 탈출한다. 스레드가 락을 획득하지 못하면 락을 획득할 때 까지 while문을 계속 반복 실행한다. 락을 획득하기 위해 먼저 락의 사용 여부를 확인했을 때 <code>lock</code>의 현재 값이 반드시 <code>false</code>여야 한다. <code>true</code>는 이미 다른 스레드가 락을 획득했다는 뜻이다. 따라서 이 값이 <code>false</code>일 때만 락의 값을 변경할 수 있다. 락의 값이 <code>false</code>인 것을 확인한 시점부터 <code>lock</code>의 값을 <code>true</code>로 변경할 때 까지 <code>lock</code>의 값은 반드시 <code>false</code>를 유지해야 한다. 중간에 다른 스레드가 <code>lock</code>의 값을 <code>true</code>로 변경하면 안된다. 그러면 여러 스레드가 임계 영역을 통과하는 동시성 문제가 발생한다. CAS 연산은 이 락을 확인하고 락의 값을 변경하는 과정을 하나의 원자적인 연산으로 만들어준다.</p>\n<p>원자적인 연산은 스레드 입장에서 쪼갤 수 없는 하나의 연산이다. 따라서 여러 스레드가 동시에 실행해도 안전하다. 이렇게 CAS를 사용해서 원자적인 연산을 만든 덕분에 무거운 동기화 작업 없이 아주 가벼운 락을 만들 수 있었다. 동기화 락을 사용하는 경우 스레드가 락을 획득하지 못하면 <code>BLOCKED</code>,<code>WAITING</code> 등으로 상태가 변한다. 그리고 또 대기 상태의 스레드를 깨워야 하는 무겁고 복잡한 과정이 추가로 들어간다. 따라서 성능이 상대적으로 느릴 수 있다. 반면에 CAS를 활용한 락 방식은 사실 락이 없다. 단순히 while문을 반복할 뿐이다. 따라서 대기하는 스레드도 <code>RUNNABLE</code>상태를 유지하면서 가볍고 빠르게 작동할 수 있다.</p>\n<h3>CAS 단점</h3>\n<p>CAS 연산도 단점이 존재한다. CAS 락(스핀 락)은 동기화 락 기법처럼 스레드 상태가 <code>BLOCKED</code>나 <code>WAITING</code>상태로 빠지지 않는다. 즉, 계속 <code>RUNNABLE</code>상태로 유지하기 때문에 컨텍스트 스위칭이 발생하지 않아서 동기화 락보다 가볍고 성능도 뛰어나다. 하지만 DB값 조회, 외부 서버와 통신과 같은 무거운 작업이 있을 경우에는 CPU 자원을 계속 소모하기 때문에 오히려 동기화 락보다 CPU를 더 소모하게 된다. 즉, 스핀 락을 사용할 때는 무겁지 않는 단순 연산이라던가, 자료구조의 데이터 추가 및 삭제같은 것을 진행할 때 사용하는 것이 좋다.</p>\n<h3>스핀 락</h3>\n<p>스레드가 락이 해제되기를 기다리면서 반복문을 통해 계속해서 확인하는 모습이 마치 제자리에서 회전(spin)하는 것처럼 보인다. 그래서 이런 방식을 \"스핀 락\"이라고도 부른다. 그리고 이런 방식에서 스레드가 락을 획득 할 때 까지 대기하는 것을 스핀 대기(spin-wait) 또는 CPU 자원을 계속 사용하면서 바쁘게 대기한다고 해서 바쁜 대기(busy-wait)라 한다. 이런 스핀 락 방식은 아주 짧은 CPU 연산을 수행할 때 사용해야 효율적이다. 잘못 사용하면 오히려 CPU 자원을 더 많이 사용할 수 있다. 정리하면 \"스핀 락\"이라는 용어는, 락을 획득하기 위해 자원을 소모하면서 반복적으로 확인(스핀)하는 락 메커니즘을 의미한다. 그리고 이런 스핀 락은 CAS를 사용해서 구현할 수 있다.</p>\n<h2>정리</h2>\n<h3>CAS 장점</h3>\n<ul>\n<li>낙관적 동기화: 락을 걸지 않고도 값을 안전하게 업데이트할 수 있다. CAS는 충돌이 자주 발생하지 않을 것이라고 가정한다. 이는 충돌이 적은 환경에서 높은 성능을 발휘한다.</li>\n<li>락 프리(Lock-Free): CAS는 락을 사용하지 않기 때문에, 락을 획득하기 위해 대기하는 시간이 없다. 따라서 스레드가 블로킹되지 않으며, 병렬 처리가 더 효율적일 수 있다.</li>\n</ul>\n<h3>CAS 단점</h3>\n<ul>\n<li>충돌이 빈번한 경우: 여러 스레드가 동시에 동일한 변수에 접근하여 업데이트를 시도할 때 충돌이 발생할 수 있다. 충돌이 발생하면 CAS는 루프를 돌며 재시도해야 하며, 이에 따라 CPU 자원을 계속 소모할 수 있다. 반복적인 재시도로 인해 오버헤드가 발생할 수 있다.</li>\n<li>스핀락과 유사한 오버헤드: CAS는 충돌 시 반복적인 재시도를 하므로, 이 과정이 계속 반복되면 스핀락과 유사한 성능 저하가 발생할 수 있다. 특히 충돌 빈도가 높을수록 이런 현상이 두드러진다.</li>\n</ul>\n<h3>동기화 락 장점</h3>\n<ul>\n<li>충돌 관리: 락을 사용하면 하나의 스레드만 리소스에 접근할 수 있으므로 충돌이 발생하지 않는다. 여러 스레드가 경쟁할 경우에도 안정적으로 동작한다.</li>\n<li>안정성: 복잡한 상황에서도 락은 일관성 있는 동작을 보장한다.</li>\n<li>스레드 대기: 락을 대기하는 스레드는 CPU를 거의 사용하지 않는다.</li>\n</ul>\n<h3>동기화 락 단점</h3>\n<ul>\n<li>락 획득 대기 시간: 스레드가 락을 획득하기 위해 대기해야 하므로, 대기 시간이 길어질 수 있다.</li>\n<li>컨텍스트 스위칭 오버헤드: 락을 사용하면, 락 획득을 대기하는 시점과 또 락을 획득하는 시점에 스레드의 상태가 변경된다. 이때 컨텍스트 스위칭이 발생할 수 있으며, 이로 인해 오버헤드가 증가할 수 있다.</li>\n</ul>\n<blockquote>\n<p>잘못된 지식이 있을 경우 댓글로 남겨주시면 빠르게 반영하겠습니다!</p>\n</blockquote>","fields":{"slug":"/CAS-동기화와-원자적-연산/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] CAS - 동기화와 원자적 연산","tags":["자바"],"date":"2025-05-17T13:28:27.000Z","image":{"publicURL":"/static/3189e9c0404650ccc6c5ffc998bc8717/banner.png"},"series":"자바 고급1"}}},"pageContext":{"id":"a72a48fa-4f6c-5e8b-8dba-0f54fb54a334"}},
    "staticQueryHashes": ["2580406332","3810308631"]}