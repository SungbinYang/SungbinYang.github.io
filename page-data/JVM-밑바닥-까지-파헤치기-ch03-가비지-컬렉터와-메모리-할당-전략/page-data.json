{
    "componentChunkName": "component---src-template-post-tsx",
    "path": "/JVM-밑바닥-까지-파헤치기-ch03-가비지-컬렉터와-메모리-할당-전략/",
    "result": {"data":{"allMarkdownRemark":{"nodes":[{"fields":{"slug":"/JVM-밑바닥-까지-파헤치기-ch03-가비지-컬렉터와-메모리-할당-전략/"},"timeToRead":3,"frontmatter":{"title":"JVM 밑바닥 까지 파헤치기 챕터3 자바 메모리 영역과 메모리 오버플로","series":"JVM 밑바닥까지 파헤치기"}},{"fields":{"slug":"/우리의-스터디-클럽-자바-기초-출사표/"},"timeToRead":1,"frontmatter":{"title":"우리의 스터디 클럽 자바 기초 출사표","series":"성빈클럽-자바기초"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-회고록/"},"timeToRead":1,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) 회고록","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/성빈-클럽-자바-입문-회고록/"},"timeToRead":1,"frontmatter":{"title":"성빈 클럽 자바 입문 회고록","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션9/"},"timeToRead":3,"frontmatter":{"title":"성빈 클럽 미션9","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션8/"},"timeToRead":3,"frontmatter":{"title":"성빈 클럽 미션8","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션7/"},"timeToRead":1,"frontmatter":{"title":"성빈 클럽 미션7","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션6/"},"timeToRead":2,"frontmatter":{"title":"성빈 클럽 미션6","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션5/"},"timeToRead":2,"frontmatter":{"title":"성빈 클럽 미션5","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션4/"},"timeToRead":2,"frontmatter":{"title":"성빈 클럽 미션4","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션3/"},"timeToRead":3,"frontmatter":{"title":"성빈 클럽 미션3","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션2/"},"timeToRead":3,"frontmatter":{"title":"성빈 클럽 미션2","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-미션1/"},"timeToRead":3,"frontmatter":{"title":"성빈 클럽 미션1","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/성빈-클럽-출사표/"},"timeToRead":1,"frontmatter":{"title":"성빈 클럽 출사표","series":"성빈클럽-자바입문"}},{"fields":{"slug":"/JVM-밑바닥-까지-파헤치기-ch02-자바-메모리-영역과-메모리-오버플로/"},"timeToRead":10,"frontmatter":{"title":"JVM 밑바닥 까지 파헤치기 챕터2 자바 메모리 영역과 메모리 오버플로","series":"JVM 밑바닥까지 파헤치기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-4주차-발자국/"},"timeToRead":12,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) 4주차 발자국","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-Day18-미션/"},"timeToRead":7,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) Day18 미션","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-Day15-미션/"},"timeToRead":4,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) Day15 미션","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-3주차-발자국/"},"timeToRead":9,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) 3주차 발자국","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/JVM-밑바닥-까지-파헤치기-ch01-자바-기술-시스템-소개/"},"timeToRead":19,"frontmatter":{"title":"JVM 밑바닥까지 파헤치기 챕터1 자바 기술 시스템 소개","series":"JVM 밑바닥까지 파헤치기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-2주차-발자국/"},"timeToRead":6,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) 2주차 발자국","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-1주차-발자국/"},"timeToRead":25,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) 1주차 발자국","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-Day4-미션/"},"timeToRead":14,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) Day4 미션","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-Day2-미션/"},"timeToRead":1,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) Day2 미션","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-2기-백엔드(클린코드-테스트코드)-출사표/"},"timeToRead":1,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 2기 백엔드(클린코드, 테스트코드) 출사표","series":"인프런 워밍업 스터디 클럽 2기"}},{"fields":{"slug":"/내가-개발자-커리어를-시작한-이유/"},"timeToRead":4,"frontmatter":{"title":"내가 개발자 커리어를 시작한 이유","series":"일상"}},{"fields":{"slug":"/블로그-이관-및-회고/"},"timeToRead":3,"frontmatter":{"title":"블로그 이관 및 회고","series":"일상 이야기"}},{"fields":{"slug":"/Spring-Boot-3.2.x-더-이상-바이트코드를-구문-분석하여-매개변수-이름을-추론하려고-시도하지-않습니다/"},"timeToRead":3,"frontmatter":{"title":"Spring Boot 3.2.x 더 이상 바이트코드를 구문 분석하여 매개변수 이름을 추론하려고 시도하지 않습니다.","series":"트러블 슈팅"}},{"fields":{"slug":"/라떼-개발자/"},"timeToRead":2,"frontmatter":{"title":"라떼 개발자","series":"생각정리"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-0기-백엔드-미션-어노테이션(Day1)/"},"timeToRead":18,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 0기 백엔드 미션 어노테이션","series":"인프런 워밍업 스터디 클럽"}},{"fields":{"slug":"/인프런-워밍업-스터디-클럽-0기-출사표-및-OT-후기/"},"timeToRead":1,"frontmatter":{"title":"인프런 워밍업 스터디 클럽 0기 출사표 및 OT 후기","series":"인프런 워밍업 스터디 클럽"}},{"fields":{"slug":"/2023년-주니어-개발자-회고록/"},"timeToRead":5,"frontmatter":{"title":"2023년 주니어 개발자 회고록","series":"일상 이야기"}}],"group":[{"fieldValue":"JVM 밑바닥까지 파헤치기","totalCount":3},{"fieldValue":"생각정리","totalCount":1},{"fieldValue":"성빈클럽-자바기초","totalCount":1},{"fieldValue":"성빈클럽-자바입문","totalCount":11},{"fieldValue":"인프런 워밍업 스터디 클럽","totalCount":2},{"fieldValue":"인프런 워밍업 스터디 클럽 2기","totalCount":10},{"fieldValue":"일상","totalCount":1},{"fieldValue":"일상 이야기","totalCount":2},{"fieldValue":"트러블 슈팅","totalCount":1}]},"markdownRemark":{"id":"291bcd51-3a2c-5628-b078-62bd0fac9e7f","html":"<blockquote>\n<p>이 포스팅은 <a href=\"https://ebook.insightbook.co.kr/book/164\">JVM 밑바닥까지 파헤치기</a>책을 참고하여 작성된 글이다.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 458px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 130.859375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAEDAgX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgH/2gAMAwEAAhADEAAAAfblxTuMriaiKP/EABkQAAIDAQAAAAAAAAAAAAAAAAABAhARIP/aAAgBAQABBQI3RVGmxC4//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGBAAAwEBAAAAAAAAAAAAAAAAASAxABD/2gAIAQEABj8CQ8mhX//EABoQAAIDAQEAAAAAAAAAAAAAAAABESExQSD/2gAIAQEAAT8hbvRcuMah6KwsILk7iiM1YY8f/9oADAMBAAIAAwAAABCcG43/xAAXEQEBAQEAAAAAAAAAAAAAAAABABAR/9oACAEDAQE/EFRCLhn/xAAXEQEBAQEAAAAAAAAAAAAAAAABABAR/9oACAECAQE/EAEWbrn/xAAdEAEAAwEAAgMAAAAAAAAAAAABABEhMUFRYdHw/9oACAEBAAE/EEKRUbPBvIjpt+ILUI74lU3cKabfcRo6zGfrlPcW4fcFIPC9lHqUeoE//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"썸네일\"\n        title=\"썸네일\"\n        src=\"/static/6f4fdad8a4449334ff8d7722b46c646c/f7c3c/thumbnail.jpg\"\n        srcset=\"/static/6f4fdad8a4449334ff8d7722b46c646c/e4a55/thumbnail.jpg 256w,\n/static/6f4fdad8a4449334ff8d7722b46c646c/f7c3c/thumbnail.jpg 458w\"\n        sizes=\"(max-width: 458px) 100vw, 458px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2>가비지 컬렉터와 메모리 할당 전략</h2>\n<h3>들어가며</h3>\n<p>가비지 컬렉션의 역사는 자바보다 오래되었다. 가비지 컬렉션이 처리해야 할 문제를 제기하였다.</p>\n<ul>\n<li>어떤 메모리를 회수해야 하나?</li>\n<li>언제 회수해야 할까?</li>\n<li>어떻게 회수해야 할까?</li>\n</ul>\n<p>오늘날 동적 메모리 할당과 가비지 컬렉션 기술은 상당히 발전되었다. 왜 가비지 컬렉션과 메모리 할당의 내부를 이해해야 할까?</p>\n<p>정답은 다양한 메모리 오버플로우와 누수 문제를 해결해야 하는 상황이나 더 높은 동시성을 달성하는 데 가비지 컬렉션이 방해가 되는 상황때문이다.</p>\n<p>자바 힙과 메서드 영역은 요구하는 메모리 크기가 다를 수 있다. 그래서 이 메모리 영역들의 할당과 회수는 동적으로 이루어진다. 가비지 컬렉터는 바로 이런 영역을 관리하는 데 집중한다.</p>\n<h3>대상이 죽었는가?</h3>\n<p>자바 세계에서 거의 모든 객체 인스턴스가 힙에 저장된다. 가바지 컬렉터가 힙을 청소하려면 가장 먼저 객체의 생사유무를 알아야 한다.</p>\n<h4>참조 카운팅 알고리즘</h4>\n<p>많은 교재에서 객체가 살아 있는지 판단하는 알고리즘은 아래와 같이 말한다.</p>\n<ul>\n<li>객체를 가리키는 참조 카운터를 추가한다. 참조하는 곳이 하나 늘어날 때마다 카운터 값을 1씩 증가시킨다.</li>\n<li>참조하는 곳이 하나 사라질때마다 카운터 값을 1씩 감소시킨다.</li>\n<li>카운터 값이 0이 된 객체는 더는 사용될 수 없다.</li>\n</ul>\n<p>하지만 자바 가상 머신에서는 참조 카운팅을 쓰지 않는다. 이 간결한 알고리즘에서도 고려해야 할 특이 상황이 적지 않고 모든 상황에서 문제없이 동작하게 하려면 계산할 게 상당히 늘어나기 때문이다.</p>\n<h4>도달 가능성 분석 알고리즘</h4>\n<p>오늘날의 주류 프로그래밍 언어들은 객체 생사 판단에 도달 가능성 분석 알고리즘을 이용한다. 이 알고리즘의 기본 아이디어는 GC루트라고 하는 루트 객체들을 시작 노드 집합으로 쓰는 것이다. 탐색 과정에서 만들어지는 경로를 참조 체인이라 한다. 그리고 어떤 객체와 GC 루트 사이를 이어주는 참조 체인이 없다면 이 객체는 더 이상 사용하는게 아닐 것이다.</p>\n<p>자바에서 GC루트로 이용할 수 있는 객체는 아래와 같다.</p>\n<ul>\n<li>가상머신스택에서 참조하는 객체: 실행중인 메서드에서 쓰는 매개변수, 지역변수, 임시변수</li>\n<li>메서드 영역에서 클래스가 정적 필드로 참조하는 객체: 자바 클래스의 참조 타입 정적 변수</li>\n<li>메서드 영역에서 상수로 참조되는 객체: 문자열 테이블 안의 참조</li>\n<li>네이티브 메서드 스택에서 JNI가 참조하는 객체</li>\n<li>자바 가상 머신 내부에서 쓰이는 참조: 기본 데이터 타입에 해당하는 Class 객체, 일부 상주 예외 객체, 시스템 클래스 로더</li>\n<li>동기화 락으로 잠겨 있는 모든 객체</li>\n<li>자바 가상 머신 내부 상황을 반영하는 JMXBean: JVMTI에 등록된 콜백, 로컬 코드 캐시등</li>\n</ul>\n<p>세대 단위 컬렉션과 부분 컬렉션의 경우, 자바 힙의 일부 영역부터 분석을 시작한다. 또한 객체는 다른 영역에 있는 객체도 참조할 수 있으므로 연관된 영역의 객체들도 GC루트 집합에 포함시켜야 도달 가능성을 정확하게 분석할 수 있다.</p>\n<h4>다시 참조 이야기로</h4>\n<ul>\n<li>\n<p>강한 참조: 가장 전통적인 정의의 참조를 뜻한다. 즉, 프로그램 코드에서 참조를 할당하는 걸 말한다. 강한 참조 관계가 남아 있는 객체는 GC가 절대 회수하지 않는다.</p>\n</li>\n<li>\n<p>부드러운 참조: 유용하지만 필수는 아닌 객체를 표현한다. 부드러운 참조만 남은 객체라면 메모리 오버플로가 나기 직전에 두 번째 회수를 위한 회수 목록에 추가된다.</p>\n</li>\n<li>\n<p>약한 참조: 부드러운 참조와 비슷하지만 연결 강도가 더 약하다. 약한 참조뿐인 객체는 다음번 GC까지만 살아 있다. GC가 동작하기 시작하면 메모리가 넉넉하더라도 약하게 참조된 객체는 모두 회수된다.</p>\n</li>\n<li>\n<p>유령참조: 참조 중에 가장 약함. 유령참조는 객체 수명에 아무런 영향을 주지 않으며 유령 참조를 통해 객체 인스턴스를 가져오는 것마저 불가능하다. 유령 참조를 거는 유일한 목적은 대상 객체가 회수될 때 알림을 받기 위해서다.</p>\n</li>\n</ul>\n<blockquote>\n<p>파이널 참조</p>\n<p>참조 강도는 약한 참조와 유령 참조 사이로 <code>finalize()</code> 메서드를 구현한 객체는 모두 파이널 참조의 대상이 되어 별도의 대기열에 등록되며 해당 객체에 도달할 수 있는 강한 참조, 부드러운 참조, 약한 참조가 모두 없어지면 finalize() 메서드 호출.</p>\n</blockquote>\n<h4>살았나 죽었나?</h4>\n<p>도달 가능성 분석 알고리즘이 '도달 불가능'으로 판단한 객체라고 해서 반드시 죽어야 하는 것은 아니고 유예단계가 남아 있다. GC루트와 연결된 참조 체인을 찾지 못한 객체에는 첫번째 표시가 이루어지면 이어서 필터링이 진행된다.</p>\n<blockquote>\n<p>필터링 조건</p>\n<p>finalize() 메서드를 실행해야 하는 객체</p>\n</blockquote>\n<p>finalize()가 필요없는 객체이거나 가상머신이 finalize()를 이미 호출한 경우 모두 실행할 필요없음으로 처리된다.</p>\n<p>필터링이 되면 그 객체는 F-큐라는 대기열에 추가된다. 그러면 나중에 가상머신이 우선순위가 가장 낮은 종료자 스레드를 생성해 F-큐에 들어 있는 객체들의 finalize 메서드를 실행한다.</p>\n<p>finalize 메서드를 통해 부활한 객체는 참조 체인상의 아무 객체와 다시 연결하면 된다.</p>\n<blockquote>\n<p>finalize 사용X jdk9부터 폐기 대상</p>\n</blockquote>\n<h4>메서드 영역 회수하기</h4>\n<p>메서드 영역의 가비지 컬렉션은 상수와 클래스를 회수한다. 다 쓴 상수를 회수하는 방법도 자바 힙에서 객체를 회수하는 방법과 매우 비슷하다.</p>\n<p>다 쓴 상수는 이 리터럴을 누군가 쓰고 있는지 판단만 하면 되지만 클래스는 더 복잡하다. 아래의 3가지 조건을 동시에 만족해야 한다.</p>\n<ul>\n<li>이 클래스의 인스턴스가 모두 회수되었다. 즉, 자바 힙에는 해당 클래스와 하위 클래스의 인스턴스가 하나도 존재하지 않는다.</li>\n<li>이 클래스를 읽어 들인 클래스 로더가 회수되었다. 이 조건은 OSGi나 JSP 리로딩처럼 세심하게 설계된 대안 클래스 로더 없ㅇ이는 충족하기 어렵다.</li>\n<li>이 클래스에 해당하는 <code>java.lang.Class</code> 객체를 아무 곳에서도 참조하지 않고 리플렉션 기능으로 이 클래스의 메서드를 이용하는 곳도 전혀 없다.</li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","fields":{"slug":"/JVM-밑바닥-까지-파헤치기-ch03-가비지-컬렉터와-메모리-할당-전략/"},"timeToRead":3,"frontmatter":{"title":"JVM 밑바닥 까지 파헤치기 챕터3 자바 메모리 영역과 메모리 오버플로","tags":["스터디"],"date":"2024-11-18T00:10:27.000Z","image":{"publicURL":"/static/6f4fdad8a4449334ff8d7722b46c646c/thumbnail.jpg"},"series":"JVM 밑바닥까지 파헤치기"}}},"pageContext":{"id":"291bcd51-3a2c-5628-b078-62bd0fac9e7f"}},
    "staticQueryHashes": ["2580406332","3810308631"]}