{
    "componentChunkName": "component---src-template-post-tsx",
    "path": "/advanced-kotlin-지연과-위임/",
    "result": {"data":{"allMarkdownRemark":{"nodes":[{"fields":{"slug":"/컴퓨터-구조론-이론-CPU의-성능-향상-기법/"},"timeToRead":5,"frontmatter":{"title":"[컴퓨터 구조론 이론] CPU의 성능 향상 기법","series":"컴퓨터 구조론 이론"}},{"fields":{"slug":"/advanced-kotlin-코틀린을-더-알아보자/"},"timeToRead":11,"frontmatter":{"title":"[코틀린 고급] 코틀린을 더 알아보자!","series":"코틀린 고급"}},{"fields":{"slug":"/컴퓨터-구조론-이론-CPU의-작동-원리/"},"timeToRead":6,"frontmatter":{"title":"[컴퓨터 구조론 이론] CPU의 작동 원리","series":"컴퓨터 구조론 이론"}},{"fields":{"slug":"/advanced-kotlin-어노테이션과-리플렉션/"},"timeToRead":8,"frontmatter":{"title":"[코틀린 고급] 어노테이션과 리플렉션","series":"코틀린 고급"}},{"fields":{"slug":"/advanced-kotlin-연산자-오버로딩과-Kotlin-DSL/"},"timeToRead":12,"frontmatter":{"title":"[코틀린 고급] 연산자 오버로딩과 Kotlin DSL","series":"코틀린 고급"}},{"fields":{"slug":"/컴퓨터-구조론-이론-명령어/"},"timeToRead":6,"frontmatter":{"title":"[컴퓨터 구조론 이론] 명령어","series":"컴퓨터 구조론 이론"}},{"fields":{"slug":"/컴퓨터-구조론-이론-데이터/"},"timeToRead":5,"frontmatter":{"title":"[컴퓨터 구조론 이론] 데이터","series":"컴퓨터 구조론 이론"}},{"fields":{"slug":"/코틀린-K2-컴파일러/"},"timeToRead":11,"frontmatter":{"title":"Kotlin 1.x에서 안 되던 코드가 2.0에서 된다? — K2 컴파일러가 바꿔놓은 Java SAM 변환의 모든 것","series":"트러블 슈팅"}},{"fields":{"slug":"/advanced-kotlin-복잡한-함수형-프로그래밍/"},"timeToRead":12,"frontmatter":{"title":"[코틀린 고급] 복잡한 함수형 프로그래밍","series":"코틀린 고급"}},{"fields":{"slug":"/advanced-kotlin-지연과-위임/"},"timeToRead":18,"frontmatter":{"title":"[코틀린 고급] 지연과 위임","series":"코틀린 고급"}},{"fields":{"slug":"/컴퓨터-구조론-이론-컴퓨터-구조-시작하기/"},"timeToRead":4,"frontmatter":{"title":"[컴퓨터 구조론 이론] 컴퓨터 구조 시작하기","series":"컴퓨터 구조론 이론"}},{"fields":{"slug":"/advanced-kotlin-제네릭/"},"timeToRead":18,"frontmatter":{"title":"[코틀린 고급] 제네릭","series":"코틀린 고급"}},{"fields":{"slug":"/컴퓨터-구조론-마무리/"},"timeToRead":2,"frontmatter":{"title":"[컴퓨터 구조론] 마무리","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-기계어-어셈블리어/"},"timeToRead":5,"frontmatter":{"title":"[컴퓨터 구조론] 기계어와 어셈블리어","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-CPU-만들기-제어장치/"},"timeToRead":9,"frontmatter":{"title":"[컴퓨터 구조론] CPU 만들기 - 제어장치","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-제어장치가-없는-컴퓨터/"},"timeToRead":3,"frontmatter":{"title":"[컴퓨터 구조론] 제어장치가 없는 컴퓨터","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-메모리-만들기/"},"timeToRead":12,"frontmatter":{"title":"[컴퓨터 구조론] 메모리 만들기","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-CPU-만들기/"},"timeToRead":4,"frontmatter":{"title":"[컴퓨터 구조론] CPU 만들기: 산술논리연산장치(ALU)","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-컴퓨터-기초가-되는-하드웨어-만들기/"},"timeToRead":13,"frontmatter":{"title":"[컴퓨터 구조론] 컴퓨터의 기초가 되는 하드웨어 만들기","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-비트/"},"timeToRead":7,"frontmatter":{"title":"[컴퓨터 구조론] 비트","series":"컴퓨터 구조론"}},{"fields":{"slug":"/Redis-캐싱-전략/"},"timeToRead":4,"frontmatter":{"title":"[Redis] Redis 캐싱 전략","series":"redis 기본"}},{"fields":{"slug":"/Redis-사용법-익히기/"},"timeToRead":4,"frontmatter":{"title":"[Redis] Redis 사용법 익히기","series":"redis 기본"}},{"fields":{"slug":"/Redis-기본-개념/"},"timeToRead":1,"frontmatter":{"title":"[Redis] Redis 기본 개념","series":"redis 기본"}},{"fields":{"slug":"/Gradle-Introduction/"},"timeToRead":2,"frontmatter":{"title":"[Gradle] Introduction","series":"gradle"}},{"fields":{"slug":"/intellij-플러그인/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ] 플러그인","series":"IntelliJ"}},{"fields":{"slug":"/intellij-Git-Github/"},"timeToRead":4,"frontmatter":{"title":"[IntelliJ] Git&Github","series":"IntelliJ"}},{"fields":{"slug":"/intellij-디버깅/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ] 디버깅","series":"IntelliJ"}},{"fields":{"slug":"/intellij-리팩토링/"},"timeToRead":6,"frontmatter":{"title":"[IntelliJ] 리팩토링","series":"IntelliJ"}},{"fields":{"slug":"/intellij-자동완성/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ] 자동완성","series":"IntelliJ"}},{"fields":{"slug":"/intellij-검색/"},"timeToRead":4,"frontmatter":{"title":"[IntelliJ] 검색","series":"IntelliJ"}},{"fields":{"slug":"/css/"},"timeToRead":8,"frontmatter":{"title":"[프론트엔드] css","series":"프론트엔드"}},{"fields":{"slug":"/Javascript/"},"timeToRead":18,"frontmatter":{"title":"[프론트엔드] Javascript","series":"프론트엔드"}},{"fields":{"slug":"/HTML/"},"timeToRead":10,"frontmatter":{"title":"[프론트엔드] HTML","series":"프론트엔드"}},{"fields":{"slug":"/프론트엔드에-대해/"},"timeToRead":6,"frontmatter":{"title":"[프론트엔드] 프론트엔드에 대해","series":"프론트엔드"}},{"fields":{"slug":"/백엔드-개발자에-의한-백엔드-개발자를-위한-프론트엔드/"},"timeToRead":2,"frontmatter":{"title":"[프론트엔드] 백엔드 개발자에 의한, 백엔드 개발자를 위한 프론트엔드","series":"프론트엔드"}},{"fields":{"slug":"/intellij-포커스/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ] 포커스","series":"IntelliJ"}},{"fields":{"slug":"/intellij-코드-Edit/"},"timeToRead":8,"frontmatter":{"title":"[IntelliJ] 코드 Edit","series":"IntelliJ"}},{"fields":{"slug":"/intellij-소개/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ] 소개","series":"IntelliJ"}},{"fields":{"slug":"/컴퓨터-구조론-불-대수/"},"timeToRead":13,"frontmatter":{"title":"[컴퓨터 구조론] 불 대수","series":"컴퓨터 구조론"}},{"fields":{"slug":"/지속-성장-가능한-소프트웨어를-만들어가는-방법/"},"timeToRead":7,"frontmatter":{"title":"[소프트웨어] 지속 성장 가능한 소프트웨어를 만들어가는 방법","series":"소프트웨어"}},{"fields":{"slug":"/향로와-함께하는-챌린지-후기/"},"timeToRead":2,"frontmatter":{"title":"향로와 함께하는 추석 완강 챌린지","series":"일상"}},{"fields":{"slug":"/컴퓨터-구조론-컴퓨터-구성-요소/"},"timeToRead":5,"frontmatter":{"title":"[컴퓨터 구조론] 컴퓨터 구성 요소","series":"컴퓨터 구조론"}},{"fields":{"slug":"/컴퓨터-구조론-컴퓨터-구조-개요/"},"timeToRead":5,"frontmatter":{"title":"[컴퓨터 구조론] 컴퓨터 구조 개요","series":"컴퓨터 구조론"}},{"fields":{"slug":"/java-to-kotlin-starter-guide-추가적으로-알아두어야-할-코틀린-특성/"},"timeToRead":8,"frontmatter":{"title":"[코틀린 입문] 추가적으로 알아두어야 할 코틀린 특성","series":"코틀린 입문"}},{"fields":{"slug":"/java-to-kotlin-starter-guide-코틀린에서-FP/"},"timeToRead":16,"frontmatter":{"title":"[코틀린 입문] 코틀린에서 FP","series":"코틀린 입문"}},{"fields":{"slug":"/컴퓨터-기초-자료구조-소개와-마무리/"},"timeToRead":2,"frontmatter":{"title":"[컴퓨터 기초] 자료구조 소개와 마무리","series":"컴퓨터 기초"}},{"fields":{"slug":"/컴퓨터-기초-프로그래밍-맛보기/"},"timeToRead":4,"frontmatter":{"title":"[컴퓨터 기초] 프로그래밍 맛보기","series":"컴퓨터 기초"}},{"fields":{"slug":"/코틀린-상속-간-주의-점/"},"timeToRead":2,"frontmatter":{"title":"코틀린 상속 간 주의점","series":"트러블 슈팅"}},{"fields":{"slug":"/java-to-kotlin-starter-guide-코틀린에서-OOP/"},"timeToRead":23,"frontmatter":{"title":"[코틀린 입문] 코틀린에서 OOP","series":"코틀린 입문"}},{"fields":{"slug":"/컴퓨터-기초-넓고-얕은-운영체제/"},"timeToRead":8,"frontmatter":{"title":"[컴퓨터 기초] 넓고 얕은 운영체제","series":"컴퓨터 기초"}},{"fields":{"slug":"/java-to-kotlin-starter-guide-코틀린에서-코드를-제어하는-방법/"},"timeToRead":13,"frontmatter":{"title":"[코틀린 입문] 코틀린에서 코드를 제어하는 방법","series":"코틀린 입문"}},{"fields":{"slug":"/컴퓨터-기초-넓고-얕은-컴퓨터-구조/"},"timeToRead":7,"frontmatter":{"title":"[컴퓨터 기초] 넓고 얕은 컴퓨터 구조","series":"컴퓨터 기초"}},{"fields":{"slug":"/컴퓨터-기초-컴공-이론을-위한-기초체력-다지기/"},"timeToRead":7,"frontmatter":{"title":"[컴퓨터 기초] 컴공 이론을 위한 기초체력 다지기","series":"컴퓨터 기초"}},{"fields":{"slug":"/java-to-kotlin-starter-guide-코틀린에서-변수와-타입-연산자를-다루는-방법/"},"timeToRead":14,"frontmatter":{"title":"[코틀린 입문] 코틀린에서 변수와 타입, 연산자를 다루는 방법","series":"코틀린 입문"}},{"fields":{"slug":"/java-to-kotlin-starter-guide-강의-소개/"},"timeToRead":2,"frontmatter":{"title":"[코틀린 입문] 강의 소개","series":"코틀린 입문"}},{"fields":{"slug":"/컴퓨터-기초-학습에-앞서-본-강의-소개/"},"timeToRead":3,"frontmatter":{"title":"[컴퓨터 기초] 학습에 앞서 본 강의 소개","series":"컴퓨터 기초"}},{"fields":{"slug":"/중요한-것은-포기하지-않는-마음/"},"timeToRead":3,"frontmatter":{"title":"2025년 1분기 회고(feat. 중요한 것은 포기하지 않는 마음)","series":"일상 이야기"}},{"fields":{"slug":"/2024년-주니어-개발자-회고록/"},"timeToRead":3,"frontmatter":{"title":"2024년 주니어 개발자 회고록","series":"일상 이야기"}},{"fields":{"slug":"/WDD/"},"timeToRead":1,"frontmatter":{"title":"WDD(Why-Driven-Development)","series":"생각정리"}},{"fields":{"slug":"/내가-개발자-커리어를-시작한-이유/"},"timeToRead":4,"frontmatter":{"title":"내가 개발자 커리어를 시작한 이유","series":"일상"}},{"fields":{"slug":"/블로그-이관-및-회고/"},"timeToRead":3,"frontmatter":{"title":"블로그 이관 및 회고","series":"일상 이야기"}},{"fields":{"slug":"/Spring-Boot-3.2.x-더-이상-바이트코드를-구문-분석하여-매개변수-이름을-추론하려고-시도하지-않스/"},"timeToRead":3,"frontmatter":{"title":"Spring Boot 3.2.x 더 이상 바이트코드를 구문 분석하여 매개변수 이름을 추론하려고 시도하지 않습니다.","series":"트러블 슈팅"}},{"fields":{"slug":"/라떼-개발자/"},"timeToRead":2,"frontmatter":{"title":"라떼 개발자","series":"생각정리"}},{"fields":{"slug":"/2023년-주니어-개발자-회고록/"},"timeToRead":5,"frontmatter":{"title":"2023년 주니어 개발자 회고록","series":"일상 이야기"}}],"group":[{"fieldValue":"IntelliJ","totalCount":9},{"fieldValue":"gradle","totalCount":1},{"fieldValue":"redis 기본","totalCount":3},{"fieldValue":"생각정리","totalCount":2},{"fieldValue":"소프트웨어","totalCount":1},{"fieldValue":"일상","totalCount":2},{"fieldValue":"일상 이야기","totalCount":4},{"fieldValue":"컴퓨터 구조론","totalCount":11},{"fieldValue":"컴퓨터 구조론 이론","totalCount":5},{"fieldValue":"컴퓨터 기초","totalCount":6},{"fieldValue":"코틀린 고급","totalCount":6},{"fieldValue":"코틀린 입문","totalCount":6},{"fieldValue":"트러블 슈팅","totalCount":3},{"fieldValue":"프론트엔드","totalCount":5}]},"markdownRemark":{"id":"490ffa8e-7d8a-5a50-9fa8-8d5538632314","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZElEQVQoz41SMUtCURh9P6I9GoTGfkCbtISDEIig7wml2FIimaE0pLVUBkY22NSSSqmEkZHobKavMM0wyBoawppe8YS83/fFe5qKk4cznHu55zuXey5HKoAIkAihy9HADWjsCwT8R3cLEVQMmxlRSISDM3pLJihtwMwSyV+qATq23oihpWJuI0xck7CZa7nHwMdR9ZgRVSrl2lOt/FAmIkmS6s/19FU6m8sOJeMPkTP++OqebW9MsZeMMh4Yb+FNgil5ngzsBZwrTp1eZxbMlnmLa80V3A/2k3+RPnyH74sLofVCVUkCxsBoMlrtVv2c3r/l185oeYG32W2aSY3H63E4Hc3PpmJG9d55b2p6uza+S/wy3OWVdygUbhuNRjQWDR+Fi8ViJBpJXaRip7FSqSSKoizLPTOc5CXDPa3e4M4lxRPU+lb7Axy9qoHSkACgUw9jDBEZYx09WBjXP60SVY74Sf4AtOgKavup5M4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"banner\"\n        title=\"banner\"\n        src=\"/static/619e6175d83cd70c239721219e3cbc91/2bef9/banner.png\"\n        srcset=\"/static/619e6175d83cd70c239721219e3cbc91/6f3f2/banner.png 256w,\n/static/619e6175d83cd70c239721219e3cbc91/01e7c/banner.png 512w,\n/static/619e6175d83cd70c239721219e3cbc91/2bef9/banner.png 1024w,\n/static/619e6175d83cd70c239721219e3cbc91/c1b63/banner.png 1200w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>해당 포스팅은 인프런의 <a href=\"https://inf.run/GZfvz\">코틀린 고급편</a> 강의를 참조하여 작성한 글입니다.</p>\n</blockquote>\n<h2>lateinit과 lazy()</h2>\n<p>일반적으로 코틀린에서 클래스를 생성할 때 주 생성자를 만들며 프로퍼티를 선언한다. 아래와 같이 말이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> isKim<span class=\"token operator\">:</span> Boolean\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"김\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> maskingName<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> until name<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">joinToString</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"*\"</span></span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위의 클래스는 <code>Person(\"양성빈\")</code>과 같은 코드로 인스턴스화를 진행할 수 있는데 이 때 클래스 인스턴스화가 이루어짐과 동시에 name에는 양성빈이라는 값이 들어간다. 하지만 우리는 인스턴스 생성과 초기화 부분을 분리하고 싶은 욕구가 있을 때가 있다. 아래의 테스트 코드를 한번 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> PersonTest1 <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation builtin\">@Test</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">isKimTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// given</span>\n        <span class=\"token keyword\">val</span> person <span class=\"token operator\">=</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// when &amp; then</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">.</span>isKim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>isTrue\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation builtin\">@Test</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">maskingNameTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// given</span>\n        <span class=\"token keyword\">val</span> person <span class=\"token operator\">=</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"양성빈\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// when &amp; then</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">.</span>maskingName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"양**\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위의 테스트 코드를 보면 테스트 메서드마다 person을 인스턴스화 하고 있다. 또한 인스턴스화를 하는데 초기 값이 테스트 코드마다 다르다. 여기서 우리는 조금 더 효율적으로 작성하기 위해 아래와 같은 욕구가 생길 것이다.</p>\n<ul>\n<li>인스턴스화를 한 번만 하고, 테스트를 할 때에 변수를 초기화하고 싶다.</li>\n<li>또한, 인스턴스화를 할 때 초기값을 넣어주고 싶지도 않다.</li>\n</ul>\n<p>가장 간단한 방법은 생성을 할 때 name에 default parameter를 주어서 기본 값을 세팅해주는 방법이 있을 것이다. 그러면 아마 아래와 같이 코드를 변경해야 할 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> name<span class=\"token operator\">:</span> Stirng <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"홍길동\"</span></span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> PersonTest2 <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> person <span class=\"token operator\">=</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 객체 변수를 만들 때 초기값을 넣지 않았다.</span>\n\n    <span class=\"token annotation builtin\">@Test</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">isKimTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span> name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>isKim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>isTrue\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token annotation builtin\">@Test</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">maskingNameTest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span> name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"양성빈\"</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span>maskingName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"최**\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위의 코드는 겉보기에는 괜찮은 코드로 보일 것이다. 하지만 이 코드는 위험이 잠재되어 있는 코드이다. 누군가가 Person을 인스턴스화를 한 뒤에 name을 초기화하지 않고 사용할 수도 있는 것이다. 그러면 예외라도 터져야 하는데 기본 값이 세팅이 됨으로 예외는 터지지 않으니 엄청 문제가 많은 코드가 되는 것이다. 즉 클래스를 인스턴스화할 때 임의의 값을 넣었다가, 나중에 값을 변경해주는 방법은 때때로 위험할 수 있다.</p>\n<p>이런 위험성을 해결하기 위해서 실제 name은 null이 될 수 없지만, nullable 변수로 만들 수 있다. 바로 아래와 같이 작성하면 누군가가 초기화를 하지 않았을 때 예외를 터지게 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> name<span class=\"token operator\">:</span> String<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n    \n    <span class=\"token keyword\">val</span> isKim<span class=\"token operator\">:</span> Boolean\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token operator\">!!</span><span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"김\"</span></span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">val</span> maskingName<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> name<span class=\"token operator\">!!</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> until name<span class=\"token operator\">!!</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">joinToString</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"*\"</span></span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>하지만 이 방법 역시 단점이 존재한다. 실제로 null이 될 수 없는 name을 null이 들어갈 수 있는 타입인 <code>String?</code>로 null처리를 하여 널 관련 처리를 해줘야 한다. 상황에 따라 Safe Call ( ?. ) 엘비스 연산자, 널 아님 단언이 지속적으로 들어가야 한다.</p>\n<p>핵심은 객체의 인스턴스화 시점과 변수 초기화 시점을 분리하고 싶다는 점이다. 이럴 때 바로 코틀린에서 <code>lateinit</code>이라는 키워드를 제공해준다. <code>lateinit</code> 키워드를 <code>var</code> 변수 앞에 붙이게 되면, 이 변수는 다음과 같은 특징을 갖게 된다.</p>\n<ul>\n<li>초기값을 지정하지 않고, null이 들어갈 수 없는 변수를 선언할 수 있다.</li>\n<li><code>var</code> 변수이므로 언제든지 값을 변경할 수 있다.</li>\n<li>초기값이 지정되지 않은 채로 해당 변수를 사용하려 하면 <code>UninitializedPropertyAccessException</code> 예외가 발생한다.</li>\n</ul>\n<p>그러면 이런 의문점이 들 것이다. <code>lateinit</code>은 어떻게 이런 특징을 가지게 할 수 있을까? 비밀은 바로 컴파일 단계에 존재한다. <code>lateinit</code> 변수가 존재하면 코틀린은 컴파일을 할 때에 이 변수에 null을 저장할 수 있게 해주고, getter에서 변수 값이 null인지 확인해 예외를 던지거나 값을 정상 반환시킨다. 아래 코드는 컴파일된 코틀린 코드를 decompile로 확인한 코드이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">lateinit</span> <span class=\"token keyword\">var</span> name<span class=\"token operator\">:</span> String\n\n    <span class=\"token keyword\">val</span> isKim<span class=\"token operator\">:</span> Boolean\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"김\"</span></span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">val</span> maskingName<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> until name<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">joinToString</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"*\"</span></span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> var10000 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>var10000 <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">throwUninitializedPropertyAccessException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> var10000<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@NotNull</span> <span class=\"token class-name\">String</span> var1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Intrinsics</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkNotNullParameter</span><span class=\"token punctuation\">(</span>var1<span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;set-?>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> var1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이런 원리로 인해, <code>lateinit</code> 변수는 <code>Int</code>나 <code>Long</code>과 같은 primitive type에 사용할 수 없다. <code>Int</code>나 <code>Long</code>은 <code>Int?</code>와 <code>Long?</code>과 다르게 null을 저장할 수 없어야 하는데, <code>lateinit var Int</code>나 <code>lateinit var Long</code>을 사용한다면 컴파일이 되었을 때 null을 저장할 수 있어야 하기 때문이다. primitive type의 컴파일 원리와 <code>lateinit</code>의 컴파일 원리가 모순되는 것이다.</p>\n<p>이번에는 다른 관점에서 한번 살펴보자. 객체의 인스턴스화 시점과 초기화 시점을 분리하되, 최초로 변수를 사용할 때 지정된 로직을 1회만 실행시켜 값을 가져오고 싶다라는 니즈가 있다고 해보자. 이런 경우는 특정 값을 가져오는 비용이 크고 해당 변수가 사용되지 않을 수도 있다라면 이런 특성이 필요해진다. 예를 들어 사람의 이름을 File을 통해 읽어야 하는데 I/O 비용이 2초정도 걸린다고 해보자. 그러면 우리는 예시 코드를 아래와 같이 작성할 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n    <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>혹은 아래와 같이 작성 할 수도 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n    \n    <span class=\"token keyword\">init</span> <span class=\"token punctuation\">{</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000</span><span class=\"token punctuation\">)</span>\n        name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>첫번째 방식은 name을 사용하지 않으면 <code>Thread.sleep</code>이 호출되지 않는 장점이 있다. 하지만 name이 사용될 때마다 <code>Thread.sleep</code>이 호출되어 name을 쓸수록 I/O가 발생한다. 방법 2는 <code>Thread.sleep</code>이 딱 한번만 호출되는 장점을 가진다. 하지만, name이 필요하지 않은 경우에도 <code>Thread.sleep</code>이 호출되는 손해가 발생한다.</p>\n<p>그래서 우리의 요구사항을 명확히 구현하려면 <strong>backing property</strong>를 사용해야 한다. 바로 아래처럼 말이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// name과 대응되는, 외부로 드러나지 않는 프로퍼티 : backing property</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> _name<span class=\"token operator\">:</span> String<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_name <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_name\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>하지만 지금 딱 보더라도 매우 복잡하다는 것을 느낄 수 있을 것이다. 이럴 때 바로 <code>by lazy</code>를 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">class</span> Person2 <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> lazy <span class=\"token punctuation\">{</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000L</span><span class=\"token punctuation\">)</span>\n        <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>여기서 <code>lazy</code>는 코틀린에서 제공하는 함수로, 또 다른 함수를 파라미터로 받는다. 우리는 이 함수에 <code>{}</code>와 같은 람다를 넣어준 것이다. 이 람다는 name 프로퍼티가 최초로 get 될 때 실행되고 기본적으로 Thread-safe하다.</p>\n<h2>by lazy의 원리와 위임 프로퍼티</h2>\n<p>이번에는 <code>by lazy</code>의 원리를 파헤쳐보자. 먼저 <code>backing property</code>를 사용한 코드 예제를 다시 한번 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">class</span> Person3 <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> _name<span class=\"token operator\">:</span> String<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_name <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000L</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_name <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_name<span class=\"token operator\">!!</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이전에 우리는 객체의 인스턴스화 시점과 초기화 시점을 분리하고 최초로 변수를 사용할 때 지정한 로직을 1회만 실행시켜 가져오고 싶은 요구사항을 위와 같이 직접 구현했었다. 만약 <code>by lazy</code>를 사용하지 않고 위 코드를 계속해서 써야 한다면, 조금 더 재사용할 법한 구조로 변경가능하지 않을까? 바로 아래와 같이 말이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> LazyInitProperty<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> <span class=\"token keyword\">init</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> T<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> _value<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    <span class=\"token keyword\">val</span> value<span class=\"token operator\">:</span> T\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_value <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_value <span class=\"token operator\">=</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_value<span class=\"token operator\">!!</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>지연 초기화 로직을 대신 담당하고 있을 클래스를 만들어, 지연 초기화를 원하는 프로퍼티가 이 클래스를 사용하도록 하는 것이다. 이 <code>LazyInitProperty</code>를 사용하면 <code>Person</code> 클래스를 다음과 같이 변경할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">class</span> Person3 <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> delegateProperty <span class=\"token operator\">=</span> LazyInitProperty <span class=\"token punctuation\">{</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000L</span><span class=\"token punctuation\">)</span>\n        <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> delegateProperty<span class=\"token punctuation\">.</span>value\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>LazyInitProperty</code>를 활용하도록 변경된 Person 코드에서는, Person에 있는 getName이 실제 getter 로직을 갖고 있지 않고 단지 <code>LazyInitProperty</code>의 getter를 호출하고 있다. 이러한 패턴을 <strong>위임(Delegate) 패턴</strong>이라고 부른다. 다시 <code>by lazy</code>로 돌아와서, <code>by lazy</code> 역시 우리가 작성한 것과 완전히 동일한 원리를 갖고 있다. <code>by</code>라는 키워드는 <code>if</code>나 <code>when</code>처럼 Kotlin 언어에 존재하는 키워드로, 앞에 있는 프로퍼티의 getter나 setter를 뒤 클래스의 getter나 setter로 이어주는 역할을 한다. 프로퍼티를 위임하는 것이다. 그리고 이때 뒤에 위치한 클래스의 호출되는 getter / setter는 일반적인 getter / setter 와는 다르게 특별한 시그니처를 갖고 있어야 하고, 시그니처는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> R<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> T <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> R<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> T<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p><code>lazy</code>는 우리가 만든 <code>LazyInitProperty</code>의 <code>init: () -> T</code>처럼 함수를 받아 <code>Lazy</code>라는 객체를 만드는 함수이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">actual</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token function\">lazy</span><span class=\"token punctuation\">(</span>initializer<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> T<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Lazy<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">SynchronizedLazyImpl</span><span class=\"token punctuation\">(</span>initializer<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>그리고 바로 이 <code>Lazy</code> 인터페이스 구체적으로는 SynchronizedLazyImpl 객체가 실제 getter 로직을 수행하는 객체이다. 이렇게 다른 객체로 getter나 setter를 위임하는 프로퍼티를 위임 프로퍼티라 부르고, <code>by</code> 뒤에서 실제 getter나 setter를 수행하는 객체를 위임 객체라고 한다.</p>\n<p>이제 <code>getValue</code>와 <code>setValue</code>를 조금 더 자세하게 살펴보고, 이를 이용해 우리가 만들었던 <code>LazyInitProperty</code>를 코틀린 키워드 <code>by</code>와 함께 사용할 수 있도록 변경해 보자. 먼저 <code>getValue()</code>는 2가지 매개변수를 가지고 있다. 각 매개변수에 들어오는 값은 다음과 같다.</p>\n<ul>\n<li><code>thisRef: R</code> - 위임 프로퍼티를 갖고 있는 클래스의 인스턴스가 들어온다. 위의 예시로는 <code>Person</code> 인스턴스이다.</li>\n<li><code>property: KProperty&#x3C;*></code> - 위임 프로퍼티 정보가 들어온다. 위의 예시로는 <code>name</code> 필드이다.</li>\n</ul>\n<p>또한 getValue()는 <code>operator fun</code>이라는 특별한 지시어를 붙여야 한다. 그러면 한번 우리의 코드에 적용을 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> LazyInitProperty<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> <span class=\"token keyword\">init</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> T<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> _value<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    <span class=\"token keyword\">val</span> value<span class=\"token operator\">:</span> T\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_value <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_value <span class=\"token operator\">=</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_value<span class=\"token operator\">!!</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> T <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> value\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>이때 getValue()가 반드시 멤버 함수일 필요는 없고, 확장 함수로 제공되어도 괜찮다.</p>\n</blockquote>\n<p><code>setValue()</code>도 마찬가지다. 다만 다른 점은 setter인 만큼 변경하고 싶은 값을 받아야 하는데, 이를 <code>value: T</code>에 받게 된다.</p>\n<p>실제로, 우리가 만든 Person 클래스의 Decompile 코드를 확인해 보면 아래와 같으니 참고 바란다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Person</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">LazyInitProperty</span> name$delegate<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name$delegate<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> $$delegatedProperties<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>코틀린의 표준 위임 객체</h2>\n<p>이번에는 코틀린 표준 라이브러리에서 제공하는 위임 객체 함수와 종류에 대해 살펴보도록 하겠다.</p>\n<h3>notNull</h3>\n<p>가장 먼저 <code>notNull()</code> 함수이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>T <span class=\"token operator\">:</span> Any<span class=\"token operator\">></span> <span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token comment\">// 사용 예시</span>\n<span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> age<span class=\"token operator\">:</span> Int <span class=\"token keyword\">by</span> <span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>notNull()</code> 함수는 <code>lateinit</code>과 비슷한 역할을 한다. <code>var</code>로 설정된 age의 값을 여러번 변경할 수 있고 아직 age의 값이 설정되지 않았다면 내부적으로 null을 저장하고 있다. 만약 age의 값이 설정되지 않았는데 getter를 호출할 경우 <code>IllegalStatementException</code>이 호출된다. 대부분 경우, <code>lateinit</code>을 사용하면 되기에 <code>notNull()</code>을 쓸 필요는 없지만, <code>Int</code>나 <code>Long</code> 같은 primitive type에는\n<code>lateinit</code>을 사용할 수 없기 때문에 <code>notNull()</code>이 유용할 수 있다.</p>\n<h3>observable</h3>\n<p>다음으로 <code>observable</code> 함수이다. <code>observable()</code>은 프로퍼티의 값이 변경되는 경우, 추가적인 행동을 하고 싶을 때 활용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token comment\">// 간단히 표현한 observable 함수</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token function\">observable</span><span class=\"token punctuation\">(</span>\n    initialValue<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span>\n    onChange<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> oldValue<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span> newValue<span class=\"token operator\">:</span> T<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Unit\n<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 함수는 2가지 파라미터를 받을 수 있다.</p>\n<ul>\n<li>initialValue: 위임 프로퍼티의 초기값</li>\n<li>onChange: 파라미터의 setter가 적용되고 난 후 호출되는 함수. setter가 사용되기만 하면 onChange 함수가 호출 된다.\n<ul>\n<li>property: <code>observable()</code>이 적용된 위임 프로퍼티</li>\n<li>oldValue: 현재 값</li>\n<li>newValue: setter에 의해 들어온 새로운 값. oldValue와 같을 수 있다.</li>\n</ul>\n</li>\n</ul>\n<p><code>observable()</code>을 이용하면 아래와 같이 특정 프로퍼티의 setter가 호출될 때 이전값, 새로운 값을 로깅할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>Delegates\n\n<span class=\"token keyword\">class</span> Person5 <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> age<span class=\"token operator\">:</span> Int <span class=\"token keyword\">by</span> Delegates<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> _<span class=\"token punctuation\">,</span> oldValue<span class=\"token punctuation\">,</span> newValue <span class=\"token operator\">-></span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"이전 값: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">oldValue</span></span><span class=\"token string\">, 다음 값: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">newValue</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>vetoable</h3>\n<p>다음은 <code>vetoable</code>이다. <code>vetoable()</code> 함수는 <code>observable()</code> 함수와 굉장히 유사한 형태를 가지고 있으며, setter가 호출될 때 실제 값을 변경할 것인지 변경하지 않을지 선택할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token comment\">// 간단히 표현한 vetoable 함수</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">inline</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token function\">vetoable</span><span class=\"token punctuation\">(</span>\n    initialValue<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span>\n    onChange<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> oldValue<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span> newValue<span class=\"token operator\">:</span> T<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> Boolean\n<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>observable()</code>과 비슷한 파라미터 구성으로 이루어져 있다. 한 가지 차이점이라면, onChange 함수가 <code>Boolean</code>을 반환하는 것이다. setter가 호출될 때에 onChange 함수가 true를 반환하면 새로운 값으로 변경되고, false를 반환하면 이전 값 그대로 남게 된다.</p>\n<h3>또 다른 프로퍼티로 위임하기</h3>\n<p>프로퍼티 위임을 사용할 때 또 다른 프로퍼티를 사용할 수도 있다. 아래 코드를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> num<span class=\"token operator\">:</span> Int <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>이 코드에서는 <code>num</code>이라는 필드로 사람의 나이를 받고 있다. 하지만 이것이 age로 변경될 필요가 있어서 변경하려고 하니 기존 프로젝트에서 <code>num</code>을 쓰는 곳이 너무 많고 이미 배포가 되어 있다. 그런 경우 변경이 매우 위험하다. 그런 경우 아래와 같이 변경을 시킬 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n<span class=\"token annotation builtin\">@Deprecated</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"age를 사용하세요!\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token function\">ReplaceWith</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"age\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">var</span> num<span class=\"token operator\">:</span> Int <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token keyword\">var</span> age<span class=\"token operator\">:</span> Int <span class=\"token keyword\">by</span> <span class=\"token keyword\">this</span><span class=\"token operator\">::</span>num <span class=\"token comment\">// 위임할 프로퍼티 앞에 ::을 붙여 위임 객체로 활용할 수 있다.</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이렇게 프로퍼티 위임을 사용하면, num을 사용하고 있던 코드에서는 점진적으로 num 을 걷어내고 age 를 사용할 수 있다. 꼭 같은 클래스에 있는 프로퍼티만 위임할 수 있는 것은 아니고, 다른 클래스에 있는 프로퍼티 혹은 Top-Level 프로퍼티를 위임할 수 있다.</p>\n<h3>Map에 위임하기</h3>\n<p>코틀린에 존재하는 표준 컬렉션인 Map도 위임 객체가 될 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">Person</span><span class=\"token punctuation\">(</span>map<span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">,</span> Any<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> map\n    <span class=\"token keyword\">val</span> age<span class=\"token operator\">:</span> Int <span class=\"token keyword\">by</span> map\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>예를 들어 위의 코드를 살펴보자. 위의 코드에서 Person의 프로퍼티인 name과 age는 생성자를 통해 들어온 map에 의존하고 있다. 만약 외부에서 Person 의 name 에 접근하게 된다면, 주어진 map에서 key가 이름인 값을 찾아 반환하게 된다.</p>\n<h2>위임과 관련된 몇 가지 추가 기능</h2>\n<p>이번에는 위임과 관련된 몇 가지 추가 기능에 대해 살펴보자. 위임 객체를 만들기 위해 우리는 <code>operator fun getValue()</code> 또는 <code>operator fun setValue()</code>를 위임 객체의 함수로 가지고 있어야 한다. 물론 우리가 직접 함수를 추가할 수도 있지만, 코틀린은 getValue()와 setValue()를 갖고 있는 인터페이스를 제공한다. 바로 <code>ReadOnlyProperty</code>와 <code>ReadWriteProperty</code>이다.</p>\n<p>두 인터페이스는 단순히 <code>getValue</code>와 <code>setValue</code>를 가지고 있을 뿐이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">fun</span> <span class=\"token keyword\">interface</span> ReadOnlyProperty<span class=\"token operator\">&lt;</span><span class=\"token keyword\">in</span> T<span class=\"token punctuation\">,</span> <span class=\"token keyword\">out</span> V<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> V\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> ReadWriteProperty<span class=\"token operator\">&lt;</span><span class=\"token keyword\">in</span> T<span class=\"token punctuation\">,</span> V<span class=\"token operator\">></span> <span class=\"token operator\">:</span> ReadOnlyProperty<span class=\"token operator\">&lt;</span>T<span class=\"token punctuation\">,</span> V<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> V\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> T<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> V<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>우리가 만들었던 <code>LazyInitProperty</code>에 <code>ReadOnlyProperty</code> 인터페이스를 적용하면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>ReadOnlyProperty\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> LazyInitProperty<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> <span class=\"token keyword\">init</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> T<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ReadOnlyProperty<span class=\"token operator\">&lt;</span>Any<span class=\"token punctuation\">,</span> T<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> _value<span class=\"token operator\">:</span> T<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n    <span class=\"token keyword\">val</span> value<span class=\"token operator\">:</span> T\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_value <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_value <span class=\"token operator\">=</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_value<span class=\"token operator\">!!</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> T <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> value\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>크게 달라지는 부분은 없고, 우리가 getValue / setValue의 시그니처를 기억하지 않아도 된다는 소소한 장점이 있다.</p>\n<p>일회성으로 위임 객체를 만들어야 할 때 <code>ReadOnlyProperty</code>와 <code>ReadWriteProperty</code> 인터페이스를 유용하게 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>ReadOnlyProperty\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> Person3 <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> delegateProperty <span class=\"token operator\">=</span> LazyInitProperty <span class=\"token punctuation\">{</span>\n        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000L</span><span class=\"token punctuation\">)</span>\n        <span class=\"token string-literal singleline\"><span class=\"token string\">\"김수한무\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> delegateProperty<span class=\"token punctuation\">.</span>value\n\n    <span class=\"token keyword\">val</span> status<span class=\"token operator\">:</span> String <span class=\"token keyword\">by</span> <span class=\"token keyword\">object</span> <span class=\"token operator\">:</span> ReadOnlyProperty<span class=\"token operator\">&lt;</span>Person3<span class=\"token punctuation\">,</span> String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> isGreen <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\n        <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Person3<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isGreen<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                isGreen <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n                <span class=\"token string-literal singleline\"><span class=\"token string\">\"Happy\"</span></span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                isGreen <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                <span class=\"token string-literal singleline\"><span class=\"token string\">\"Sad\"</span></span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>ReadOnlyProperty</code> 인터페이스를 구현하는 익명 클래스를 만들어 일회성으로 위임 프로퍼티를 만들어보았다.</p>\n<p>다음으로 살펴볼 기능은 위임 프로퍼티와 위임 객체 사이를 연결할 때 로직을 끼워 넣는 방법이다. 예를 들어 우리가 위임 객체를 만들었는데, 이 위임 객체는 위임 프로퍼티의 이름이 “name”일 때만 정상 동작한다고 가정해 보자. 그럼 우리는 위임 프로퍼티에서 이 위임 객체를 사용할 때 위임 프로퍼티의 이름을 검증해 주어야 한다. 생각할 수 있는 첫 번째 방법은 다음과 같이 위임 객체를 생성할 때 프로퍼티 이름을 받아 검증하는 방법이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> Person <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name <span class=\"token keyword\">by</span> <span class=\"token function\">DelegateProperty</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"양성빈\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"name\"</span></span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">val</span> country <span class=\"token keyword\">by</span> <span class=\"token function\">DelegateProperty</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"한국\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"country\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token function\">DelegateProperty</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> initValue<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n    propertyName<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ReadOnlyProperty<span class=\"token operator\">&lt;</span>Any<span class=\"token punctuation\">,</span> String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">init</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>propertyName <span class=\"token operator\">!=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"name\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token function\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">propertyName</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">대신 name이라는 프로퍼티에만 사용할 수 있다.\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> initValue\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>하지만 이런 방법은 당연히 문자열로 프로퍼티 이름을 직접 넣어주어야 하기 때문에 번거롭고, 비슷한 요구사항이 나올 때마다 인터페이스를 변경하거나 추가적인 작업을 해주어야 한다. 때문에 코틀린에서는 위임 프로퍼티와 위임 객체를 연결할 때 중간 객체를 만들 수 있게 해준다. 그리고 이 중간 객체는 아래의 함수를 가지고 있어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">provideDelegate</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> R<span class=\"token punctuation\">,</span> prop<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> D</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li>thisRef: 위임 프로퍼티를 사용한 클래스</li>\n<li>prop: 위임이 적용된 프로퍼티</li>\n<li>D: getValue와 setValue를 가지고 있는 클래스 타입</li>\n</ul>\n<p>이것을 적용하면 아래와 같이 작성이 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>ReadOnlyProperty\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> <span class=\"token function\">DelegateProperty</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> initValue<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ReadOnlyProperty<span class=\"token operator\">&lt;</span>Any<span class=\"token punctuation\">,</span> String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> initValue\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>PropertyDelegateProvider\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> <span class=\"token function\">DelegateProvider</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> initValue<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">provideDelegate</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DelegateProperty <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"name\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token function\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"name에만 사용이 가능합니다!\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">DelegateProperty</span><span class=\"token punctuation\">(</span>initValue<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">class</span> Person6 <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name <span class=\"token keyword\">by</span> <span class=\"token function\">DelegateProvider</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"양성빈\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> country <span class=\"token keyword\">by</span> <span class=\"token function\">DelegateProvider</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"대한민국\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>프로퍼티와 위임객체를 연결하는 중간에 끼어드는 기능이 있어, 연결 과정에 필요한 로직을 담당할 수 있게 되는 것이다. <code>provideDelegate</code> 함수 역시 시그니처를 외우는 대신, <code>PropertyDelegateProvider</code>를 사용할 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>PropertyDelegateProvider\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">.</span>KProperty\n\n<span class=\"token keyword\">class</span> <span class=\"token function\">DelegateProvider</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> initValue<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> PropertyDelegateProvider<span class=\"token operator\">&lt;</span>Any<span class=\"token punctuation\">,</span> DelegateProperty<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">provideDelegate</span><span class=\"token punctuation\">(</span>thisRef<span class=\"token operator\">:</span> Any<span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> KProperty<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> DelegateProperty <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>property<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"name\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token function\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"name에만 사용이 가능합니다!\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token function\">DelegateProperty</span><span class=\"token punctuation\">(</span>initValue<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>다음으로 살펴 볼 것은 위임 클래스이다. 지금까지 우리는 <code>by</code>를 사용하여 프로퍼티에만 적용을 해보았는데 클래스에도 <code>by</code> 키워드를 사용할 수 있다. 한번 예제를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">interface</span> Fruit <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n    <span class=\"token keyword\">val</span> color<span class=\"token operator\">:</span> String\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">bite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> Apple <span class=\"token operator\">:</span> Fruit <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> color<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"빨간색\"</span></span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">bite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사과 톡톡~ 아삭~\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>과일을 표현하는 Fruit 인터페이스와 Apple 클래스가 존재한다. 이때 Apple과 기능이 거의 동일하자민 색깔만 다른 GreenApple을 만든다고 해보자. 그러면 단순하게 아래와 같이 만들 수 있을 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> GreenApple <span class=\"token operator\">:</span> Fruit <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> color<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"초록색\"</span></span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">bite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사과 톡톡~ 아삭~\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Fruit 인터페이스를 구현하여 만들었다. 매우 간단하지만 아쉬운 점은 Apple과 중복된 코드가 많다라는 것이다. 이런 중복을 없애기 위해 우리는 상속을 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">open</span> <span class=\"token keyword\">class</span> Apple <span class=\"token operator\">:</span> Fruit <span class=\"token punctuation\">{</span> <span class=\"token operator\">..</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> GreenApple <span class=\"token operator\">:</span> <span class=\"token function\">Apple</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> color<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"초록색\"</span></span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>코드가 확 줄었지만 조금 꺼림직한 부분이 남는다. 왜냐하면 불필요하게 Apple을 open해줬기 때문이다. “상속보다는 합성”이라는 격언이 있듯이 Apple 클래스를 상속가능하게 만드는 것이 나중에 어떤 side effect를 가져올지 확신할 수 없다. 이럴때 바로 합성, 그러니까 위임을 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">GreenApple3</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> apple<span class=\"token operator\">:</span> Apple<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> Fruit <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> apple<span class=\"token punctuation\">.</span>name\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> color<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"초록색\"</span></span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">bite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        apple<span class=\"token punctuation\">.</span><span class=\"token function\">bite</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>GreenApple 객체를 인스턴스화할 때 Apple의 객체를 받도록 하여 색깔만 초록색으로 바꾸고 다른 기능들은 본래 Apple의 기능을 그대로 가져왔다. 하지만 코드 양이 너무 늘어났다. 이런 번거로운 코드를 줄이기 위해서 코틀린 언어가 지원하는 클래스 위임 기능을 사용할 수 있다. 아래 코드는 위의 코드와 동일한 역할을 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> <span class=\"token function\">GreenApple4</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> apple<span class=\"token operator\">:</span> Apple<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> Fruit <span class=\"token keyword\">by</span> apple <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">val</span> color<span class=\"token operator\">:</span> String\n        <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"초록색\"</span></span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이처럼 코틀린의 by 키워드를 활용해 클래스 위임을 사용하면, 번거로운 준비 코드를 사용하지 않고도 객체 합성의 이점을 살릴 수 있다. 코틀린의 위임은 “상속보다는 합성”이라는 객체지향 설계 원칙을 사용하도록 장려하는 것이다.</p>\n<h2>Iterable과 Sequence (feat. JMH)</h2>\n<p>우리는 수백개, 수천개 데이터를 조작할 때 <code>List</code>와 같은 <code>Collection</code>을 사용한다. 아래 코드를 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> fruits <span class=\"token operator\">=</span> <span class=\"token function\">listOf</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">MyFruit</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">MyFruit</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"바나나\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">val</span> average <span class=\"token operator\">=</span> fruits\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>price <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">average</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">MyFruit</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> price<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위의 코드에 대하여 분석하면 다음과 같다.</p>\n<ul>\n<li>주어진 200만 건의 과일 중 사과를 골라 임시 <code>List&#x3C;Fruit></code>를 만든다.</li>\n<li>위에서 만들어진 임시 <code>List&#x3C;Fruit></code>에서 가격만 골라 <code>List&#x3C;Long></code>으로 만든다.</li>\n<li>위에서 만들어진 <code>List&#x3C;Long></code>에서 10,000개를 골라 평균을 구한다.</li>\n</ul>\n<p>이 원리를 보면 한 가지 큰 단점이 드러나는데, 바로 연산의 각 단계마다 중간 Collection이 계속 생성된다는 점이다. 만약 전체 과일의 20% 정도가 사과라고 한다면, 첫 번째 단계인 filter의 결과로 400,000개의 원소가 들어 있는 <code>List</code>가 생성되고, map 의 결과로 또다시 400,000개의 <code>List&#x3C;Long></code>이 생성된다. 이렇게 대용량의 데이터를 처리를 해야 하는 경우에 Kotlin은 <code>Iterable</code>과 비슷한 <code>Sequence</code>를 제공한다. 존재하는 Collection에 <code>Sequence</code>를 적용하고 싶다면, <code>asSequence()</code>를 활용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> fruits <span class=\"token operator\">=</span> <span class=\"token function\">listOf</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">MyFruit</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">MyFruit</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"바나나\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">val</span> average <span class=\"token operator\">=</span> fruits<span class=\"token punctuation\">.</span><span class=\"token function\">asSequence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>price <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">average</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">MyFruit</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> price<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Sequence 역시 Iterable 과 마찬가지로 filter / map / take 등 기본적인 함수를 제공하고 있기 때문에 익숙한 Iterable 과 동일한 코드를 사용할 수 있다. 이 Sequence는 Iterable과 다른 동작 방식으로 동작을 한다. 먼저 각 단계가 모든 원소에 대해 적용되지 않을 수 있다. 즉, Sequence는 한 원소에 대해서 가능한 모든 연산을 수행하고, 다음 원소에 대해 이를 반복한다. 또한 최종연산이 나오기 전까지 계산 자체를 미리하지 않는다. 예를 들어, filter와 map까지만 수행한다면 실제 원소를 필터링하고 매핑하는 작업 자체를 진행하지 않는 것이다. 이를 “지연 연산”이라 한다. 지금 코드에서는 average라는 최종 연산이 있기에 각 단계가 수행된다.</p>\n<p>그러면 위의 코드의 동작 방식을 살펴보겠다.</p>\n<ul>\n<li>fruits에 들어 있는 첫 번째 과일이 filter 에 들어간다.\n<ul>\n<li>이 과일이 만약 “사과”라면 map 과 take 를 거쳐 대기한다. 그리고 다음에 대해 1번 절차가 수행된다.</li>\n<li>“사과”가 아니라면 다음 과일로 넘어가 위의 과정을 반복한다.</li>\n</ul>\n</li>\n<li>위의 과정에 의해 총 10,000개가 모였다면 더 이상 filter 나 map 을 하지 않고 평균을 계산한다.</li>\n</ul>\n<p>즉, Iterable과 달리 임시 중간 컬렉션이 생기지 않아 대용량 처리를 할때 성능이 매우 뛰어나다. 그렇다면 정말 Sequence가 Iterable보다 빠를까?! 간단히 측정을 해 확인해 보자. 간단히 로깅을 찍어서 실행시간을 확인해볼 수 있지만 JVM에서 사용할 수 있는 micro bechmarking framework JMH를 이용해 보자.</p>\n<p>해당 플러그인을 적용하고 사용하는 방법은 매우 간단하다. 먼저 아래와 같이 gradle파일에 추가를 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\">plugins <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">kotlin</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"jvm\"</span></span><span class=\"token punctuation\">)</span> version <span class=\"token string-literal singleline\"><span class=\"token string\">\"2.3.0\"</span></span>\n    <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"me.champeau.jmh\"</span></span><span class=\"token punctuation\">)</span> version <span class=\"token string-literal singleline\"><span class=\"token string\">\"0.7.3\"</span></span>\n<span class=\"token punctuation\">}</span>\n\njmh <span class=\"token punctuation\">{</span>\n    threads <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    fork <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    warmupIterations <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    iterations <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>해당 플러그인 버전은 사용하고 있는 gradle 버전에 따라 차이가 존재한다. 따라서 <a href=\"https://github.com/melix/jmh-gradle-plugin\">공식문서</a>를 통해 확인해보자.</p>\n</blockquote>\n<p>실제 벤치마킹을 하고 싶은 코드는 <code>src/jmh/kotlin/패키지</code> 안에 넣으면 된다. JMH는 어노테이션을 이용해 다음과 같이 적용할 수 있고, 각 어노테이션의 의미는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-kotlin line-numbers\"><code class=\"language-kotlin\"><span class=\"token keyword\">package</span> me<span class=\"token punctuation\">.</span>sungbin<span class=\"token punctuation\">.</span>delegate\n\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>Benchmark\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>BenchmarkMode\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>Mode\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>OutputTimeUnit\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>Scope\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>Setup\n<span class=\"token keyword\">import</span> org<span class=\"token punctuation\">.</span>openjdk<span class=\"token punctuation\">.</span>jmh<span class=\"token punctuation\">.</span>annotations<span class=\"token punctuation\">.</span>State\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span>TimeUnit\n<span class=\"token keyword\">import</span> kotlin<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>Random\n\n<span class=\"token annotation builtin\">@State</span><span class=\"token punctuation\">(</span>Scope<span class=\"token punctuation\">.</span>Benchmark<span class=\"token punctuation\">)</span>\n<span class=\"token annotation builtin\">@BenchmarkMode</span><span class=\"token punctuation\">(</span>Mode<span class=\"token punctuation\">.</span>AverageTime<span class=\"token punctuation\">)</span>\n<span class=\"token annotation builtin\">@OutputTimeUnit</span><span class=\"token punctuation\">(</span>TimeUnit<span class=\"token punctuation\">.</span>NANOSECONDS<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">open</span> <span class=\"token keyword\">class</span> SequenceTest <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> fruits <span class=\"token operator\">=</span> mutableListOf<span class=\"token operator\">&lt;</span>Fruit<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token annotation builtin\">@Setup</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">2_000_000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span> <span class=\"token punctuation\">{</span> _ <span class=\"token operator\">-></span> fruits<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>Fruit<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation builtin\">@Benchmark</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">kotlinSequence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> average <span class=\"token operator\">=</span> fruits<span class=\"token punctuation\">.</span><span class=\"token function\">asSequence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>price <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">10_000</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">average</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation builtin\">@Benchmark</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">kotlinIterator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> average <span class=\"token operator\">=</span> fruits\n            <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>price <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">10_000</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">average</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Fruit</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> name<span class=\"token operator\">:</span> String<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">val</span> price<span class=\"token operator\">:</span> Long<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">companion</span> <span class=\"token keyword\">object</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> NAME_CANDIDATES <span class=\"token operator\">=</span> <span class=\"token function\">listOf</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"사과\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"바나나\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"수박\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"체리\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"오렌지\"</span></span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">fun</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Fruit <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> randNum1 <span class=\"token operator\">=</span> Random<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">val</span> randNum2 <span class=\"token operator\">=</span> Random<span class=\"token punctuation\">.</span><span class=\"token function\">nextLong</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20001</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token function\">Fruit</span><span class=\"token punctuation\">(</span>\n                name <span class=\"token operator\">=</span> NAME_CANDIDATES<span class=\"token punctuation\">[</span>randNum1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                price <span class=\"token operator\">=</span> randNum2<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><code>@State</code>\n<ul>\n<li>벤치마크에 사용되는 매개변수의 상태를 지정할 수 있다. <code>Scope.Benchmark</code>로 설정하면 SequenceTest 내의 인스턴스들이 스레드에서 같은 값을 공유한다.</li>\n</ul>\n</li>\n<li><code>@BenchmarkMode</code>\n<ul>\n<li>벤치마크 방식을 결정한다. <code>Mode.AverageTime</code>로 설정하면 각 함수를 몇 번 실행하여 평균 소요 시간을 측정한다.</li>\n</ul>\n</li>\n<li><code>@OutputTimeUnit</code>\n<ul>\n<li>벤치마크 결과를 어떤 단위로 표기할지 결정한다. <code>TimeUnit.MICROSECONDS</code>를 통해 <code>micro second (us)</code>단위를 지정했다.</li>\n</ul>\n</li>\n<li><code>@Setup</code>\n<ul>\n<li>벤치 마크 수행 전에 호출되어야 하는 메소드를 지정한다. 우리는 fruits를 여기서 만들어주었다.</li>\n</ul>\n</li>\n<li><code>@Benchmark</code>\n<ul>\n<li>실제 벤치마크 대상 함수를 지정한다.</li>\n</ul>\n</li>\n</ul>\n<p>JMH를 이용해 벤치마킹을 돌리려면, 터미널에 들어가 <code>./gradlew jmh</code>를 수행하면 된다. 그럼 JMH가 실행되고 결과가 <code>build/reports/jmh</code>에 <code>results.txt</code>로 나오게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.453125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/UlEQVQ4y52T227aQBRF/QghkKhKVbUJCRfjjD3GF8Yeg284JRcaoE2k9P8/ZVU2aaUolSr6sHRmjkZbe29pjPHpGebZJwbdEy47XfqtI/rtDpftDv1Wi/5Rl/GHj4xPThn1Tui32gyOe4zqe6eN1TvCPO0x7B5z1TnGSOMlkVoQumGDL33iQOE7PipI0HFBFBX4niYMEoJphLRnSEcxky6pJ7meSExTMnUUhhcowsDFtk2ktHAbJjiOQOkV5c2WtFijkhVJ9tDsAlXheBmOl2N7OdLPcYOC6azASCPBrjRZZ0NKfUERn1PqLyzUAFsmCCdppi3nf6ZT4y5w3DnSfT3Xu2mOkcyueVqOWGdXVMlerEo+k0ZXXNvxwRhxKHjMRxT6onFYs0zOSaMBwtEHY8ShZF0IqvmYLB425HrAXJkIJ94//IerN4KWHSKcgLEpMCd2w6TGcv/PYV2075cIoTEthWmFDMdew8RSWCI6rMNQFdzfP7G6/U5ZfaO8+UGS71iUO5JixdRP38X6O6+CaXbHZvvC+tszX283hPMtQfrCdL7DXaQHCOq9YFU8stn95HHzwsP6mbLaMs/WeLMllhO9E9tHi/ZViLiZ1u/IIsJQuiLN71hkt8TJEk9vENEzjt4htMaW+k1HtWMvLAmiCi/MCGb1t8zwggzpLfgF3f+RECsKB/8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image01\"\n        title=\"image01\"\n        src=\"/static/3e80625a8abaeb62fc9d330f41cbc28f/2bef9/01.png\"\n        srcset=\"/static/3e80625a8abaeb62fc9d330f41cbc28f/6f3f2/01.png 256w,\n/static/3e80625a8abaeb62fc9d330f41cbc28f/01e7c/01.png 512w,\n/static/3e80625a8abaeb62fc9d330f41cbc28f/2bef9/01.png 1024w,\n/static/3e80625a8abaeb62fc9d330f41cbc28f/71c1d/01.png 1536w,\n/static/3e80625a8abaeb62fc9d330f41cbc28f/a878e/01.png 2048w,\n/static/3e80625a8abaeb62fc9d330f41cbc28f/f24c5/01.png 3454w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","fields":{"slug":"/advanced-kotlin-지연과-위임/"},"timeToRead":18,"frontmatter":{"title":"[코틀린 고급] 지연과 위임","tags":["kotlin"],"date":"2026-02-20T15:55:27.000Z","image":{"publicURL":"/static/619e6175d83cd70c239721219e3cbc91/banner.png"},"series":"코틀린 고급"}}},"pageContext":{"id":"490ffa8e-7d8a-5a50-9fa8-8d5538632314"}},
    "staticQueryHashes": ["2580406332","3810308631"]}