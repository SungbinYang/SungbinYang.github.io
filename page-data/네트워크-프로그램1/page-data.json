{
    "componentChunkName": "component---src-template-post-tsx",
    "path": "/네트워크-프로그램1/",
    "result": {"data":{"allMarkdownRemark":{"nodes":[{"fields":{"slug":"/스트림API2-기능/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급3] 스트림 API2 - 기능","series":"자바 고급3"}},{"fields":{"slug":"/스트림API1-기본/"},"timeToRead":10,"frontmatter":{"title":"[자바 고급3] 스트림 API1 - 기본","series":"자바 고급3"}},{"fields":{"slug":"/메서드-참조/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급3] 메서드 참조","series":"자바 고급3"}},{"fields":{"slug":"/람다-vs-익명-클래스/"},"timeToRead":4,"frontmatter":{"title":"[자바 고급3] 람다 vs 익명 클래스","series":"자바 고급3"}},{"fields":{"slug":"/람다-활용/"},"timeToRead":18,"frontmatter":{"title":"[자바 고급3] 람다 활용","series":"자바 고급3"}},{"fields":{"slug":"/함수형-인터페이스/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급3] 함수형 인터페이스","series":"자바 고급3"}},{"fields":{"slug":"/람다/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급3] 람다","series":"자바 고급3"}},{"fields":{"slug":"/람다가-필요한-이유/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급3] 람다가 필요한 이유","series":"자바 고급3"}},{"fields":{"slug":"/HTTP-서버-활용/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급2] HTTP 서버 활용","series":"자바 고급2"}},{"fields":{"slug":"/애노테이션/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급2] 애노테이션","series":"자바 고급2"}},{"fields":{"slug":"/리플렉션/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급2] 리플렉션","series":"자바 고급2"}},{"fields":{"slug":"/HTTP-서버-만들기/"},"timeToRead":25,"frontmatter":{"title":"[자바 고급2] HTTP 서버 만들기","series":"자바 고급2"}},{"fields":{"slug":"/HTTP-기본-이론/"},"timeToRead":5,"frontmatter":{"title":"[자바 고급2] HTTP 기본 이론","series":"자바 고급2"}},{"fields":{"slug":"/채팅-프로그램/"},"timeToRead":21,"frontmatter":{"title":"[자바 고급2] 채팅 프로그램","series":"자바 고급2"}},{"fields":{"slug":"/네트워크-프로그램2/"},"timeToRead":16,"frontmatter":{"title":"[자바 고급2] 네트워크 프로그램2","series":"자바 고급2"}},{"fields":{"slug":"/네트워크-프로그램1/"},"timeToRead":18,"frontmatter":{"title":"[자바 고급2] 네트워크 프로그램1","series":"자바 고급2"}},{"fields":{"slug":"/네트워크-기본-이론/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급2] 네트워크 - 기본 이론","series":"자바 고급2"}},{"fields":{"slug":"/File-Files/"},"timeToRead":8,"frontmatter":{"title":"[자바 고급2] File, Files","series":"자바 고급2"}},{"fields":{"slug":"/IO-활용/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급2] I/O 활용","series":"자바 고급2"}},{"fields":{"slug":"/IO-기본2/"},"timeToRead":6,"frontmatter":{"title":"[자바 고급2] I/O 기본2","series":"자바 고급2"}},{"fields":{"slug":"/IO-기본1/"},"timeToRead":15,"frontmatter":{"title":"[자바 고급2] I/O 기본1","series":"자바 고급2"}},{"fields":{"slug":"/문자-인코딩/"},"timeToRead":10,"frontmatter":{"title":"[자바 고급2] 문자 인코딩","series":"자바 고급2"}},{"fields":{"slug":"/스레드-풀과-Executor-프레임워크2/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] 스레드 풀과 Executor 프레임워크2","series":"자바 고급1"}},{"fields":{"slug":"/스레드-풀과-Executor-프레임워크1/"},"timeToRead":20,"frontmatter":{"title":"[자바 고급1] 스레드 풀과 Executor 프레임워크1","series":"자바 고급1"}},{"fields":{"slug":"/동시성-컬렉션/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급1] 동시성 컬렉션","series":"자바 고급1"}},{"fields":{"slug":"/CAS-동기화와-원자적-연산/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] CAS - 동기화와 원자적 연산","series":"자바 고급1"}},{"fields":{"slug":"/생산자-소비자-문제2/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급1] 생산자 소비자 문제2","series":"자바 고급1"}},{"fields":{"slug":"/생산자-소비자-문제1/"},"timeToRead":14,"frontmatter":{"title":"[자바 고급1] 생산자 소비자 문제1","series":"자바 고급1"}},{"fields":{"slug":"/고급-동기화-concurrent-Lock/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급1] 고급 동기화 - concurrent.Lock","series":"자바 고급1"}},{"fields":{"slug":"/동기화-synchronized/"},"timeToRead":7,"frontmatter":{"title":"[자바 고급1] 동기화 - synchronized","series":"자바 고급1"}},{"fields":{"slug":"/메모리-가시성/"},"timeToRead":5,"frontmatter":{"title":"[자바 고급1] 메모리 가시성","series":"자바 고급1"}},{"fields":{"slug":"/스레드-제어와-생명주기2/"},"timeToRead":11,"frontmatter":{"title":"[자바 고급1] 스레드 제어와 생명주기2","series":"자바 고급1"}},{"fields":{"slug":"/스레드-제어와-생명주기1/"},"timeToRead":12,"frontmatter":{"title":"[자바 고급1] 스레드 제어와 생명주기1","series":"자바 고급1"}},{"fields":{"slug":"/스레드-생성과-실행/"},"timeToRead":8,"frontmatter":{"title":"[자바 고급1] 스레드 생성과 실행","series":"자바 고급1"}},{"fields":{"slug":"/프로세스와-스레드-소개/"},"timeToRead":9,"frontmatter":{"title":"[자바 고급1] 프로세스와 스레드 소개","series":"자바 고급1"}},{"fields":{"slug":"/컬렉션-프레임워크-순회-정렬-전체-정리/"},"timeToRead":16,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - 순회, 정렬, 전체 정리","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-Map-Stack-Queue/"},"timeToRead":7,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - Map, Stack, Queue","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-Set/"},"timeToRead":6,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - Set","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-HashSet/"},"timeToRead":11,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - HashSet","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-Hash/"},"timeToRead":6,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - Hash","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-List/"},"timeToRead":17,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - List","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-LinkedList/"},"timeToRead":14,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - LinkedList","series":"자바 중급2"}},{"fields":{"slug":"/컬렉션-프레임워크-ArrayList/"},"timeToRead":15,"frontmatter":{"title":"[자바 중급2] 컬렉션 프레임워크 - ArrayList","series":"자바 중급2"}},{"fields":{"slug":"/제네릭2/"},"timeToRead":14,"frontmatter":{"title":"[자바 중급2] 제네릭2","series":"자바 중급2"}},{"fields":{"slug":"/제네릭1/"},"timeToRead":9,"frontmatter":{"title":"[자바 중급2] 제네릭1","series":"자바 중급2"}},{"fields":{"slug":"/예외처리2-실습/"},"timeToRead":17,"frontmatter":{"title":"[자바 중급1] 예외처리2 - 실습","series":"자바 중급1"}},{"fields":{"slug":"/예외처리1-이론/"},"timeToRead":12,"frontmatter":{"title":"[자바 중급1] 예외처리1 - 이론","series":"자바 중급1"}},{"fields":{"slug":"/중첩-클래스-내부-클래스2/"},"timeToRead":9,"frontmatter":{"title":"[자바 중급1] 중첩 클래스, 내부 클래스2","series":"자바 중급1"}},{"fields":{"slug":"/중첩-클래스-내부-클래스1/"},"timeToRead":11,"frontmatter":{"title":"[자바 중급1] 중첩 클래스, 내부 클래스1","series":"자바 중급1"}},{"fields":{"slug":"/날짜와-시간/"},"timeToRead":24,"frontmatter":{"title":"[자바 중급1] 날짜와 시간","series":"자바 중급1"}},{"fields":{"slug":"/열거형-enum/"},"timeToRead":7,"frontmatter":{"title":"[자바 중급1] 열거형-enum","series":"자바 중급1"}},{"fields":{"slug":"/래퍼-Class-클래스/"},"timeToRead":11,"frontmatter":{"title":"[자바 중급1] 래퍼, Class 클래스","series":"자바 중급1"}},{"fields":{"slug":"/String-클래스/"},"timeToRead":10,"frontmatter":{"title":"[자바 중급1] String 클래스","series":"자바 중급1"}},{"fields":{"slug":"/불변-객체/"},"timeToRead":7,"frontmatter":{"title":"[자바 중급1] 불변 객체","series":"자바 중급1"}},{"fields":{"slug":"/Object-클래스/"},"timeToRead":10,"frontmatter":{"title":"[자바 중급1] Object 클래스","series":"자바 중급1"}},{"fields":{"slug":"/다형성과-설계/"},"timeToRead":5,"frontmatter":{"title":"[자바 기본] 다형성과 설계","series":"자바 기본"}},{"fields":{"slug":"/다형성2/"},"timeToRead":10,"frontmatter":{"title":"[자바 기본] 다형성2","series":"자바 기본"}},{"fields":{"slug":"/다형성1/"},"timeToRead":8,"frontmatter":{"title":"[자바 기본] 다형성1","series":"자바 기본"}},{"fields":{"slug":"/상속/"},"timeToRead":7,"frontmatter":{"title":"[자바 기본] 상속","series":"자바 기본"}},{"fields":{"slug":"/final/"},"timeToRead":4,"frontmatter":{"title":"[자바 기본] final","series":"자바 기본"}},{"fields":{"slug":"/자바-메모리-구조와-static/"},"timeToRead":10,"frontmatter":{"title":"[자바 기본] 자바 메모리 구조와 static","series":"자바 기본"}},{"fields":{"slug":"/접근-제어자/"},"timeToRead":5,"frontmatter":{"title":"[자바 기본] 접근 제어자","series":"자바 기본"}},{"fields":{"slug":"/패키지/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 패키지","series":"자바 기본"}},{"fields":{"slug":"/생성자/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 생성자","series":"자바 기본"}},{"fields":{"slug":"/객체-지향-프로그래밍/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 객체 지향 프로그래밍","series":"자바 기본"}},{"fields":{"slug":"/기본형과-참조형/"},"timeToRead":8,"frontmatter":{"title":"[자바 기본] 기본형과 참조형","series":"자바 기본"}},{"fields":{"slug":"/클래스와-데이터/"},"timeToRead":6,"frontmatter":{"title":"[자바 기본] 클래스와 데이터","series":"자바 기본"}},{"fields":{"slug":"/99클럽-day10/"},"timeToRead":2,"frontmatter":{"title":"[99클럽] 면접반 10일차","series":"면접"}},{"fields":{"slug":"/99클럽-day9/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 9일차","series":"면접"}},{"fields":{"slug":"/메서드/"},"timeToRead":8,"frontmatter":{"title":"[자바 입문] 메서드","series":"자바 입문"}},{"fields":{"slug":"/배열/"},"timeToRead":7,"frontmatter":{"title":"[자바 입문] 배열","series":"자바 입문"}},{"fields":{"slug":"/훈련/"},"timeToRead":3,"frontmatter":{"title":"[자바 입문] 훈련","series":"자바 입문"}},{"fields":{"slug":"/스코프-형변환/"},"timeToRead":5,"frontmatter":{"title":"[자바 입문] 스코프, 형변환","series":"자바 입문"}},{"fields":{"slug":"/반복문/"},"timeToRead":6,"frontmatter":{"title":"[자바 입문] 반복문","series":"자바 입문"}},{"fields":{"slug":"/조건문/"},"timeToRead":7,"frontmatter":{"title":"[자바 입문] 조건문","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day8/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 8일차","series":"면접"}},{"fields":{"slug":"/책-관리-예제-백엔드-개발/"},"timeToRead":6,"frontmatter":{"title":"[스프링 입문] 책 관리 예제 - 백엔드 개발","series":"스프링"}},{"fields":{"slug":"/연산자/"},"timeToRead":6,"frontmatter":{"title":"[자바 입문] 연산자","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day7/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 7일차","series":"면접"}},{"fields":{"slug":"/변수/"},"timeToRead":8,"frontmatter":{"title":"[자바 입문] 변수","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day6/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 6일차","series":"면접"}},{"fields":{"slug":"/스프링-웹-개발-기초/"},"timeToRead":2,"frontmatter":{"title":"[스프링 입문] 스프링 웹 개발 기초","series":"스프링"}},{"fields":{"slug":"/프로젝트-환경설정/"},"timeToRead":5,"frontmatter":{"title":"[스프링 입문] 프로젝트 환경 설정","series":"스프링"}},{"fields":{"slug":"/Hello-World/"},"timeToRead":6,"frontmatter":{"title":"[자바 입문] Hello World","series":"자바 입문"}},{"fields":{"slug":"/99클럽-day5/"},"timeToRead":2,"frontmatter":{"title":"[99클럽] 면접반 5일차","series":"면접"}},{"fields":{"slug":"/99클럽-day4/"},"timeToRead":1,"frontmatter":{"title":"[99클럽] 면접반 4일차","series":"면접"}},{"fields":{"slug":"/Multi-Modules-프로젝트/"},"timeToRead":12,"frontmatter":{"title":"[Gradle] Multi Modules 프로젝트","series":"gradle"}},{"fields":{"slug":"/99클럽-day3/"},"timeToRead":3,"frontmatter":{"title":"[99클럽] 면접반 3일차","series":"면접"}},{"fields":{"slug":"/Core-Type에-대한-이해/"},"timeToRead":7,"frontmatter":{"title":"[Gradle] Core Type에 대한 이해","series":"gradle"}},{"fields":{"slug":"/99클럽-day2/"},"timeToRead":2,"frontmatter":{"title":"[99클럽] 면접반 2일차","series":"면접"}},{"fields":{"slug":"/Groovy-언어의-기본/"},"timeToRead":8,"frontmatter":{"title":"[Gradle] Groovy 언어의 기본","series":"gradle"}},{"fields":{"slug":"/99클럽-day1/"},"timeToRead":6,"frontmatter":{"title":"[99클럽] 면접반 1일차","series":"면접"}},{"fields":{"slug":"/Gradle-기본/"},"timeToRead":9,"frontmatter":{"title":"[Gradle] Gradle 기본","series":"gradle"}},{"fields":{"slug":"/중요한-것은-포기하지-않는-마음/"},"timeToRead":3,"frontmatter":{"title":"2025년 1분기 회고(feat. 중요한 것은 포기하지 않는 마음)","series":"일상 이야기"}},{"fields":{"slug":"/Gradle-Introduction/"},"timeToRead":4,"frontmatter":{"title":"[Gradle] Introduction","series":"gradle"}},{"fields":{"slug":"/IntelliJ-플러그인/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 플러그인","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-Git-Github/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ IDEA] Git & Github","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-디버깅/"},"timeToRead":3,"frontmatter":{"title":"[IntelliJ IDEA] 디버깅","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-리팩토링/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 리팩토링","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-자동완성/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 자동완성","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-검색/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 검색","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-포커스/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 포커스","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-코드-Edit/"},"timeToRead":4,"frontmatter":{"title":"[IntelliJ IDEA] 코드 Edit","series":"인텔리제이"}},{"fields":{"slug":"/IntelliJ-소개/"},"timeToRead":2,"frontmatter":{"title":"[IntelliJ IDEA] 소개","series":"인텔리제이"}},{"fields":{"slug":"/2024년-주니어-개발자-회고록/"},"timeToRead":3,"frontmatter":{"title":"2024년 주니어 개발자 회고록","series":"일상 이야기"}},{"fields":{"slug":"/WDD/"},"timeToRead":1,"frontmatter":{"title":"WDD(Why-Driven-Development)","series":"생각정리"}},{"fields":{"slug":"/내가-개발자-커리어를-시작한-이유/"},"timeToRead":4,"frontmatter":{"title":"내가 개발자 커리어를 시작한 이유","series":"일상"}},{"fields":{"slug":"/블로그-이관-및-회고/"},"timeToRead":3,"frontmatter":{"title":"블로그 이관 및 회고","series":"일상 이야기"}},{"fields":{"slug":"/Spring-Boot-3.2.x-더-이상-바이트코드를-구문-분석하여-매개변수-이름을-추론하려고-시도하지-않습니다/"},"timeToRead":3,"frontmatter":{"title":"Spring Boot 3.2.x 더 이상 바이트코드를 구문 분석하여 매개변수 이름을 추론하려고 시도하지 않습니다.","series":"트러블 슈팅"}},{"fields":{"slug":"/라떼-개발자/"},"timeToRead":2,"frontmatter":{"title":"라떼 개발자","series":"생각정리"}},{"fields":{"slug":"/2023년-주니어-개발자-회고록/"},"timeToRead":5,"frontmatter":{"title":"2023년 주니어 개발자 회고록","series":"일상 이야기"}}],"group":[{"fieldValue":"gradle","totalCount":5},{"fieldValue":"면접","totalCount":10},{"fieldValue":"생각정리","totalCount":2},{"fieldValue":"스프링","totalCount":3},{"fieldValue":"인텔리제이","totalCount":9},{"fieldValue":"일상","totalCount":1},{"fieldValue":"일상 이야기","totalCount":4},{"fieldValue":"자바 고급1","totalCount":13},{"fieldValue":"자바 고급2","totalCount":14},{"fieldValue":"자바 고급3","totalCount":8},{"fieldValue":"자바 기본","totalCount":12},{"fieldValue":"자바 입문","totalCount":9},{"fieldValue":"자바 중급1","totalCount":10},{"fieldValue":"자바 중급2","totalCount":10},{"fieldValue":"트러블 슈팅","totalCount":1}]},"markdownRemark":{"id":"88602fce-4bcb-55a4-9801-7826abd0d4d7","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApUlEQVQoz6WRPQvCQAyG+///R6GKm6AndhIcrNaiXVzEaqVaPym9Xs67XuIgiEvFw2whPDxJXof+KOf7uD4cUWtLGJGIHpMA2PDdWpgBqRyNOfMVkTHmV/ilSW7QjfPF+hRnpVC1hVkb3Nxla54NVpczVw1bN8Co9TbJw7QIdsX+Wtk9DHklXU+3O6bXl66HIG1gIQTzIVrCNJSzCJWyzLnp0A/4CfW+SjF6WKSqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"배너 이미지\"\n        title=\"배너 이미지\"\n        src=\"/static/3189e9c0404650ccc6c5ffc998bc8717/2bef9/banner.png\"\n        srcset=\"/static/3189e9c0404650ccc6c5ffc998bc8717/6f3f2/banner.png 256w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/01e7c/banner.png 512w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/2bef9/banner.png 1024w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/71c1d/banner.png 1536w,\n/static/3189e9c0404650ccc6c5ffc998bc8717/e8950/banner.png 2000w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>해당 블로그 글은 <a href=\"https://inf.run/vskmA\">영한님의 인프런 강의</a>를 바탕으로 쓰여진 글입니다.</p>\n</blockquote>\n<h2>네트워크 프로그램1 - 예제</h2>\n<p>이번에는 간단한 네트워크 프로그램을 만들면서 이론 공부도 같이 해보자. 프로그램은 단순히 클라이언트에서 메세지를 보내면 서버에서 그 메세지에 \"World!\"라는 문자열을 붙여서 다시 전달하는 단순한 프로그램이다. 그럼 본격적으로 들어가보자.</p>\n<p>프로그램 코드를 작성하기 전에 먼저 멀티스레드 포스팅때 사용했던 로그를 사용해보겠다. 나중에 스레드를 여러개 만들고 로그를 찍어보기 위해서 재사용 하는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">util</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">LocalTime</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">.</span>format<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DateTimeFormatter</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyLogger</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">DateTimeFormatter</span> formatter <span class=\"token operator\">=</span> <span class=\"token class-name\">DateTimeFormatter</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofPattern</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HH:mm:ss.SSS\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> time <span class=\"token operator\">=</span> <span class=\"token class-name\">LocalTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>formatter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s [%9s] %s\\n\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>다음으로 클라이언트 코드를 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataInputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataOutputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientV1</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"클라이언트 시작\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataInputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataOutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"소켓 연결: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> toSend <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span><span class=\"token punctuation\">;</span>\n        output<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client -> server: \"</span> <span class=\"token operator\">+</span> toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> received <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client &lt;- server: \"</span> <span class=\"token operator\">+</span> received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"연결 종료: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        input<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        output<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>서버와 연결을 진행하려면 <code>Socket</code>이라는 클래스를 사용해야 한다. 첫번째 인자로 연결할 서버의 주소를 적어주고 두번째 인자로 포트 번호를 적어주면 된다. 이와 같은 이유로 클라이언트를 혼자 실행하면 예외가 발생한다. 그래서 서버 코드가 반드시 필요하다. 이제 서버쪽을 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataInputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataOutputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerV1</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서버 시작\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서버 소켓 시작 - 리스닝 포트: \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"소켓 연결: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataInputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataOutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> received <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client -> server: \"</span> <span class=\"token operator\">+</span> received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> toSend <span class=\"token operator\">=</span> received <span class=\"token operator\">+</span> <span class=\"token string\">\" World!\"</span><span class=\"token punctuation\">;</span>\n        output<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client &lt;- server: \"</span> <span class=\"token operator\">+</span> toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"연결 종료: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        input<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        output<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>서버를 실행하려면 <code>ServerSocket</code>이라는 클래스를 생성하고 인자로 포트번호를 작성해주면 된다. 그리고 <code>accept</code>라는 메서드에서 서버는 자기한테 연결되는 클라이언트가 있을 때까지 대기를 한다. 만약 연결이 되면 그 아래의 로직들을 수행하는 것이다.</p>\n<h3>localhost</h3>\n<ul>\n<li><code>localhost</code>는 현재 사용 중인 컴퓨터 자체를 가리키는 특별한 호스트 이름이다.\n<ul>\n<li><code>google.com</code>,<code>naver.com</code>과 같은 호스트 이름이지만, 자기 자신의 컴퓨터를 뜻하는 이름이다.</li>\n</ul>\n</li>\n<li><code>localhost</code>는 127.0.0.1이라는 IP로 매핑된다.</li>\n<li>127.0.0.1은 IP 주소 체계에서 루프백 주소(loopback address)로 지정된 특별한 IP 주소이다. 이 주소는 컴퓨터가 스스로를 가리킬 때 사용되며, \"localhost\"와 동일하게 취급된다.</li>\n<li>127.0.0.1은 컴퓨터가 네트워크 인터페이스를 통해 외부로 나가지 않고, 자신에게 직접 네트워크 패킷을 보낼 수 있도록 한다.</li>\n</ul>\n<blockquote>\n<p>⚠️ 주의</p>\n<p>만약 <code>localhost</code> 가 잘 되지 않는다면, 자신의 PC의 운영체제에 <code>localhost</code>가 127.0.0.1로 매핑되어 있지 않은 문제이다. 이 경우 <code>localhost</code> 대신에 127.0.0.1을 직접 입력하면 된다.</p>\n</blockquote>\n<blockquote>\n<p>⚠️ 주의</p>\n<p>서버를 시작하지 않고, 클라이언트만 실행하면 해당 예외가 발생한다.(<code>java.net.ConnectException: Connection refused</code>)</p>\n</blockquote>\n<blockquote>\n<p>⚠️ 주의</p>\n<ul>\n<li><code>Exception in thread \"main\" java.net.BindException: Address already in use</code></li>\n<li>만약 이런 예외가 발생한다면, 이미 12345라는 포트를 다른 프로세스가 사용하고 있다는 뜻이다. 포트를 다른 숫자로 변경해서 사용하자.</li>\n<li>우리가 작성한 서버 프로그램을 아직 종료하지 않은 상태로 다시 실행하는 경우에도 12345 포트를 이미 점유하고 있으므로 같은 예외가 발생할 수 있다.</li>\n</ul>\n</blockquote>\n<p>그럼 이제 위에서 작성한 코드들을 하나씩 분석해보자.</p>\n<h2>네트워크 프로그램1 - 분석</h2>\n<p>TCP/IP 통신에서는 통신할 대상 서버를 찾을 때 호스트 이름이 아니라, IP 주소가 필요하다. 네트워크 프로그램을 분석하기 전에 먼저 호스트 이름으로 IP를 어떻게 찾는지 확인해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">InetAddress</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">UnknownHostException</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">InetAddressMain</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UnknownHostException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">InetAddress</span> localhost <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>localhost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">InetAddress</span> google <span class=\"token operator\">=</span> <span class=\"token class-name\">InetAddress</span><span class=\"token punctuation\">.</span><span class=\"token function\">getByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"google.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>google<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>자바의 <code>InetAddress</code> 클래스를 사용하면 호스트 이름으로 대상 IP를 찾을 수 있다. 찾는 과정은 아래와 같다.</p>\n<ul>\n<li>자바는 <code>InetAddress.getByName(\"호스트명\")</code> 메서드를 사용해서 해당하는 IP 주소를 조회한다.</li>\n<li>이 과정에서 시스템의 호스트 파일을 먼저 확인한다.\n<ul>\n<li><code>/etc/hosts</code> (리눅스, mac)</li>\n<li><code>C:\\Windows\\System32\\drivers\\etc\\hosts</code> (윈도우,Windows)</li>\n</ul>\n</li>\n<li>호스트 파일에 정의되어 있지 않다면, DNS 서버에 요청해서 IP 주소를 얻는다.</li>\n</ul>\n<h3>클라이언트 코드 분석</h3>\n<p>클라이언트와 서버 연결은 <code>Socket</code>을 이용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><code>localhost</code>를 통해 자신의 컴퓨터에 있는 12345 포트에 TCP 접속을 시도한다.\n<ul>\n<li><code>localhost</code>는 IP가 아니므로 해당하는 IP를 먼저 찾는다. 내부에서 <code>InetAddress</code>를 사용한다.</li>\n<li><code>localhost</code>는 127.0.0.1이라는 IP에 매핑되어 있다.</li>\n<li><code>127.0.0.1:12345</code>에 TCP 접속을 시도한다.</li>\n</ul>\n</li>\n<li>연결이 성공적으로 완료되면 <code>Socket</code> 객체를 반환한다.</li>\n<li><code>Socket</code>은 서버와 연결되어 있는 연결점이라고 생각하면 된다.</li>\n<li><code>Socket</code> 객체를 통해서 서버와 통신할 수 있다.</li>\n</ul>\n<p>클라이언트와 서버의 데이터 통신은 소켓 사이에 스트림을 통하여 진행을 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2klEQVQ4y62TPW8TQRCGr4ggDo7t3du9L9tnYZ/P9jkOJ4yIUYxMB4pAyodwEwkkKhekwBENHQW0NPwKOhoKZCRqSn4KNdKDdlGCkQiyEMXc7ey988zs7YyjlOIi01qvtLdsjuu6/DKF0h7a81BKI6W0diY2GuObt9ae1RrdWbwFep6H7/v4foDWCrdcpFws4IoyjUaDMAzPgUZr9oxeVErIUgElyjbW7JnvThRFdmFg1UaT7fEDtnbvk2zdoN1OiOPYHtNUEEYRSdKimWbkkwNuT0/Jdu6iXIHn+RiWEwQBQkiK62tcv/eE+Uc4ef+d3f0ZWbdN0m6fV2mAaZoyvDXhzvELTj/B4csPlDYuURECw7JA6So2C2vs7J8wX8Ds3TfGBzOyXodOp0u1WrXAer1OlvXJhzcZHz3l+Wd4+GpBubiOkK5N7JiHqXBz4zLd0R6P3n7l+M0XRnuPSZMmrVZiM9sKw5BW8yrbwxGT6TOmrxeMjuaUigWElD+BRtyIY67lOXG9hq8k2hX2FoUQv92yMeObYG38yhUiX5EkiYXZIxtRr9cjz3P6/T5+EOCu2HPa8+0vGAwG1Go1m8xZ7i8p3b8C/mTLfWz7cNUJWHWinH+FXDh6/xv4AxvdYtDxAurHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image1\"\n        title=\"image1\"\n        src=\"/static/26db84348c8178ee450f844f9a1ae881/2bef9/01.png\"\n        srcset=\"/static/26db84348c8178ee450f844f9a1ae881/6f3f2/01.png 256w,\n/static/26db84348c8178ee450f844f9a1ae881/01e7c/01.png 512w,\n/static/26db84348c8178ee450f844f9a1ae881/2bef9/01.png 1024w,\n/static/26db84348c8178ee450f844f9a1ae881/f3abf/01.png 1474w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">DataInputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">DataOutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<ul>\n<li><code>Socket</code>은 서버와 데이터를 주고 받기 위한 스트림을 제공한다.</li>\n<li><code>InputStream</code> : 서버에서 전달한 데이터를 클라이언트가 받을 때 사용한다.</li>\n<li><code>OutputStream</code> : 클라이언트에서 서버에 데이터를 전달할 때 사용한다.</li>\n<li><code>InputStream</code> , <code>OutputStream</code> 을 그대로 사용하면 모든 데이터를 byte로 변환해서 전달해야 하기 때문에 번거롭다. 여기서는 <code>DataInputStream</code>,<code>DataOutputStream</code>이라는 보조 스트림을 사용해서, 자바 타입의 메시지를 편리하게 주고 받을 수 있도록 했다.</li>\n</ul>\n<p>지금까지 클라이언트 코드의 핵심부분을 살펴보았다. 나머지는 이전 스트림 시간에 살펴보았고 자원정리도 <code>close()</code> 메서드를 호출하여 정리한다는 사실도 이제는 알 것이다. 그럼 다음으로 서버 코드를 분석해보자.</p>\n<h3>서버 코드 분석</h3>\n<p>서버는 특정 포트를 열어두어야 한다. 그래야 클라이언트가 해당 포트를 지정해서 접속할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li>서버는 서버 소켓(<code>ServerSocket</code>)이라는 특별한 소켓을 사용한다.</li>\n<li>지정한 포트를 사용해서 서버 소켓을 생성하면, 클라이언트는 해당 포트로 서버에 연결할 수 있다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.90625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACRUlEQVQ4y41Uy24TQRA0UgBhZHsfM7M7u/b6hdePZP2QHdngBEUQpBxyig+5IXGAKwf4CAR3voA7HwDiL/ieQtVmgg8k8qHUo/V0dXV1e0pKKYRhCKU0tIlgIosotojj+AbWWtjEQhkFpRVCFUKFClpryXUgV8kYgyRJYUIP3uMDeOUDHPY7eLZeYzqdYj6fY7VaYV7MUX1Yha5oxCZGmqbodrtSLEkSkIekpSRN4XsVDFcXOH/7Ga/efcF68x5h4EEbI1W10RhdjjC+HmO0GcLmFoEXbJUqJSCpKEzrDTy6fw9nbz7h4y/gw0/g9dffCKplsUAFCnEzxvNvpzj7foaXP15gcDVA5UEFXuChVqsJoigSC0rWJkgSi95wgqOnF5ieXqI3XiEIfLmglRbf8vMck80YxdURWoctZPUMURxJ61SXZdlWIfvudDrIe08QehXUKmXERoknvu8LeCezGYp+gePJMWaTGZbLJWazGU5OTrBYLOQcBAFKZOXB9wNobcQ3xnq9jna7jV6vhzzPxS8qYqx5NVHPYtVqVWD++l1ypu6CBTi9oihkyqPRSJLpE9eIitmmWxU3FJny/wjdbnre1nSSUQFBwmazKSAJPSSo+FaFDrxEVTTcJZKEVjhCgvbcrM1dhK4VqqKXbJ3LPBgMMBwOZZj9fh+NRkOK3dnyLiFbpQqXuHtmlL+mtfsrdF7eBv7OLvYiZGX3CLhh7e6n+7a3QpK5ltyE6R+947Dca8Th7eXhv+dtG5nYarWE2JHs3vkDS+unkw5KWNoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image2\"\n        title=\"image2\"\n        src=\"/static/d25974d945d3bbf1c3622018fa1f67e2/2bef9/02.png\"\n        srcset=\"/static/d25974d945d3bbf1c3622018fa1f67e2/6f3f2/02.png 256w,\n/static/d25974d945d3bbf1c3622018fa1f67e2/01e7c/02.png 512w,\n/static/d25974d945d3bbf1c3622018fa1f67e2/2bef9/02.png 1024w,\n/static/d25974d945d3bbf1c3622018fa1f67e2/c211c/02.png 1502w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>서버가 12345 포트로 서버 소켓을 열어둔다. 클라이언트는 이제 12345 포트로 서버에 접속할 수 있다.</li>\n<li>클라이언트가 12345 포트에 연결을 시도한다.</li>\n<li>이때 OS 계층에서 TCP 3 way handshake가 발생하고, TCP 연결이 완료된다.</li>\n<li>TCP 연결이 완료되면 서버는 OS backlog queue라는 곳에 클라이언트와 서버의 TCP 연결 정보를 보관한다.\n<ul>\n<li>이 연결 정보를 보면 클라이언트의 IP, PORT, 서버의 IP, PORT 정보가 모두 들어있다.</li>\n</ul>\n</li>\n</ul>\n<p>TCP 연결시에는 클라이언트 서버 모두 IP, 포트 정보가 필요하다. 그런데 생각해보면 클라이언트 자신의 포트를 지정한 적이 없다. 서버의 경우 포트가 명확하게 지정되어 있어야 한다. 그래야 클라이언트에서 서버에 어떤 포트에 접속할지 알 수 있다. 반면에 서버에 접속하는 클라이언트의 경우에는 자신의 포트가 명확하게 지정되어 있지 않아도 된다. 클라이언트는 보통 포트를 생략하는데, 생략할 경우 클라이언트 PC에 남아 있는 포트 중 하나가 랜덤으로 할당된다. 참고로 클라이언트의 포트도 명시적으로 할당할 수는 있지만 잘 사용하지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li>서버 소켓은 단지 클라이언트와 서버의 TCP 연결만 지원하는 특별한 소켓이다.</li>\n<li>실제 클라이언트와 서버가 정보를 주고 받으려면 <code>Socket</code> 객체가 필요하다. (서버 소켓이 아니다! 소켓이다!)</li>\n<li><code>serverSocket.accept()</code> 메서드를 호출하면 TCP 연결 정보를 기반으로, <code>Socket</code> 객체를 만들어서 반환한다.</li>\n</ul>\n<p>즉, <code>ServerSocket</code>이 <code>accept()</code> 메서드를 호출하면 backlog queue에 TCP 연결 정보를 조회하고 만약 TCP 연결정보가 없다면 연결정보가 생성될 때까지 대기한다.(블로킹) 해당 정보를 기반으로 <code>Socket</code>객체를 생성하고 사용된 TCP정보는 backlog queue에서 제거된다.</p>\n<p>이제 프로그램 분석은 끝났다. 하지만 현재 프로그램에는 작은 문제가 하나 있다. 이 프로그램은 메시지를 하나만 주고 받으면 클라이언트와 서버가 모두 종료된다. 메시지를 계속 주고 받고, 원할 때 종료할 수 있도록 변경해보자.</p>\n<h2>네트워크 프로그램2 - 예제</h2>\n<p>이번에는 클라이언트에 \"Hello\" 문자 이외에 사용자가 입력한 문자를 서버에게 보내고 \"exit\"라고 보내면 종료되게끔 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataInputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataOutputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Scanner</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ClientV2</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"클라이언트 시작\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Socket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataInputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataOutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"소켓 연결: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Scanner</span> scanner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"전송할 문자: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">String</span> toSend <span class=\"token operator\">=</span> scanner<span class=\"token punctuation\">.</span><span class=\"token function\">nextLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            output<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client -> server: \"</span> <span class=\"token operator\">+</span> toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>toSend<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"exit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token class-name\">String</span> received <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client &lt;- server: \"</span> <span class=\"token operator\">+</span> received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"연결 종료: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        input<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        output<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        scanner<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>클라이언트와 서버간 메세지를 주고받으려면 단순히 <code>while</code>문과 같은 반복문을 계속 돌려주면 된다. 그리고 입력한 문자가 \"exit\"일때는 반복문을 빠져나가게끔 변경하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataInputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataOutputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerV2</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서버 시작\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서버 소켓 시작 - 리스닝 포트: \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"소켓 연결: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataInputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DataOutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> received <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client -> server: \"</span> <span class=\"token operator\">+</span> received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>received<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"exit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token class-name\">String</span> toSend <span class=\"token operator\">=</span> received <span class=\"token operator\">+</span> <span class=\"token string\">\" World!\"</span><span class=\"token punctuation\">;</span>\n            output<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client &lt;- server: \"</span> <span class=\"token operator\">+</span> toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"연결 종료: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        input<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        output<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        socket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>서버도 클라이언트와 유사하다. 그런데 위의 코드에는 문제가 존재한다. 서버는 하나의 클라이언트가 아니라, 여러 클라이언트의 연결을 처리할 수 있어야 한다. 여러 클라이언트가 하나의 서버에 접속해서 실행하면 두번째로 연결된 클라이언트는 데이터를 처음에 보낸 이후로 계속 대기상태에 빠진다. 그리고 서버는 두번째 클라이언트가 보낸 메세지를 받지를 못하는 문제가 있다.</p>\n<p>참고로, 인텔리제이에서 클라이언트를 하나 더 실행하려면 <code>Edit Configuration</code>에 가서 아래와 같이 클라이언트 앱을 추가해서 실행하면 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACdElEQVQ4yz2T2Y7jNhBF9T7oWC3RoriIEql9sdvttp2eTCYLJvn/TzqBiIkfLooUhFPFqltJ97bh+g4TOqR2iMJiqkCpa0rTxG+6DkjlyI8aWVYo26B0Hc+lrlDGoa1D2UBitKYQOUeRYbShHRaCn6ndiPMz3XDCh4XaTyjbYlyPq0eqeowJ0kySC0VR2pgkKQuFLCRpekBLy/X6F/10xTUzy3rntN0YpzecGxi7C8v8YDk9GOcPqj1pPUdV9UTlAomQFVmu+PIlJT0c8c1M5XqKwtJ2Z+btK/P2G+Pyybr9znr6zjDeaPyKsR3G9jG6aqAPC4nIVQS+vKQcDjnWeLR25HnJvF5jlbXf8P2Zuj/T+IUxnAnhhDYtSu/99lSmo7EdyWsqKKXh5ZeM9JBTyorjUSOEou0vTOtXmrDhmpHGzz/7N1A38xO4q7I9telIDgdBUTrStCBNxRO2x+38Kx/3P5mWG/N6Z9keLNudeb0RutMTtivCVU2SZRJtal4zyevr8QkUQtOPlwjtxiv99KAbb0+1w/uzwv/jUVYkUlqUsohMIvIyAqOEIvQXlvN3huUzQvrpHtUOV3z3hlR1hBRlRbG3SlqSphkI7YwPE9Z6XrOCLJfkuaQfr2yXP1hO31jitD+Z1894HudbBIrCRO0wEYFhIrRrbHbwE71fGfwWjb2ev/F++8H1/g8fj39jfL/9zfX+I96tGyJo1z6HWGGpfHy/LD3WtDS7Ud2Ec2P02G4J366x2tC90fbvcfq7sXeIkCZuSaywMCTGBqzr0DagqxZlGsqfTzkWNkocTVyvfa/Nvtfaxf+M9RjjkbqO933f/wPWu2UwDSYwtQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image3\"\n        title=\"image3\"\n        src=\"/static/5d3df6412a2e6714cc63f2e21c95c400/2bef9/03.png\"\n        srcset=\"/static/5d3df6412a2e6714cc63f2e21c95c400/6f3f2/03.png 256w,\n/static/5d3df6412a2e6714cc63f2e21c95c400/01e7c/03.png 512w,\n/static/5d3df6412a2e6714cc63f2e21c95c400/2bef9/03.png 1024w,\n/static/5d3df6412a2e6714cc63f2e21c95c400/71c1d/03.png 1536w,\n/static/5d3df6412a2e6714cc63f2e21c95c400/a878e/03.png 2048w,\n/static/5d3df6412a2e6714cc63f2e21c95c400/0b569/03.png 2878w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그럼 코드를 자세히 분석해보자.</p>\n<h2>네트워크 프로그램2 - 분석</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.296875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACrklEQVQ4y11UPW/TUBT1UkTTxrH9Pvxtx3bafDW0tEmKk2Yi7dKpFQgVJEbEp4CBBQkJiRnB/2BgQYAEAxs/iJHhoPvSF9wOx+/65b5z7zv3OAbnHIwx0MqFhBASjHNYlgXbttVKcBwHXHAFxpk6Q3u0ahCHQQ/XdSGFgGOuwTZraGUxDg4OsL+/j9FohMl0gnJcwhc+7HUbkklIKZFlGcIwVDFBEXq+D1dKRGmBvfkZ9o7uYXh4B2lWqEKe58H3fOT9HJvlJrK9DFE7ghQSnu8tmpESPvG4LowoilGvXUGnPMarX8Dzb8CLr0C+dQOWuQYuJayajd3Xuzj8Ocf8x01MPpSwVi1YzkIWAl0/CAIY9BCcIWxuojx5htntl5iePIEXJuCcQUgBZnG05gV2Hm1j8GALreMWpCNhOxc1VoQkZpKk2L42gMtMmLUVSLuuNK0K7zIXg/YAk+EEo50RyrLEeDzGdDrFbDZTMWlq6CkLISCkqyCliyiKlC5UNUkS+IGvug3CQK1a36VDOF90qF+qoCQSutfrqerD4VAR0D4doivqqeorU0PUwJKQ/Kd9KM6Tq1dWNxBCdUWkzWZTrRpEpmxDlYMwhCsYhF2HVV+FVa9d6JiSiUj7jQjSNFXx0lq+rwoaYRihsX4V14/u49a77zh9+wWHDz/CsRvQpifz5nmObreLjY0NdDodJQfFhKIoll0aYRSjtmJgcvYGTz//xeNPf3D3/W/YjTo4X4hPidQRHSZimiaRUKzfdZ5B7TbTFJ3uFrL2AEnRgx9n4Offp/4STNNUaDQaCtWYQForwoUPExR5DkbOt0wwx14OhQoSKX0NekhV6L2lbUhI2rDVv4lYTFkI/J++WOqjQR6N41hpq/coh25iXPafNmp1rYIOtdtt9Pt9pd3l3/8BF1OzDv7QMXwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image4\"\n        title=\"image4\"\n        src=\"/static/87e7554828986b8511d3eb595b54409d/2bef9/04.png\"\n        srcset=\"/static/87e7554828986b8511d3eb595b54409d/6f3f2/04.png 256w,\n/static/87e7554828986b8511d3eb595b54409d/01e7c/04.png 512w,\n/static/87e7554828986b8511d3eb595b54409d/2bef9/04.png 1024w,\n/static/87e7554828986b8511d3eb595b54409d/236d7/04.png 1486w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>서버는 12345 서버 소켓을 열어둔다.</li>\n<li>50000번 랜덤 포트를 사용하는 클라이언트가 먼저 12345 포트의 서버에 접속을 시도한다.</li>\n<li>이때 OS 계층에서 TCP 3 way handshake가 발생하고, TCP 연결이 완료된다.</li>\n<li>TCP 연결이 완료되면 서버는 OS backlog queue라는 곳에 클라이언트와 서버의 TCP 연결 정보를 보관한다.</li>\n</ul>\n<p>여기서 중요한 점이 있는데, 이 시점에 TCP 3 way handshake가 완료되었기 때문에, 클라이언트와 서버의 TCP 연결은 이미 완료되고, 클라이언트의 소켓 객체도 정상 생성된다. 참고로 이 시점에 아직 서버의 소켓 객체(서버 소켓 아님)는 생성되지 않았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.296875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAClklEQVQ4y21UO2/TUBiNWFrRNrbvvX47dtw0ie0oTpxKHQJKK7ojJMRjqhgYUMXWgYEFxoqBhZ0JIcTAxA5i56cwsR90bnLdghiO7+v7js/9HrcjpYRSCkq5UK4HdwPu8cxAuWoN7qv1nhBi43uFDj+e50EKB/buNqydLTjWrj70fR9xHOtR2BLCElDO2jEMQ/R6PT13XfeKMAwjBL6HfDRFc/oQ0+MH2K9vQzgOPN/XSoIgQF7m6E/6yMoMQRggCiMkSaLPSE7QthPFCXa2bmB19hpP3v3Ek7c/cP/FewwHOcZFgUE+QFIkOP6wwsmnY5x+vYP8Vo7udhcOb2XbcBxHE2qFURRBChvjwxNU9QLzeoLZbIbpdIp6VqMqKsR5jNnzGs3FHPVFjbiKYe+tiRhHoiVUUmI4HKIcD+G5Crbt6JjR2OpasCwLwhHI/AzzssFhdYhm1uDo6Ajz+RzL5RJN06Cua+3TkSZDm8CaRDBRJvCE53tI+ymyPANvlee5Pqc9wXjqGKprhFIqbUyywWCAxWKB1WqFLMt0rOhIW17R3IJzErVJuV6HVBvHiSYksXE2tcjyMGoIzpllQpceCXXaqUoJRL4LTzpwlUAQrP9oQmBKg/Zpmuo9Q8af+5sS60RRDGF3cfr0DR5ffsOjy+9Y3juH093RnUNjoqoqTCYTFEWhq4Dr8Xis1+YHmpDq9m5u4e7LL3j28RfOP//Gydkr3TGu52tVNGYc6WiSxDVHs6fLz1z54OAAg/19RJvsKiXbViIhjcuybFVxJEajkV6TsFXIT7/fR5r2dD9L+XfDm6wbYgowpWLajvNWocnk/14OGhgyQ0IlFECYfZOclpDlcP3F+Bc8IzFHxoyJ4FVJaM7Ma/MHshqxpyaSre8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image5\"\n        title=\"image5\"\n        src=\"/static/28f96bcc3cef700684b9f063d6042b8e/2bef9/05.png\"\n        srcset=\"/static/28f96bcc3cef700684b9f063d6042b8e/6f3f2/05.png 256w,\n/static/28f96bcc3cef700684b9f063d6042b8e/01e7c/05.png 512w,\n/static/28f96bcc3cef700684b9f063d6042b8e/2bef9/05.png 1024w,\n/static/28f96bcc3cef700684b9f063d6042b8e/a8a6f/05.png 1516w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이번에는 60000번 랜덤 포트를 사용하는 클라이언트가 12345 포트의 서버에 접속을 시도하고 연결을 완료한다. 50000번 클라이언트와 60000번 클라이언트 모두 서버와 연결이 완료되었고, 클라이언트의 소켓도 정상 생성된다.</p>\n<p>여기서 서버와 클라이언트가 데이터를 주고 받으려면 <code>Socket</code> 객체가 존재해야 한다. <code>ServerSocket.accpet()</code> 메서드를 호출하면 backlog 큐의 정보를 기반으로 소켓 객체를 하나 생성한다. backlog 큐는 말 그대로 큐이기 때문에 먼저 들어온 TCP 정보를 꺼낸다. 맨 처음에는 클라이언트 포트가 5000번인 정보를 꺼내고 첫번째 클라이언트와 데이터를 주고 받는 <code>Socket</code> 객체를 생성한다.</p>\n<p>두번째 클라이언트는 데이터를 보낼 때 이미 TCP 연결이 완료되었으므로 데이터를 서버쪽으로 전송은 할 수 있다. 하지만 <code>ServerSocket</code>에서는 두번째 클라이언트와 데이터를 주고 받을 <code>Socket</code> 객체가 없기 때문에 데이터를 주고받지 못하는 상황이 오는 것이다.</p>\n<p>즉, 클라이언트가 데이터를 보낼 때 어플리케이션 레이어에서 TCP 송신 버퍼로 내려오고 세그먼트화, 패킷화를 한 이후에 서버쪽으로 전달한다. 그럼 서버쪽에서는 NIC를 타서 TCP 수신 버퍼에 쌓인다. 그리고 <code>ServerSocket.accept()</code>를 호출할 때 수신 버퍼에 데이터를 하나 가져오는 것으로 이해하면 쉽다. 그런데 두번째 클라이언트의 정보를 기반으로 <code>ServerSocket.accept()</code>를 호출하지 않았기에 계속 수신버퍼에서 대기를 하는 것이다.</p>\n<p>여기서 핵심적인 내용이 있는데, 소켓 객체 없이 서버 소켓만으로도 TCP 연결은 완료된다는 점이다. 하지만 연결 이후에 서로 메시지를 주고 받으러면 소켓 객체가 필요하다. 즉, 여기서 알 수 있는 사실은 TCP연결은 착각이라는 사실이다.</p>\n<h3>현재 코드의 문제점</h3>\n<ul>\n<li>새로운 클라이언트가 접속하면?\n<ul>\n<li>새로운 클라이언트가 접속했을 때 서버의 <code>main</code> 스레드는 <code>accept()</code> 메서드를 절대로 호출할 수 없다! 왜냐하면 <code>while</code> 문으로 기존 클라이언트와 메시지를 주고 받는 부분만 반복하기 때문이다.</li>\n<li><code>accept()</code>를 호출해야 소켓 객체를 생성하고 클라이언트와 메시지를 주고 받을 수 있다.</li>\n</ul>\n</li>\n<li>2개의 블로킹 작업 - 핵심은 별도의 스레드가 필요하다!\n<ul>\n<li><code>accept()</code> : 클라이언트와 서버의 연결을 처리하기 위해 대기</li>\n<li><code>readXxx()</code> : 클라이언트의 메시지를 받아서 처리하기 위해 대기</li>\n<li>각각의 블로킹 작업은 별도의 스레드에서 처리해야 한다. 그렇지 않으면 다른 블로킹 메서드 때문에 계속 대기할 수 있다.</li>\n</ul>\n</li>\n</ul>\n<h2>네트워크 프로그램3</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.578125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVQ4y4VTPU/DMBTMAqhVaeLYzpddSFO1oQui0AHBgEQRC6gzExIrE0Ji6IA68DeY+QOIjwGJn3boGTmkJW2HS+Tny+XeO9sRQsBCSonyegaytC8luBDgnJt6mecQyRINYZEgF+CM/8IXiMMYOtFmLcWfESdJEhDSNIXWGmEYVgrKUCJQPnQngc4i6DTBVrYNlSoorcAYg+/7cOhBH2RZhjzPjXgQBIVbEvI2XOzdHuDm6x1Xz6+4fvnG+PMOJx+HOH0bIb/I0U7aSLMUjlLKOIvjGOX2C2eBBGsw9C53cP40weh+grOHRxxPx9if7mI4HaJzlEGF2jh1er0eBoMBoihaPEMpwF0Ot7EOyRtobq6hWavDqzO4NRdREBmeaZlm1+12jcOloVCaMkAcKwgRwOe+AfMZojgqOnNWplsC8WwnNgR6U60QtCkTqmY4j5WCtEmLRSlXObRCBM/z/jukpGmWrVZr4Tm0gvY02B+Wa0bQpkxC9kwuA7knAQI5s+/iplCr/X7fuLTtrwpmHjN32c6h7K6KWN5bVv8BX91r7Srz3T0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image6\"\n        title=\"image6\"\n        src=\"/static/499f279715e4912e05a5a8184b85eb3b/2bef9/06.png\"\n        srcset=\"/static/499f279715e4912e05a5a8184b85eb3b/6f3f2/06.png 256w,\n/static/499f279715e4912e05a5a8184b85eb3b/01e7c/06.png 512w,\n/static/499f279715e4912e05a5a8184b85eb3b/2bef9/06.png 1024w,\n/static/499f279715e4912e05a5a8184b85eb3b/71c1d/06.png 1536w,\n/static/499f279715e4912e05a5a8184b85eb3b/2215f/06.png 1548w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>서버의 <code>main</code> 스레드는 서버 소켓을 생성하고, 서버 소켓의 <code>accept()</code>를 반복해서 호출해야 한다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtUlEQVQ4y51TS27bMBTUOnAMmR9ZH0qWREsV5IWRNihQIDEQOMkdsim6yZmCHCBX6KLopkC3PdMU8xwadlA0QRbDB5LvDWceycgYA601GP8La2GTROIOGsYe7u9iZK3FfD4XBPJ/HaBOY8STCdR0ChsruMRBn2pYbWXfml2MsiwDSfM8R9u2KMsSaZoekWqlUH/uMG4vsbraYNieY3nj0d/2cN4hMYlw7AlZzLhcLlFVFZxzQio2rEU8OcH1wzfcf/+Dr0+/cffjEdtfF7j5eQu/8fCVR5ZnUEohIiuVkezQMltA1Yw8vV43GDcf8eHLGvV5h+KsQPmphGsc2qbFMAwiKmJx13UYxxEJmx5sPlum2tZ7DN2AzMzRNR5t1UBPDWxskWe5iOm7XuqjV2/XGElMsxRlVYo1tkJpBWWUtGY2m4ld6SEtcZH2iqLYWzwkpFoWBAdxHMuckF7zlsOlkIgJJGIf6rqWwpdPh/NQzHyqIsJagCjkU1ksFtJUkr1UGAiDG+4TzGXNESET+77HarXCW35N+AQB4fC9ZQ7sHVXK4iuE4Vkd4kgh/6eWxN0pnL8bNsFf37dSDp26UAUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image7\"\n        title=\"image7\"\n        src=\"/static/767369e35092ef26c19f44313078df71/2bef9/07.png\"\n        srcset=\"/static/767369e35092ef26c19f44313078df71/6f3f2/07.png 256w,\n/static/767369e35092ef26c19f44313078df71/01e7c/07.png 512w,\n/static/767369e35092ef26c19f44313078df71/2bef9/07.png 1024w,\n/static/767369e35092ef26c19f44313078df71/71c1d/07.png 1536w,\n/static/767369e35092ef26c19f44313078df71/b88bf/07.png 1702w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>클라이언트가 서버에 접속하면 서버 소켓의 <code>accept()</code> 메서드가 <code>Socket</code>을 반환한다.</li>\n<li><code>main</code> 스레드는 이 정보를 기반으로 <code>Runnable</code>을 구현한 <code>Session</code>이라는 별도의 객체를 만들고, 새로운 스레드에서 이 객체를 실행한다. 여기서는 <code>Thread-0</code>이 <code>Session</code>을 실행한다.</li>\n<li><code>Session</code> 객체와 <code>Thread-0</code>은 연결된 클라이언트와 메시지를 주고 받는다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.140625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2ElEQVQ4y41TzYrTUBjNVgYTm/uXNklz0zRN7DSBARF0kEEY7Li06AOICx/DV/AdXAtuZ+lCXPsCvsoZzi03kxZm6OLwfTe53/nO950kEELAQ0r5KJRWUFpDKgWpFbTRkFpCyPvawBiD6XSKJEmgtX6UfHIWIXpyBhFGkOEEhSlgIgP1TEEp5eoCkvFAQmstZrOZAwkGYiGhEonmfY+Lj1tc7N6h271Bs1uh+dSgvq5hlHETOEIWkrBtWxRF4YjTNN13lQJioqDLCB9+fsPXX//x+cc/fLn9jZs/19j+3eL191fIdIbzzTkCjrlarbBcLt3IXjpzKmUjp1IJLC5rdDcv0LztUV09R36Zo7gqYF/avUKl9oSbzQbr9Xog8ztjzgkWixJVVaFdtjCxQm0rLHILm1qIpwJxGMMkZr9Dvz+C+bERvETjqLawBWxpHWZp6lyOZeym4R1HyIRkjGOXPdiEKok8z5FlmYM3M45jFwfCscs0hEpoCCPfMdIkjtz3vSPjepqmQVmWw1QHhN5lXmTxfD4/MMjvlZHNmEdRhDAMXTxQyMK6rp2CY5LjD3y8gvGqePbrcqZ0XeecPnb5wV9QKUfgMTZzcHn6gMunYCwi8A9OUXYK7gAIWG/vL51EegAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image8\"\n        title=\"image8\"\n        src=\"/static/5690cb0cba9382e1f14179186cf0cf2c/2bef9/08.png\"\n        srcset=\"/static/5690cb0cba9382e1f14179186cf0cf2c/6f3f2/08.png 256w,\n/static/5690cb0cba9382e1f14179186cf0cf2c/01e7c/08.png 512w,\n/static/5690cb0cba9382e1f14179186cf0cf2c/2bef9/08.png 1024w,\n/static/5690cb0cba9382e1f14179186cf0cf2c/71c1d/08.png 1536w,\n/static/5690cb0cba9382e1f14179186cf0cf2c/61946/08.png 1546w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>새로운 TCP 연결이 발생하면 <code>main</code> 스레드는 새로운 <code>Session</code> 객체를 별도의 스레드에서 실행한다. 그리고 이 과정을 반복한다.</li>\n<li><code>Session</code> 객체와 <code>Thread-1</code> 은 연결된 클라이언트와 메시지를 주고 받는다.</li>\n</ul>\n<p>즉, <code>main</code> 스레드는 새로운 연결이 있을 때마다 <code>Session</code> 객체를 별도의 스레드로 생성하여 실행시키는 역할을 한다. 그리고 <code>Session</code> 객체는 실제 클라이언트와 데이터를 송수신 하는 역할을 진행한다. 그럼 이 로직을 코드로 작성해보자.</p>\n<p>클라이언트 코드는 기존과 동일하다. <code>Session</code>과 서버쪽 코드만 수정해보겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v3</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataInputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DataOutputStream</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SessionV3</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Runnable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">SessionV3</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Socket</span> socket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">DataInputStream</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataInputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getInputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">DataOutputStream</span> output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataOutputStream</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span><span class=\"token function\">getOutputStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">String</span> received <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">readUTF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client -> server: \"</span> <span class=\"token operator\">+</span> received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>received<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"exit\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token class-name\">String</span> toSend <span class=\"token operator\">=</span> received <span class=\"token operator\">+</span> <span class=\"token string\">\" World!\"</span><span class=\"token punctuation\">;</span>\n                output<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTF</span><span class=\"token punctuation\">(</span>toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client &lt;- server: \"</span> <span class=\"token operator\">+</span> toSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"연결 종료: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            input<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            output<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            socket<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>v3</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IOException</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerSocket</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Socket</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">static</span> <span class=\"token import static\"><span class=\"token namespace\">util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MyLogger</span><span class=\"token punctuation\">.</span><span class=\"token static\">log</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServerV3</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서버 시작\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ServerSocket</span> serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서버 소켓 시작 - 리스닝 포트: \"</span> <span class=\"token operator\">+</span> <span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">Socket</span> socket <span class=\"token operator\">=</span> serverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"소켓 연결: \"</span> <span class=\"token operator\">+</span> socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">SessionV3</span> session <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SessionV3</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Thread</span> thread <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            thread<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이제 정말 잘 작성된 네트워크 프로그램인것 같다. 하지만 여전히 문제가 존재한다. 만약 강제로 클라이언트를 종료시켜보자.</p>\n<p>클라이언트의 연결을 직접 종료하면 클라이언트 프로세스가 종료되면서, 클라이언트와 서버의 TCP 연결도 함께 종료된다. 이때 서버에서 <code>readUTF()</code>로 클라이언트가 메시지를 읽으려고 하면 <code>EOFException</code>이 발생한다. 소켓의 TCP 연결이 종료되었기 때문에 더는 읽을 수 있는 메시지가 없다는 뜻이다. EOF(파일의 끝)가 여기서는 전송의 끝이라는 뜻이다. 그런데 여기서 심각한 문제가 하나 있다. 이렇게 예외가 발생해버리면 서버에서 자원 정리 코드를 호출하지 못한다는 점이다. 서버 로그를 보면 연결 종료 로그가 없는 것을 확인할 수 있다.</p>\n<h3>윈도우 OS 추가</h3>\n<p>참고로 윈도우의 경우 <code>java.io.EOFException</code> 이 아니라 <code>java.net.SocketException: Connection reset</code>이 발생한다. 둘의 차이가 발생하는 이유는 다음과 같다. 클라이언트의 연결을 직접 종료하면 클라이언트 프로세스가 종료되면서, 클라이언트와 서버의 TCP 연결도 함께 종료된다. 이때 소켓을 정상적으로 닫지 않고 프로그램을 종료했기 때문에 각각의 OS는 남아있는 TCP 연결을 정리하려고 시도한다. 이때 MAC과 윈도우 OS의 TCP 연결 정리 방식이 다르다.</p>\n<ul>\n<li>맥: TCP 연결 정상 종료</li>\n<li>윈도우: TCP 연결 강제 종료</li>\n</ul>\n<p>결론적으로 자바 객체는 GC가 되지만 자바 외부의 자원은 자동으로 GC가 되는게 아니다. 따라서 꼭! 정리를 해주어야 한다.</p>\n<h2>자원 정리1</h2>\n<p>위의 네트워크 프로그래밍에서는 강제종료 시, 자원정리가 제대로 되지를 못했다. 예외가 터지더라도 자원 정리는 반드시 필요하다. 그래서 자원 정리를 프로그램에 적용하기 전에, 간단한 예제로 자원정리를 이해해보고 시작해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CallException</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CloseException</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CloseException</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>위와 같이 호출할 때 터질 수 있는 예외와 닫을때 터질 수 있는 예외를 정의하였다. 이제 로직을 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceV1</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" call\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">callEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CallException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" callEx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" ex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" close\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CloseException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" closeEx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CloseException</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" ex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>호출할 때나 닫을 때 정상 로직 메서드와 예외가 터지는 메서드를 2개씩 정의하였다. 이제 이를 사용하는 코드를 작성해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceCloseMainV1</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CallException 예외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CloseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CloseException 에외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CloseException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ResourceV1</span> resource1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ResourceV1</span> resource2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        resource1<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        resource2<span class=\"token punctuation\">.</span><span class=\"token function\">callEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"자원 정리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        resource2<span class=\"token punctuation\">.</span><span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        resource1<span class=\"token punctuation\">.</span><span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>지금 코드에서 실행을 해보면 <code>resource2</code>에서 호출할 때 예외가 터져서 자원 정리를 수행하지 못하였다. 이를 어떻게 해결할까?</p>\n<h2>자원 정리2</h2>\n<p>그럼 이제 예외가 발생해도 자원을 정리시켜보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceCloseMainV2</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CallException 예외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CloseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CloseException 에외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CloseException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ResourceV1</span> resource1 <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ResourceV1</span> resource2 <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            resource1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            resource2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            resource1<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            resource2<span class=\"token punctuation\">.</span><span class=\"token function\">callEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ex: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resource2 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                resource2<span class=\"token punctuation\">.</span><span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resource1 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                resource1<span class=\"token punctuation\">.</span><span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>이 코드에는 그래도 몇가지 문제가 존재한다.</p>\n<h3>null 체크</h3>\n<p>이번에는 <code>finally</code> 코드 블록을 사용해서 자원을 닫는 코드가 항상 호출되도록 했다. 만약 <code>resource2</code> 객체를 생성하기 전에 예외가 발생하면 <code>resource2</code>는 <code>null</code>이 된다. 따라서 <code>null</code> 체크를 해야한다. <code>resource1</code>의 경우에도 <code>resource1</code>을 생성하는 중에 예외가 발생한다면 <code>null</code> 체크가 필요하다.</p>\n<h3>자원 정리 중에 예외 발생</h3>\n<p><code>finally</code> 코드 블록은 항상 호출되기 때문에 자원이 잘 정리될 것 같지만, 이번에는 자원을 정리하는 중에 <code>finally</code> 코드 블록 안에서<code>resource2.closeEx()</code>를 호출하면서 예외가 발생한다. 결과적으로 <code>resource1.closeEx()</code>는 호출되지 않는다.</p>\n<h3>핵심 예외가 발생하는 문제</h3>\n<p>이 코드에서 발생한 핵심적인 예외는 <code>CallException</code> 이다. 이 예외 때문에 문제가 된 것이다. 그런데 <code>finally</code> 코드 블록에서 자원을 정리하면서 <code>CloseException</code> 예외가 추가로 발생했다. 예외 때문에 자원을 정리하고 있는데, 자원 정리중에 또 예외가 발생한 것이다. 이 경우 <code>logic()</code>을 호출한 쪽에서는 핵심 예외인 <code>CallException</code>이 아니라 <code>finally</code> 블록에서 새로 생성된 <code>CloseException</code>을 받게 된다. 핵심 예외가 사라진 것이다! 개발자가 원하는 예외는 당연히 핵심 예외다. 이 핵심 예외를 확인해야 제대로 된 문제를 찾을 수 있다. 자원을 닫는 중에 발생한 예외는 부가 예외일 뿐이다.</p>\n<p>그럼 이런 문제를 어떻게 해결할까?</p>\n<h2>자원 정리3</h2>\n<p>이번에는 자원 정리의 코드에서 try-catch를 사용해서 자원 정리 중에 발생하는 예외를 잡아서 처리해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceCloseMainV3</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CallException 예외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CloseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CloseException 에외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CloseException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ResourceV1</span> resource1 <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">ResourceV1</span> resource2 <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            resource1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            resource2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            resource1<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            resource2<span class=\"token punctuation\">.</span><span class=\"token function\">callEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ex: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resource2 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    resource2<span class=\"token punctuation\">.</span><span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CloseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"close ex: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resource1 <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n                    resource1<span class=\"token punctuation\">.</span><span class=\"token function\">closeEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CloseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"close ex: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><code>finally</code> 블럭에서 각각의 자원을 닫을 때도, 예외가 발생하면 예외를 잡아서 처리하도록 했다.</li>\n<li>이렇게 하면 자원 정리 시점에 예외가 발생해도, 다음 자원을 닫을 수 있다.</li>\n<li>자원 정리 시점에 발생한 예외를 잡아서 처리했기 때문에, 자원 정리 시점에 발생한 부가 예외가 핵심 예외를 가리지 않는다.</li>\n<li>자원 정리 시점에 발생한 예외는 당장 더 처리할 수 있는 부분이 없다. 이 경우 로그를 남겨서 개발자가 인지할 수 있게 하는 정도면 충분하다. 즉, 핵심 비즈니스 로직에 대한 예외만 처리하는 것이 더 중요한 것이다.</li>\n</ul>\n<p>이렇게 모든 문제를 다 해결하였다. 하지만 조금 찜찜한 부분이 존재한다.</p>\n<ul>\n<li><code>resource</code> 변수를 선언하면서 동시에 할당할 수 없음</li>\n<li><code>catch</code> 이후에 <code>finally</code> 호출, 자원 정리가 조금 늦어진다.</li>\n<li>개발자가 실수로 <code>close()</code>를 호출하지 않을 가능성</li>\n<li>개발자가 <code>close()</code> 호출 순서를 실수, 보통 자원을 생성한 순서와 반대로 닫아야 함</li>\n</ul>\n<p>이런 부분을 어떻게 해결할까?</p>\n<h2>자원 정리4</h2>\n<p>위의 찜찜한 문제를 <code>try-with-resources</code>를 이용하여 해결해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceV2</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AutoCloseable</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResourceV2</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" call\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">callEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CallException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" callEx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" ex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CloseException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" close\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CloseException</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\" ex\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>try-with-resources</code>를 사용하려면 일단 해당 자원이 <code>AutoClosable</code> 인터페이스를 구현해야 한다. 이제 사용하는 코드를 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-java line-numbers\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">network<span class=\"token punctuation\">.</span>tcp<span class=\"token punctuation\">.</span>autocloseable</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceCloseMainV4</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CallException 예외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> suppressed <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getSuppressed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> throwable <span class=\"token operator\">:</span> suppressed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"suppressedEx = \"</span> <span class=\"token operator\">+</span> throwable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CloseException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CloseException 에외처리\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">CallException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CloseException</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ResourceV2</span> resource1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n             <span class=\"token class-name\">ResourceV2</span> resource2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResourceV2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resource2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            resource1<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            resource2<span class=\"token punctuation\">.</span><span class=\"token function\">callEx</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CallException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ex: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>try-with-resources</code>를 통하여 위의 문제들을 전부 해결하였다. 종료중에 예외를 던져도 이 예외는 핵심 예외라 생각하지 않고 부가 예외로 핵심예외에 담아서 보내는 것이다. 또한 자동으로 <code>close()</code>를 호출해주는 장점이 있다.</p>\n<h3>try-with-resources 장점</h3>\n<ul>\n<li><strong>리소스 누수 방지</strong>: 모든 리소스가 제대로 닫히도록 보장한다. 실수로 <code>finally</code> 블록을 적지 않거나, <code>finally</code> 블럭 안에서 자원 해제 코드를 누락하는 문제들을 예방할 수 있다.</li>\n<li><strong>코드 간결성 및 가독성 향상</strong>: 명시적인 <code>close()</code> 호출이 필요 없어 코드가 더 간결하고 읽기 쉬워진다.</li>\n<li><strong>스코프 범위 한정</strong>: 예를 들어 리소스로 사용되는 <code>resource1,2</code> 변수의 스코프가 <code>try</code> 블럭 안으로 한정된다. 따라서 코드 유지보수가 더 쉬워진다.</li>\n<li><strong>조금 더 빠른 자원 해제</strong>: 기존에는 try -> catch -> finally로 catch 이후에 자원을 반납했다. try-with-resources구문은 <code>try</code> 블럭이 끝나면 즉시 <code>close()</code>를 호출한다.</li>\n<li><strong>자원 정리 순서</strong>: 먼저 선언한 자원을 나중에 정리한다.</li>\n<li><strong>부가 예외 포함</strong></li>\n</ul>\n<h3>try-with-resources 예외처리와 부가 예외 포함</h3>\n<p><code>try-with-resources</code>를 사용하는 중에 핵심 로직 예외와 자원을 정리하는 중에 발생하는 부가 예외가 모두 발생하면 어떻게 될까?</p>\n<ul>\n<li><code>try-with-resources</code>는 핵심 예외를 반환한다.</li>\n<li>부가 예외는 핵심 예외안에 <code>Suppressed</code>로 담아서 반환한다.</li>\n<li>개발자는 자원 정리 중에 발생한 부가 예외를 <code>e.getSuppressed()</code>를 통해 활용할 수 있다.</li>\n</ul>\n<blockquote>\n<p>✅ 참고</p>\n<p>자바 예외에는 <code>e.addSuppressed(ex)</code>라는 메서드가 있어서 예외 안에 참고할 예외를 담아둘 수 있다. 참고로 이 기능도 <code>try-with-resources</code>와 함께 등장했다.</p>\n</blockquote>\n<blockquote>\n<p>잘못된 지식이 있을 경우 댓글로 남겨주시면 빠르게 반영하겠습니다!</p>\n</blockquote>","fields":{"slug":"/네트워크-프로그램1/"},"timeToRead":18,"frontmatter":{"title":"[자바 고급2] 네트워크 프로그램1","tags":["자바"],"date":"2025-05-24T13:24:27.000Z","image":{"publicURL":"/static/3189e9c0404650ccc6c5ffc998bc8717/banner.png"},"series":"자바 고급2"}}},"pageContext":{"id":"88602fce-4bcb-55a4-9801-7826abd0d4d7"}},
    "staticQueryHashes": ["2580406332","3810308631"]}