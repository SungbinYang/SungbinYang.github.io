<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, minimal-ui"/><style data-href="/styles.06884e94fa8e7f768648.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}</style><meta name="generator" content="Gatsby 4.4.0"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="Sungbin&#x27;s Blog RSS Feed" href="/rss.xml"/><title data-react-helmet="true">[자바 고급1] 스레드 풀과 Executor 프레임워크2 · Sungbin</title><meta data-react-helmet="true" name="description" content="양성빈의 블로그"/><meta data-react-helmet="true" name="image" content="https://sungbin.kr/static/3189e9c0404650ccc6c5ffc998bc8717/banner.png"/><meta data-react-helmet="true" property="og:url" content="https://sungbin.kr/스레드-풀과-Executor-프레임워크2/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="[자바 고급1] 스레드 풀과 Executor 프레임워크2"/><meta data-react-helmet="true" property="og:description" content="양성빈의 블로그"/><meta data-react-helmet="true" property="og:image" content="https://sungbin.kr/static/3189e9c0404650ccc6c5ffc998bc8717/banner.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="[자바 고급1] 스레드 풀과 Executor 프레임워크2"/><meta data-react-helmet="true" name="twitter:description" content="양성빈의 블로그"/><meta data-react-helmet="true" name="twitter:image" content="https://sungbin.kr/static/3189e9c0404650ccc6c5ffc998bc8717/banner.png"/><meta data-react-helmet="true" name="google-site-verification" content="1PmwbFiy4YMimCQ6EmhZyUp2c7m23NNnr5NQRRXwQzM"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>            
              (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "ca-pub-8854437638395695",
                enable_page_level_ads: true
              });
          </script><link rel="icon" href="/favicon-32x32.png?v=64afaa923d984d8eeb697e501bbca8ed" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="36x36" href="/favicons/android-icon-36x36.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="48x48" href="/favicons/android-icon-48x48.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="72x72" href="/favicons/android-icon-72x72.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="96x96" href="/favicons/android-icon-96x96.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="144x144" href="/favicons/android-icon-144x144.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="192x192" href="/favicons/android-icon-192x192.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link as="script" rel="preload" href="/webpack-runtime-0fe85aec75a31f0a2507.js"/><link as="script" rel="preload" href="/framework-96f35882fb1b7fa32ef9.js"/><link as="script" rel="preload" href="/b633362c-429f9f687c864375c1ce.js"/><link as="script" rel="preload" href="/63a121f2-37023b2342386794d0fe.js"/><link as="script" rel="preload" href="/f3fee096-8a3be85b266f9ba6922d.js"/><link as="script" rel="preload" href="/3e15977f-5148ca5d1a687341b4e3.js"/><link as="script" rel="preload" href="/aec3edcd-33ff14c394bc1bedc44a.js"/><link as="script" rel="preload" href="/2425c7c2-8c4925ac74b0ebf7da0a.js"/><link as="script" rel="preload" href="/d0007318-557f95e6f5b855c64727.js"/><link as="script" rel="preload" href="/cc76255b-3222831408842f40a1cb.js"/><link as="script" rel="preload" href="/1593e758-7868fce8d5ccd9520ad2.js"/><link as="script" rel="preload" href="/48aa8186-67735c86ae4015d55662.js"/><link as="script" rel="preload" href="/app-3fa8deb48819dbe669b2.js"/><link as="script" rel="preload" href="/386142cf738b86b246078cd67abf8098b07f27c7-c2f146ac4a2834844fc5.js"/><link as="script" rel="preload" href="/component---src-template-post-tsx-7cd278bcc6c6bc262434.js"/><link as="fetch" rel="preload" href="/page-data/스레드-풀과-Executor-프레임워크2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2580406332.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3810308631.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><style data-emotion="css-global 19c91lz">@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');:root{--font-family:'Pretendard',-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;--code-font-family:Menlo,'DM Mono','Roboto Mono',Courier New,monospace;--scrollbar-background:#1e1e1e;--scrollbar-thumb:#666;--scrollbar-thumb-highlight:#9195F6;}html{font-size:16px;height:100%;overflow-x:hidden;overflow-y:scroll;-webkit-overflow-scrolling:touch;scrollbar-width:8px;scrollbar-color:var(--scrollbar-thumb-highlight) var(--scrollbar-background);}@media screen and (max-width: 1024px){html{font-size:14px;}}html::-webkit-scrollbar{background:var(--scrollbar-background);height:8px;width:8px;}html::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-highlight);border-radius:0;}html,body{font-family:var(--font-family)!important;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;font-size:1rem;}div,article,section{box-sizing:border-box;}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:1rem;font:inherit;vertical-align:baseline;}label,input,button,a{-webkit-tap-highlight-color:transparent;}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block;}body{line-height:1;}ol,ul{list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none;}table{border-collapse:collapse;border-spacing:0;}string{font-weight:600!important;}</style><style data-emotion="css pyz3l8">.css-pyz3l8{-webkit-transition:opacity 0.2s ease;transition:opacity 0.2s ease;opacity:0;}</style><div class="css-pyz3l8 e1l8l1ek0"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><style data-emotion="css 1azakc">.css-1azakc{text-align:center;}</style><header class="css-1azakc ebd5ed87"><style data-emotion="css 1j1kikd">.css-1j1kikd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:900px;padding:2rem;margin-left:auto;margin-right:auto;}@media screen and (max-width: 1024px){.css-1j1kikd{padding:1.5rem 1rem;}}</style><div class="css-1j1kikd ebd5ed86"><style data-emotion="css 1cdt2kf">.css-1cdt2kf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;width:100%;padding:0 1.5rem;}.css-1cdt2kf>h1{text-align:left;}</style><div class="css-1cdt2kf ebd5ed81"><style data-emotion="css 1gw8sdl">.css-1gw8sdl{color:inherit;font-size:2.5rem;line-height:1.5;font-weight:800;}white-space:nowrap;strong,bold{font-weight:800;}</style><h1 size="40" class="css-1gw8sdl eye3s1s1">[자바 고급1] 스레드 풀과 Executor 프레임워크2</h1><style data-emotion="css 1ixtmro">.css-1ixtmro{margin-left:calc(1.5rem - 1px);margin-top:calc(1.5rem - 1px);width:1px;height:1px;min-width:1px;min-height:1px;}</style><span x="1" y="1" class="css-1ixtmro ez28pf0"></span><style data-emotion="css lc9od6">.css-lc9od6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:1px;max-width:100%;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;box-sizing:border-box;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-lc9od6>*:not(:first-of-type){margin-left:calc(0.5 * 1rem);}</style><div wrap="wrap" class="css-lc9od6 e9vu7as0"><style data-emotion="css 9xks5q">.css-9xks5q{display:inline-block;vertical-align:middle;border-radius:16px;font-weight:500;line-height:1;cursor:inherit;font-feature-settings:tnum;font-variant:tabular-nums;text-transform:capitalize;white-space:nowrap;background:#000;color:#ffffff;border:1px solid #000;padding:3px 10px;font-size:1rem;}</style><span type="primary" class="css-9xks5q e1tg7sbi0">#<!-- -->자바</span></div><span x="1" y="1" class="css-1ixtmro ez28pf0"></span><style data-emotion="css 715507">.css-715507{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;}@media screen and (max-width: 1024px){.css-715507{-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}}</style><div class="css-715507 ebd5ed85"><style data-emotion="css 1u6n871">.css-1u6n871{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1u6n871 ebd5ed84"><style data-emotion="css zdebxm">.css-zdebxm{color:inherit;font-size:1rem;line-height:1.5;}white-space:nowrap;strong,bold{font-weight:800;}</style><span size="16" class="css-zdebxm eye3s1s1">Written by <a href="/">Sungbin</a></span><style data-emotion="css 69wa56">.css-69wa56{margin-left:calc(1.5rem - 1px);margin-top:calc(0.375rem - 1px);width:1px;height:1px;min-width:1px;min-height:1px;}</style><span x="1" y="0.25" class="css-69wa56 ez28pf0"></span><style data-emotion="css 4f3fw3">.css-4f3fw3{color:inherit;font-size:0.875rem;line-height:1.5;}white-space:nowrap;strong,bold{font-weight:800;}</style><span size="14" class="css-4f3fw3 eye3s1s1">2025년 5월 18일<!-- --> · <!-- -->14<!-- --> min read</span></div><style data-emotion="css 1yvy03y">.css-1yvy03y{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.5rem;margin-bottom:1.5rem;}</style><div class="css-1yvy03y ebd5ed83"><style data-emotion="css 18zu07s">.css-18zu07s{position:relative;}.css-18zu07s:hover>div:last-of-type{opacity:1;}</style><div class="css-18zu07s emo2hur2"><style data-emotion="css cssveg">.css-cssveg{position:relative;}</style><div class="css-cssveg emo2hur1"><style data-emotion="css 7a8mbj">.css-7a8mbj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:30px;height:30px;outline:none;border:none;border-radius:15px;cursor:pointer;padding:0;background:#000;color:#ffffff;}</style><button class="css-7a8mbj ebd5ed82"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path></svg></button></div></div><div class="css-18zu07s emo2hur2"><div class="css-cssveg emo2hur1"><button class="css-7a8mbj ebd5ed82"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></button></div></div></div></div></div><span x="1" y="1" class="css-1ixtmro ez28pf0"></span><style data-emotion="css 1d3w5wq">.css-1d3w5wq{width:100%;}</style><div class="css-1d3w5wq ebd5ed80"><style data-emotion="css a1pnd7">.css-a1pnd7{text-align:left;border-top:1px solid #EAEAEA;border-bottom:1px solid #EAEAEA;padding:1.5rem;box-shadow:0 5px 10px rgba(0, 0, 0, 0.12);border-radius:5px;border:none;}</style><div class="css-a1pnd7 e1xjf9tq6"><style data-emotion="css b54kzr">.css-b54kzr{font-weight:600;font-size:1.25rem;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;margin-top:0;margin-bottom:0;}</style><h3 class="css-b54kzr e1xjf9tq5"><style data-emotion="css 16yxw0r">.css-16yxw0r{width:100%;margin-bottom:0;margin-top:0;border:unset;background:unset;padding:unset;margin:unset;font:unset;text-align:unset;-webkit-appearance:unset;-moz-appearance:unset;-ms-appearance:unset;appearance:unset;}</style><button class="css-16yxw0r e1xjf9tq3"><style data-emotion="css ml2823">.css-ml2823{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;cursor:pointer;vertical-align:baseline;padding:1.5rem 0;color:#000;}</style><span class="css-ml2823 e1xjf9tq2">자바 고급1<style data-emotion="css mzobh8">.css-mzobh8{-webkit-transition:-webkit-transform 0.2s ease;transition:transform 0.2s ease;-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg);}</style><span class="css-mzobh8 e1xjf9tq1"><svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M18 15l-6-6-6 6"></path></svg></span></span></button><style data-emotion="css 153tcrd">.css-153tcrd{font-size:0.75rem;font-weight:400;letter-spacing:normal;margin-bottom:0;display:block;color:#666;}</style><span class="css-153tcrd e1xjf9tq4">시리즈의 글 (13개)</span></h3><style data-emotion="css 10lbtih">.css-10lbtih{font-size:1rem;line-height:26px;overflow-y:hidden;will-change:height;-webkit-transition:height 0.2s ease;transition:height 0.2s ease;}.css-10lbtih>div{margin:1rem 0;}</style><div class="css-10lbtih e1xjf9tq0"><div><style data-emotion="css 6z6c3m">.css-6z6c3m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:1px;max-width:100%;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;box-sizing:border-box;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-6z6c3m>section,.css-6z6c3m>div,.css-6z6c3m>article,.css-6z6c3m>header,.css-6z6c3m>footer{gap:calc(1 * 1rem);}.css-6z6c3m:last-of-type{margin-bottom:0;}</style><div class="css-6z6c3m e9vu7as0"><style data-emotion="css 1o02nna">.css-1o02nna{padding-left:1.5rem;box-sizing:border-box;line-height:1.6;list-style:decimal;}</style><ol class="css-1o02nna e1k9d3a01"><style data-emotion="css 1rb90kg">.css-1rb90kg{margin-bottom:0.5rem;}.css-1rb90kg::marker{font-weight:600;color:#9195F6;}.css-1rb90kg::after{content:'- 14분';margin-left:0.2rem;font-size:0.8rem;}.css-1rb90kg>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-1rb90kg>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-1rb90kg e1k9d3a00"><span>[자바 고급1] 스레드 풀과 Executor 프레임워크2</span></li><style data-emotion="css ejf3ai">.css-ejf3ai{margin-bottom:0.5rem;}.css-ejf3ai::marker{font-weight:600;color:#9195F6;}.css-ejf3ai::after{content:'- 20분';margin-left:0.2rem;font-size:0.8rem;}.css-ejf3ai>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-ejf3ai>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-ejf3ai e1k9d3a00"><span>[자바 고급1] 스레드 풀과 Executor 프레임워크1</span></li><style data-emotion="css ikk1gw">.css-ikk1gw{margin-bottom:0.5rem;}.css-ikk1gw::marker{font-weight:600;color:#9195F6;}.css-ikk1gw::after{content:'- 9분';margin-left:0.2rem;font-size:0.8rem;}.css-ikk1gw>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-ikk1gw>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-ikk1gw e1k9d3a00"><span>[자바 고급1] 동시성 컬렉션</span></li><li class="css-1rb90kg e1k9d3a00"><span>[자바 고급1] CAS - 동기화와 원자적 연산</span></li><style data-emotion="css 1ap6lfi">.css-1ap6lfi{margin-bottom:0.5rem;}.css-1ap6lfi::marker{font-weight:600;color:#9195F6;}.css-1ap6lfi::after{content:'- 11분';margin-left:0.2rem;font-size:0.8rem;}.css-1ap6lfi>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-1ap6lfi>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-1ap6lfi e1k9d3a00"><span>[자바 고급1] 생산자 소비자 문제2</span></li><li class="css-1rb90kg e1k9d3a00"><span>[자바 고급1] 생산자 소비자 문제1</span></li><li class="css-1ap6lfi e1k9d3a00"><span>[자바 고급1] 고급 동기화 - concurrent.Lock</span></li><style data-emotion="css 13xotzt">.css-13xotzt{margin-bottom:0.5rem;}.css-13xotzt::marker{font-weight:600;color:#9195F6;}.css-13xotzt::after{content:'- 7분';margin-left:0.2rem;font-size:0.8rem;}.css-13xotzt>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-13xotzt>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-13xotzt e1k9d3a00"><span>[자바 고급1] 동기화 - synchronized</span></li><style data-emotion="css 2r5mz2">.css-2r5mz2{margin-bottom:0.5rem;}.css-2r5mz2::marker{font-weight:600;color:#9195F6;}.css-2r5mz2::after{content:'- 5분';margin-left:0.2rem;font-size:0.8rem;}.css-2r5mz2>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-2r5mz2>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-2r5mz2 e1k9d3a00"><span>[자바 고급1] 메모리 가시성</span></li><li class="css-1ap6lfi e1k9d3a00"><span>[자바 고급1] 스레드 제어와 생명주기2</span></li><style data-emotion="css iuahyr">.css-iuahyr{margin-bottom:0.5rem;}.css-iuahyr::marker{font-weight:600;color:#9195F6;}.css-iuahyr::after{content:'- 12분';margin-left:0.2rem;font-size:0.8rem;}.css-iuahyr>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-iuahyr>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-iuahyr e1k9d3a00"><span>[자바 고급1] 스레드 제어와 생명주기1</span></li><style data-emotion="css kco6hv">.css-kco6hv{margin-bottom:0.5rem;}.css-kco6hv::marker{font-weight:600;color:#9195F6;}.css-kco6hv::after{content:'- 8분';margin-left:0.2rem;font-size:0.8rem;}.css-kco6hv>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-kco6hv>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-kco6hv e1k9d3a00"><span>[자바 고급1] 스레드 생성과 실행</span></li><li class="css-ikk1gw e1k9d3a00"><span>[자바 고급1] 프로세스와 스레드 소개</span></li></ol></div></div></div></div></div></div></header><div><style data-emotion="css ifrico">.css-ifrico{width:100%;max-width:900px;padding:2rem;margin-left:auto;margin-right:auto;width:calc(100vw - 400px);}@media screen and (max-width: 1024px){.css-ifrico{padding:1rem;}}@media screen and (max-width: 1308px){.css-ifrico{width:calc(100vw - 408px);}}@media screen and (max-width: 1024px){.css-ifrico{width:calc(100vw - 8px);}}.css-ifrico p>img{width:100%;}.css-ifrico p{color:#111;font-weight:400;line-height:1.6;letter-spacing:-0.02rem;}.css-ifrico p,.css-ifrico table,.css-ifrico ul,.css-ifrico blockquote,.css-ifrico ol{font-size:1rem;margin:0 0 2rem;}.css-ifrico center{color:#666;font-size:0.8rem;font-weight:400;line-height:1.5;letter-spacing:-0.02rem;margin:0 0 2rem;}.css-ifrico p+center,.css-ifrico iframe+center{margin-top:-1rem;}.css-ifrico h1,.css-ifrico h2,.css-ifrico h3,.css-ifrico h4,.css-ifrico h5{position:relative;color:#000;line-height:1.2;scroll-margin-top:60px;letter-spacing:-0.02rem;font-weight:600;background:none;}.css-ifrico h1>a,.css-ifrico h2>a,.css-ifrico h3>a,.css-ifrico h4>a,.css-ifrico h5>a{color:#000;opacity:0;border:none;position:absolute;top:50%;left:0;-webkit-transform:translate(-100%, -50%);-moz-transform:translate(-100%, -50%);-ms-transform:translate(-100%, -50%);transform:translate(-100%, -50%);padding-right:4px;}.css-ifrico h1:hover>a,.css-ifrico h2:hover>a,.css-ifrico h3:hover>a,.css-ifrico h4:hover>a,.css-ifrico h5:hover>a{color:#000;background:none;border:none;opacity:1;}.css-ifrico h2:not(:first-of-type),.css-ifrico h3:not(:first-of-type),.css-ifrico h4:not(:first-of-type){margin-top:3rem;}.css-ifrico h1,.css-ifrico h2,.css-ifrico h3,.css-ifrico h4,.css-ifrico h5{margin:0 0 1.25rem;}.css-ifrico h1,.css-ifrico h2{font-size:1.8rem;-webkit-filter:brightness(1);filter:brightness(1);}.css-ifrico h3{font-size:1.4rem;-webkit-filter:brightness(1.3);filter:brightness(1.3);}.css-ifrico h4{-webkit-filter:brightness(1.5);filter:brightness(1.5);font-size:1.1rem;padding-bottom:0.25rem;text-transform:uppercase;}.css-ifrico ul,.css-ifrico ol{padding-left:1.5rem;box-sizing:border-box;line-height:1.6;}.css-ifrico ul ul,.css-ifrico ol ul{margin-top:8px;}.css-ifrico ul ul,.css-ifrico ol ul,.css-ifrico ul ol,.css-ifrico ol ol{margin-bottom:0;}.css-ifrico ul{list-style:disc;}.css-ifrico ol{list-style:decimal;}.css-ifrico ul li{margin-bottom:0.5rem;}.css-ifrico ul li::marker{font-weight:600;color:#9195F6;}.css-ifrico ol li{margin-bottom:0.5rem;}.css-ifrico ol li::marker{font-weight:600;color:#9195F6;}.css-ifrico li>a{white-space:inherit;word-wrap:break-word;}.css-ifrico li{color:#000;}.css-ifrico li code{font-weight:600;color:#9195F6;white-space:inherit;}.css-ifrico li code * span{white-space:inherit;}.css-ifrico li code * span:not([class='grvsc-source']){padding-left:0!important;}.css-ifrico iframe{margin-bottom:2rem;}.css-ifrico div[class*='markdown-wrapper']{font-size:0.9rem;-webkit-text-size-adjust:none;-moz-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none;margin:1rem -1rem;overflow-x:auto;overflow-y:hidden;box-sizing:border-box;scrollbar-width:8px;scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-background);}.css-ifrico div[class*='markdown-wrapper']::-webkit-scrollbar{background:var(--scrollbar-background);height:8px;width:8px;}.css-ifrico div[class*='markdown-wrapper']::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:0;}@media screen and (min-width: 1350px){.css-ifrico div[class*='markdown-wrapper']{margin-left:-3.5rem;margin-right:-3.5rem;margin-bottom:2rem;}}@media screen and (max-width: 1024px){.css-ifrico div[class*='markdown-wrapper']{padding-left:1rem;}}.css-ifrico pre{border-radius:0;float:left;margin-bottom:0;margin-top:0;min-width:calc(100% + 1rem);padding:1rem 1rem 1rem 0;-webkit-font-smoothing:subpixel-antialiased;overflow:initial;white-space:pre;font-family:var(--code-font-family);word-wrap:normal;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;tab-size:2;word-break:normal;word-spacing:normal;}.css-ifrico pre>code{font-weight:600;color:#9195F6;white-space:inherit;}.css-ifrico pre>code * span{white-space:inherit;}.css-ifrico pre>code * span:not([class='grvsc-source']){padding-left:0!important;}.css-ifrico .line-numbers-rows{padding-left:1em;padding-top:1em;}.css-ifrico p>code{font-weight:600;color:#9195F6;white-space:inherit;}.css-ifrico p>code * span{white-space:inherit;}.css-ifrico p>code * span:not([class='grvsc-source']){padding-left:0!important;}.css-ifrico img[class='gatsby-resp-image-image']{box-shadow:none!important;}.css-ifrico img[class='gatsby-resp-image-image'][alt]:after{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;top:0;left:0;width:100%;height:100%;background:#ffffff;font-weight:200;content:'이미지를 표시할 수 없어요. :(';}.css-ifrico blockquote{background:#EAEAEA;margin:0 -1rem;margin-bottom:2rem;padding:1rem 1rem;border-left:6px solid #9195F6;}.css-ifrico blockquote>p{margin-bottom:0;}@media screen and (min-width: 1350px){.css-ifrico blockquote{margin-left:-3.5rem;margin-right:-3.5rem;}}@media screen and (max-width: 1024px){.css-ifrico blockquote{padding-left:1rem;}}</style><section class="css-ifrico e17f2jor0"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAApUlEQVQoz6WRPQvCQAyG+///R6GKm6AndhIcrNaiXVzEaqVaPym9Xs67XuIgiEvFw2whPDxJXof+KOf7uD4cUWtLGJGIHpMA2PDdWpgBqRyNOfMVkTHmV/ilSW7QjfPF+hRnpVC1hVkb3Nxla54NVpczVw1bN8Co9TbJw7QIdsX+Wtk9DHklXU+3O6bXl66HIG1gIQTzIVrCNJSzCJWyzLnp0A/4CfW+SjF6WKSqAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="배너 이미지"
        title="배너 이미지"
        src="/static/3189e9c0404650ccc6c5ffc998bc8717/2bef9/banner.png"
        srcset="/static/3189e9c0404650ccc6c5ffc998bc8717/6f3f2/banner.png 256w,
/static/3189e9c0404650ccc6c5ffc998bc8717/01e7c/banner.png 512w,
/static/3189e9c0404650ccc6c5ffc998bc8717/2bef9/banner.png 1024w,
/static/3189e9c0404650ccc6c5ffc998bc8717/71c1d/banner.png 1536w,
/static/3189e9c0404650ccc6c5ffc998bc8717/e8950/banner.png 2000w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<blockquote>
<p>해당 블로그 글은 <a href="https://inf.run/6oSgn">영한님의 인프런 강의</a>를 바탕으로 쓰여진 글입니다.</p>
</blockquote>
<h2>ExecutorService 우아한 종료 - 소개</h2>
<p>우리가 웹 어플리케이션 1대를 운영중이라고 해보자. 그런데 갑자기 보안 이슈 문제가 생겨서 긴급 패치를 해야한다고 해보자. 그럼 가장 이상적인 방향은 새로 들어오는 request는 막고 기존에 처리하는 api들을 다 처리 후에 종료하는게 가장 이상적일 것이다. 이런 방식을 <strong>graceful shutdown</strong>이라고 한다.</p>
<h3>ExecutorService의 종료 메서드</h3>
<h4>서비스 종료</h4>
<ul>
<li><code>void shutdown()</code>
<ul>
<li>새로운 작업을 받지 않고, 이미 제출된 작업을 모두 완료한 후에 종료한다.</li>
<li>논 블로킹 메서드</li>
</ul>
</li>
<li><code>List&#x3C;Runnable> shutdownNow()</code>
<ul>
<li>실행 중인 작업을 중단하고, 대기 중인 작업을 반환하며 즉시 종료한다.</li>
<li>실행 중인 작업을 중단하기 위해 인터럽트를 발생시킨다.</li>
<li>논 블로킹 메서드</li>
</ul>
</li>
</ul>
<h4>서비스 상태 확인</h4>
<ul>
<li><code>boolean isShutdown()</code>
<ul>
<li>서비스가 종료되었는지 확인한다.</li>
</ul>
</li>
<li><code>boolean isTerminated()</code>
<ul>
<li><code>shutdown()</code>,<code>shutdownNow()</code> 호출 후, 모든 작업이 완료되었는지 확인한다.</li>
</ul>
</li>
</ul>
<h4>작업 완료 대기</h4>
<ul>
<li><code>boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException</code>
<ul>
<li>서비스 종료시 모든 작업이 완료될 때까지 대기한다. 이때 지정된 시간까지만 대기한다.</li>
<li>블로킹 메서드</li>
</ul>
</li>
</ul>
<h4>close()</h4>
<p><code>close()</code>는 자바 19부터 지원하는 서비즈 종료 메서드이다. 이 메서드는 <code>shutdown()</code>과 같다고 생각하면 된다. 더 정확히는 <code>shutdown()</code>을 호출하고, 하루를 기다려도 작업이 완료되지 않으면 <code>shutdownNow()</code>를 호출한다. 호출한 스레드에 인터럽트가 발생해도 <code>shutdownNow()</code>를 호출한다.</p>
<h3>shutdown() - 처리중인 작업이 없는 경우</h3>
<p>만약 <code>BlockingQueue</code>에 대기 중인 작업이 없고 현재 작업을 처리하는 스레드도 없고 스레드 풀에 스레드들만 대기상태로 있다고 할 때 <code>shutdown</code> 메서드를 호출하면 일단 <code>ExecutorService</code>는 새로운 요청을 거절하고 스레드 풀의 기본 자원을 정리한다.</p>
<blockquote>
<p>거절시 기본적으로 <code>java.util.concurrent.RejectedExecutionException</code> 예외가 발생한다. 거절 정책은 설정이 가능하다.</p>
</blockquote>
<h3>shutdown() - 처리중인 작업이 있는 경우</h3>
<p>만약 대기 중인 작업도 있고 처리 중인 작업도 있을 경우 새로운 요청은 당연히 거절되고 처리 중인 작업을 완료한다. 그리고 대기 중인 작업도 완료한 후에 스레드 풀의 기본자원을 정리한다.</p>
<h3>shutdownNow() - 처리중인 작업이 있는 경우</h3>
<p>만약 대기 중인 작업도 있고 처리 중인 작업도 있을 경우 새로운 요청은 당연히 거절되고 큐를 비우면서, 큐에 있는 작업을 모두 꺼내서 컬렉션으로 반환한다. 그리고 작업 중인 스레드에 인터럽트가 발생한다. 그리고 스레드 풀의 기본 자원을 정리한다.</p>
<h2>ExecutorService 우아한 종료 - 구현</h2>
<p>일반적으로 어플리케이션을 종료할 때 우아한 종료가 가장 이상적이다. 그런데 갑자기 요청이 많이 들어와서 대기큐에 작업이 계속 쌓여 처리가 힘들거나 너무 오래 걸리는 작업이 있을 경우 종료 자체가 늦어질 수 있는 우려가 있다. 그래서 보통 우아한 종료를 하되, 1분 정도만 기달리고 강제 종료를 택한다. 이것을 한번 예제 코드로 작성해보자. 예제에서는 1분이 아닌 10초만 기달려 보는 것으로 해보겠다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">thread<span class="token punctuation">.</span>executor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">ExecutorUtils</span><span class="token punctuation">.</span><span class="token static">printState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">util<span class="token punctuation">.</span></span><span class="token class-name">MyLogger</span><span class="token punctuation">.</span><span class="token static">log</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExecutorShutdownMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"taskA"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"taskB"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"taskC"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"longTask"</span><span class="token punctuation">,</span> <span class="token number">100_000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"== shutdown 시작 =="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">shutdownAndAwaitTermination</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"== shutdown 완료 =="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">shutdownAndAwaitTermination</span><span class="token punctuation">(</span><span class="token class-name">ExecutorService</span> es<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        es<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"서비스 정상 종료 시도"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>es<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"서비스 정상 종료 실패 -> 강제 종료 시도"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                es<span class="token punctuation">.</span><span class="token function">shutdownNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>es<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"서비스가 종료되지 않았습니다."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">shutdownNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>위의 코드에서 taskA, taskB, taskC는 각각 1초씩 걸리는 작업이지만 longTask는 100초를 기달려야 하는 작업이다. 먼저 작업을 스레드 풀에 던지고 종료 로직을 수행할 것이다. 그러면 먼저 <code>shutdown()</code>이 호출되고 수행중이던 작업을 종료시키고 큐에 있는 작업도 수행을 할 것이다. 다만, 해당 메서드는 논 블로킹 메서드라 다음 로직을 수행한다. <code>awaitTermination()</code> 블로킹 메서드로 10초정도를 기달려본다. 10초에도 안 끝나는 작업이 있을 경우 <code>shutdownNow()</code>를 호출한다. 그러면 해당 스레드에 인터럽트가 걸려 바로 종료가 될 것이다.</p>
<blockquote>
<p>🙋🏻 질문</p>
<p><code>shutdownNow()</code>를 호출한 이후에 왜 <code>awaitTermination()</code>으로 10초간 기다릴까? 인터럽트로 스레드를 종료시키려고 하더라도 자원 정리하는데 시간이 있기 때문에 보통 이렇게 작성을 한다.</p>
</blockquote>
<p>그런데 이런 경우도 있을 수 있다. 극단적이지만 최악의 경우 스레드가 다음과 같이 인터럽트를 받을 수 없는 코드를 수행중일 수 있다. 이 경우 인터럽트 예외가 발생하지 않고, 스레드도 계속 수행된다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<p>이런 경우를 대비해서 강제 종료 후 10초간 대기해도 작업이 완료되지 않으면 "서비스가 종료되지 않았습니다"라고 개발자가 인지할 수 있는 로그를 남겨두어야 한다. 그래야 개발자가 나중에 문제를 찾아서 코드를 수정할 수 있다.</p>
<h2>Executor 스레드 풀 관리 - 코드</h2>
<p>Executor 프레임워크가 어떤식으로 스레드를 관리하는지 깊이있게 알아보자.</p>
<p><code>ExecutorService</code>의 기본 구현체인 <code>ThreadPoolExecutor</code>의 생성자는 다음 속성을 사용한다.</p>
<ul>
<li><code>corePoolSize</code> : 스레드 풀에서 관리되는 기본 스레드의 수</li>
<li><code>maximumPoolSize</code> : 스레드 풀에서 관리되는 최대 스레드 수</li>
<li><code>keepAliveTime</code>,<code>TimeUnit unit</code> : 기본 스레드 수를 초과해서 만들어진 초과 스레드가 생존할 수 있는 대기 시간, 이 시간 동안 처리할 작업이 없다면 초과 스레드는 제거된다.</li>
<li><code>BlockingQueue workQueue</code> : 작업을 보관할 블로킹 큐</li>
</ul>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>poolsize</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">RunnableTask</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">ExecutorUtils</span><span class="token punctuation">.</span><span class="token static">printState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">util<span class="token punctuation">.</span></span><span class="token class-name">MyLogger</span><span class="token punctuation">.</span><span class="token static">log</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">util<span class="token punctuation">.</span></span><span class="token class-name">ThreadUtils</span><span class="token punctuation">.</span><span class="token static">sleep</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PoolSizeMainV1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span> workQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> <span class="token string">"task1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> <span class="token string">"task2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> <span class="token string">"task3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> <span class="token string">"task4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> <span class="token string">"task5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task6"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> <span class="token string">"task6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task7"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RejectedExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"task7 실행 거절 예외 발생: "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"== 작업 수행 완료 =="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"== maximumPoolSize 대기 시간 초과 =="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"== shutdown 완료 =="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>일단 <code>BlockingQueue</code>의 사이즈를 2개를 설정했다. 그리고 작업이 2개까지 들어오면 <code>corePoolSize</code>로 설정한 2개까지 기본 스레드가 생성되어 작업을 처리한다. 그 후 작업이 2개 더 들어오면 대기 큐에 들어오게 된다. 하지만 여기서 2개가 더 들어오면 큐에도 못 넣고 기본 스레드도 작업 처리하는 상황이니 초과 스레드를 생성하여 처리한다. <code>maximumPoolSize</code>는 기본 스레드 + 초과 스레드라고 생각하면 좋을 것 같다. 그리고 <code>keepAliveTime</code>은 초과 스레드가 생존하는 시간을 의미하며 이 시간이 지나면 초과스레드는 사라진다.</p>
<h2>Executor 스레드 풀 관리 - 분석</h2>
<p>그림을 통해 분석해보자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 71.484375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABk0lEQVQ4y41US07DMBDtAqmC0jaOYzufNpXapFUXKVRiCezgCiwQJ0Cs2bDmBFyAe3C3h95UE0qh0MWTZ+yZ55l5TjpJkuAH3JdtrT0YjO/sEtnYwhrb7oUQ/kDa2t77n4Qk87lHKIPcyMAsyySYcM5t7BDEVp8r47i2hC44uFOHi5cLXL9fyWHwAc47DIdDiZlOp0JgTIQ8z1HXNeq6QlEU7cWddgaJRe4KrO4brJ4aSWCFOsc0TSVBEm2Eu9cP3D6+oX98hMR5jMfjTYUMoEMC2nZgEZ0YZHmG5XIpZ9oOK5U2kxiXd884u3nAoNdFbC1Go9GGcDKZYD6fS6IoRYV9IhWtz9dYLBZyGatTQvrDXhf9ky5MHCOO468KtQ062wJxn6QELyrLEk3TYDabyXma5aiqWrpgDOf4TZRdqMoMiqKo9XlmjBGImM6JrS9hL6G+wY2qRtoisdqEEhMae3CFmkhbsb33b4W/PWz6FITz0meklalwf7Ysj3vnc6PqFKeqqpZw76e3r9Jt6Oy4/vZz+ASIUmRz7wKSZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image1"
        title="image1"
        src="/static/b0bc2b5dd77942ff04cc7e99410eb2e6/2bef9/01.png"
        srcset="/static/b0bc2b5dd77942ff04cc7e99410eb2e6/6f3f2/01.png 256w,
/static/b0bc2b5dd77942ff04cc7e99410eb2e6/01e7c/01.png 512w,
/static/b0bc2b5dd77942ff04cc7e99410eb2e6/2bef9/01.png 1024w,
/static/b0bc2b5dd77942ff04cc7e99410eb2e6/71c1d/01.png 1536w,
/static/b0bc2b5dd77942ff04cc7e99410eb2e6/1acf3/01.png 1596w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>task1이 작업을 요청한다. 그러면 Executor는 스레드 풀에 coreSize만큼 스레드가 있는지 확인한다. 지금은 하나도 없으므로 스레드를 하나 새로 생성한다. 스레드를 하나 생성했기에 대기 큐에 넣을 필요 없이 바로 스레드가 처리한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 73.046875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7klEQVQ4y5WUPW8TQRCGT6JAEN/dfu+d7yO2d30msSKshAIEAildJISi9LQUdLT8ABrKtIgGCmp+Cf/oRTP2BhthCRej252dffadndnLjDFgswbWWdzNN6a1PsiyBJMjCflAwuhdoHOOzXv/D6t25tZaZATTQiNeRZy9O4NvPYxaw6qqYtvesA1P8+Qbj8fIKE15JHHx8RyXPy9Rz2qoUkEbjbquOQ0hBJRSmE6naJoGUkpoJTGbzTDMI0KMDGUgp2UdJqfHCE8CmrZhVUkhAQlGcFJRVTWcKvDs+j3e3v5CF04gygLOe3Rdh4w20cBqC1UoWGPhK4/JZIIQAitKKZJSKRWckXj86gZXH76iao5RFjmnz0DaNAwDQ+g+UzHooNVqheVyyTBSmOc5iqJA07VwVuLo/j3k+YgPugNSIOWeWiQBCULqCEzBNF4sFpjP53DCwQmPpm3Z1/c9x1FM9nffbfcfHUbjpICuoe96xNcR8U2Elpp9BKMYiv8vIFWVjNIVpcCLL0/x8vtziHzj47uVhwGp0kppiGKE60/fcPP5B8rRQ6hNFxwEXMMU+6iiXThHFy64XRIwtdZeYHp2VLBUOPpSR5yeDHi0CFxVuj9aS+vZtqJ9StMafdfVb7mi1pqdtT8/hwMsvZx9An4DbryDY+IoJEUAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image2"
        title="image2"
        src="/static/44be9885f9d5e81ed2672bf602c8d2df/2bef9/02.png"
        srcset="/static/44be9885f9d5e81ed2672bf602c8d2df/6f3f2/02.png 256w,
/static/44be9885f9d5e81ed2672bf602c8d2df/01e7c/02.png 512w,
/static/44be9885f9d5e81ed2672bf602c8d2df/2bef9/02.png 1024w,
/static/44be9885f9d5e81ed2672bf602c8d2df/71c1d/02.png 1536w,
/static/44be9885f9d5e81ed2672bf602c8d2df/df438/02.png 1556w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>task2가 작업을 요청한다. 그러면 Executor는 스레드 풀에 coreSize만큼 스레드가 있는지 확인한다. 지금은 스레드가 1개 있고 coreSize는 2개이므로 1개 더 생성할 수 있다. 그래서 스레드를 하나 생성한다. 그리고 task2를 수행한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.3125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB0klEQVQ4y5VUy4oTQRQNOLiI6aSq693vh61OjyM6WZi0TgYGBFcu3bhz4Vr0F1z4BSIoCOJHCPpvR25ptQmMk3FxoPo+zj237q2eSCmxD0IIXCWOMLnMqbVGkiRwzsElDtZZfw42a62H9zu3S0gqAoKNguI49uARhxHG+znnoz/EGGO8gJGQDAFKKR9EwZTMGUd9UqN/1MMa6xOzLENd12iaxiumb8qbbFcKLVBAmqYeQgrImcTm4ylWH1ZQTHk/5THGPKh4nue/CauqQtu2nogc1FJQsFwu0d5soeYKZ583GD6tIRYCLnW+EOPMg7oYFRZFASKlVreHQYq7rkNRFlALheHdGsP7AVZaaK6hlfZ36rSD0uqvQiKgw0VTpiJUndrKyxyH/SGqrkZ+UsCVDkebu+gfHkHEwm/AzlAuAt3VOOWYI7oeoRgynH9foXvWYv3lAY7f3sHsWgTjzH7CsBKkUkiJ+XSKbr3Cy58/cPz0CZ5/+4qzN69x4+AANkn+T2EcCzC2gNQp7p+/gjYF7p2+QNM/xjyawlq3n3D7FdA5TTPcvtWha2gHSwg+g1a0r4kvPg7lsje8DUqgaZZV/WcXFaRSOzGTqz76gPFO//HD+AXf520QUQhVrwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image3"
        title="image3"
        src="/static/3ef242dcf3f8d512f7ac90286b3ce495/2bef9/03.png"
        srcset="/static/3ef242dcf3f8d512f7ac90286b3ce495/6f3f2/03.png 256w,
/static/3ef242dcf3f8d512f7ac90286b3ce495/01e7c/03.png 512w,
/static/3ef242dcf3f8d512f7ac90286b3ce495/2bef9/03.png 1024w,
/static/3ef242dcf3f8d512f7ac90286b3ce495/71c1d/03.png 1536w,
/static/3ef242dcf3f8d512f7ac90286b3ce495/ddb6a/03.png 1592w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>다음으로 task3이 들어온다. 그러면 Executor는 스레드 풀에 coreSize만큼 스레드가 있는지 확인한다. 그런데 현재 이미 스레드 풀에 coreSize만큼 존재한다. 그래서 task3은 대기 큐에 대기한다. 후에 task4도 들어올텐데 이 작업도 대기 큐에 들어간다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 77.734375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACVUlEQVQ4y42US48SQRDHuRiyCDM9j+6enmFezMAAQowCgo/N+oi4e9jLGr2QuPGw0Xjwu/g9TMxGP4Hx7Ff6m2oYmH1lPVS6qh+/qq6q7prrunC5Cy64HrW9EcdxLtjl3OX5ql0jiGM5sBqWHqtQzjmEEDeKlFIL6bRXAwmiMoXucVePGuq6epNSCp7nwVMepJIQUqxtz9uCSjDtJb1GkeXLDEd/D5EtMx0pRUmHyCtjDGbLhGgJBDKAZVkwGQMXAnGSIEmS7W3ojI4wGkQYvR8hHsaQXG4jJCFYkAeYfJ6gOCjg2hydOMLx9CHGeQ7l+xoUhuEa6Ps+lFSwGza4s/bSbreRpin8wIdjOMgWGd78WWL4cQDWsNDrpHg3m6JoB2gahr4FndHAPM813eG7StFCURSYL+bgjKP3tIfl79fon/ZhN2204xCGacC0GBhJFRhFkU5otfSUZHKSJDG4zRGPY+x/e4bx2zGEISAdCcElfO4j8AKdmi3wun6zbVtvIt00TW1naYaiWyC+nyDeT6A6CtOTKYaLIZjBth1Qu9y4pQNaJChVlYCmZeLunSZGX/p4fv4Y2VEHBz/nKE5zGHUDwvsPYNk2BHVcF8beHp6cnWH1/QcGL1/gw/kvzFYrNOt1CClvB1IuKboyJcxoIurO8ODVJ3AR4NHhV8TdCZjZgtw0/LXAKy9lA0+SFPeGPRR5iCSOYBl1CEHO1e6l3AS8XCzS6YAfBAja4bponArHL3wYO+Bm8jahFFTTcOW32f4YmwdOL6cUVdFLKa8vpYfq2XLuH+c+pM6+hdH0AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image4"
        title="image4"
        src="/static/69b8c967a8c2ff2f889a7a958a210a64/2bef9/04.png"
        srcset="/static/69b8c967a8c2ff2f889a7a958a210a64/6f3f2/04.png 256w,
/static/69b8c967a8c2ff2f889a7a958a210a64/01e7c/04.png 512w,
/static/69b8c967a8c2ff2f889a7a958a210a64/2bef9/04.png 1024w,
/static/69b8c967a8c2ff2f889a7a958a210a64/71c1d/04.png 1536w,
/static/69b8c967a8c2ff2f889a7a958a210a64/e405b/04.png 1566w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>다음으로 task5가 들어온다. 그러면 Executor는 스레드 풀에 coreSize만큼 스레드가 있는지 확인한다. 이미 coreSize만큼 존재한다. 그래서 대기큐로 보내려고 봤더니 대기큐도 꽉 찼다. 큐가 가득차면 긴급 상황이다. 대기하는 작업이 꽉 찰 정도로 요청이 많다는 뜻이다. 이 경우 <code>Executor</code>는 max(<code>maximumPoolSize</code>) 사이즈까지 <strong>초과 스레드</strong>를 만들어서 작업을 수행한다. 즉 <code>maximumPoolSize</code>로 설정한 4개에서 기본 스레드 2개를 제외한 총 2개의 초과 스레드를 만들 수 있는 것이다. 초과 스레드를 만들어 task5를 수행한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.53125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDUlEQVQ4y5WTz4oTQRDGc5ZNpifT/6Z7ejIz2dkkBjdrJiiLRJNAyM2D4kFYxRU9CXrSmwfxBQRB8CEUxIPgxUf7pDo7IRvWxT18VFd316+qq7sbnHNEUQSytci/irZjGtugXaiUEsYaxHEMYwx0rP24llLKS2u98RvbgF1LGwkatkOwJoMMJXjEvS+EQJqmKIoC1lofQ0k3wDpLDWm32z6jkAKsxZBPcowfjJF0EmilobTyIOfcJpb8BmWiAU0QqD5OkiTrOS3BmxyTtxUWP+dQXQWrLbjgCIIAjDFvCeqBVHK32/XBVFXdXFqsqgq9fg861KjeVVj8WkDmAja268oZAwuZt9po2MSiQSWT6HgEoorrFpRlibzIIZjA6PkIs8/3kJYpVFuDhxxKKDjh/FgGEiY+62EN2b1lmicFrQCxiTFeVeiP+zADi2TocHBcYvp6inJaYvhkCDdwlz8bf0FKItgLoPYVpt8nGLwsUX28gdufRuifDDD/PcfozQjLP0sUs+JyILWBgK29Jkye4eTHNxy/OMXqw3vc//oFR8MCTx/exa2bB3j2aIZ+ma2Buz/lHJDeYRj6C5usXsF1x9g/XOL6ncfQjOHQdGAjgSPbgTP2P34K/RCtvSJ2Dd0iQ6/MUWQWOo7BtYTSGiJev81/Ai+UkEicQyfL4NLOuTVxZq8G5NwfvW7BRet/AT4udTrMTKb6AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image5"
        title="image5"
        src="/static/7e2b76dbeec3cbf774fea22a9da5b00b/2bef9/05.png"
        srcset="/static/7e2b76dbeec3cbf774fea22a9da5b00b/6f3f2/05.png 256w,
/static/7e2b76dbeec3cbf774fea22a9da5b00b/01e7c/05.png 512w,
/static/7e2b76dbeec3cbf774fea22a9da5b00b/2bef9/05.png 1024w,
/static/7e2b76dbeec3cbf774fea22a9da5b00b/71c1d/05.png 1536w,
/static/7e2b76dbeec3cbf774fea22a9da5b00b/d1882/05.png 1562w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>task6이 들어오면 이처럼 초과 스레드를 만들어 처리를 할 것이다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 76.56250000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACP0lEQVQ4y52Uz2vUQBTH9yRU6iYzk5nMj6TJZk2Mm9had4vtIlQsa6tsQVYEURTRg+DRm3goePIP8KY3QfCgR/8I8X/6ykyaXVcLCx4eM+/NzOe9+c5LOkEQoDUecgR84f+PddoJowz+OR+0S5egjLF/Dp0VWwB5AEYYVKowOhki2++BXmigQghorSGlhFQSoQoRhmHjS+nmdo8dlVIu5oDUY9CFxsGPWygflCBrBIyz+SFCCYhHYJiBVhqUUnDOkaYpiqJAHMfOt8nnV7YZ4l4MExsoqdwGm50Lju75Lvp7GcbvxkiqBIIJaKPn1bUwB2yvZYxxOlq4jdmsWZYhSROwdYbq/gB3f92B2TYQvkAoQ/i+D0IIPM9zt7GMThRFruwkSZZEt0nKssRoZwThCVSzAY5+HsJsawgioIyawyx4DrTl9nq9pkLG5g9hzQmtJKhHkW6n2H21i2JQIOhycF8gNhHKvISWGloop6/TMM9zVFXlKq3rGrZqm719Rc/3HHT4cgtbj2tkhwnKZ33k0xwHXyaoXtS4/mkPG6ONP/rwr96yfgu0cOpTTL4/xPj9EUav93H72yPU08s4/nATO083Mfs4Qf9augCe1bztC/o+QXd9DcdvP+PGkzcYTp9jevIVuTS4V27iiooxG1xFZqLVQKujax8eQMoIUlptNUyUNjEVutZSWrq9nVXfpoUt+i1A/2Lf6VyWlxyAn641SflqoK20NetTyhpN6SLmxtN5Z/UfhC+ZraK1gC+vWf83ADOQIpouHp8AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image6"
        title="image6"
        src="/static/b207048dfae293b8f7e6464fed75976c/2bef9/06.png"
        srcset="/static/b207048dfae293b8f7e6464fed75976c/6f3f2/06.png 256w,
/static/b207048dfae293b8f7e6464fed75976c/01e7c/06.png 512w,
/static/b207048dfae293b8f7e6464fed75976c/2bef9/06.png 1024w,
/static/b207048dfae293b8f7e6464fed75976c/71c1d/06.png 1536w,
/static/b207048dfae293b8f7e6464fed75976c/ae28e/06.png 1598w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>task7이 들어오면 기본 스레드도 꽉 찼고 초과 스레드도 꽉 찼고 대기 큐도 가득 차서 작업을 수행을 못한다. 그래서 <code>RejectedExecutionException</code>을 발생시키고 해당 작업을 거절한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75.390625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1UlEQVQ4y61UTW/UMBTMjVsTJxvbsZ3uxmw2Jbu0ZfkSFChbJITECQ5ICAEnDiABav9RkbiBxI2fN2hMvSyo7YLE4ckvk/G8zyQZDAb4n5asIxRFcab9yfsrwaqqoLVenqu+lDKYUipg9JPTMokYCSTmeR6Mz8Tpl2WJ4XAI7z2cc0tuEsUYxRgTIpNMjCfxLMvCBV6u6zrgvEw+xaK/FOQDjUQK0rfWBjFi5BAXQiDyGSBN0xCMZxRNRqMRJpNJEGApMTO+7PseXdcte7aRbgTR0C8lkYkMIhfhrGwFYw0SCrEMkmL/YqkMREFmQ57VFs44aKmhSw1VKpjCQOYSWmhU6qTkWNaqEVvtITO8sriKS/Me2lcwnUWz22DvzR7Gd8bonnTYnNZnr81vQ0kzFGWBW5+3Mf3QYvtwC7ePd9A+bXHv213sHu3g4PsC7eP2/D38JZiiKAd4/vUT9o/eYf/wLZ59OcZs5vHqxX3cvNHh9csDzKb+fEH2Lk5XZCmuP/qIi5cfwE8XmD98Dy1yzOsGdSFxbdNjZNz6DONu0vL0Anzj0G+NMW4qaC69LCGVQqEklFbrP73VoUnFz87AOgfrfi64PBle5CT/+jfhsOK+nva3+QGoGoiz9CH7yAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="image7"
        title="image7"
        src="/static/24da1c71cf4b859a917eeb6585d08fbe/2bef9/07.png"
        srcset="/static/24da1c71cf4b859a917eeb6585d08fbe/6f3f2/07.png 256w,
/static/24da1c71cf4b859a917eeb6585d08fbe/01e7c/07.png 512w,
/static/24da1c71cf4b859a917eeb6585d08fbe/2bef9/07.png 1024w,
/static/24da1c71cf4b859a917eeb6585d08fbe/71c1d/07.png 1536w,
/static/24da1c71cf4b859a917eeb6585d08fbe/c8ad9/07.png 1564w"
        sizes="(max-width: 1024px) 100vw, 1024px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>이후 작업이 끝나면 대기 큐에 있는 작업을 꺼내서 작업을 수행한다. 이와 같은 과정을 반복하다가 <code>close()</code> 메서드를 만나면 전부 종료된다.</p>
<h3>스레드 미리 생성하기</h3>
<p>응답시간이 아주 중요한 서버라면, 서버가 고객의 처음 요청을 받기 전에 스레드를 스레드 풀에 미리 생성해두고 싶을 수 있다. 스레드를 미리 생성해두면, 처음 요청에서 사용되는 스레드의 생성 시간을 줄일 수 있다. <code>ThreadPoolExecutor.prestartAllCoreThreads()</code>를 사용하면 기본 스레드를 미리 생성할 수 있다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">thread<span class="token punctuation">.</span>executor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">ExecutorUtils</span><span class="token punctuation">.</span><span class="token static">printState</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreStartPoolMain</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ThreadPoolExecutor</span> poolExecutor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">)</span> es<span class="token punctuation">;</span>
        poolExecutor<span class="token punctuation">.</span><span class="token function">prestartAllCoreThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        es<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<h2>Executor 전략 - 고정 풀 전략</h2>
<p>자바는 <code>Executors</code> 클래스를 통해 3가지 기본 전력을 제공한다.</p>
<ul>
<li><strong>newSingleThreadPool()</strong>: 단일 스레드 풀 전략</li>
<li><strong>newFixedThreadPool(nThreads)</strong>: 고정 스레드 풀 전략</li>
<li><strong>newCachedThreadPool()</strong>: 캐시 스레드 풀 전략</li>
</ul>
<h3>newSingleThreadPool(): 단일 스레드 풀전략</h3>
<ul>
<li>스레드 풀에 기본 스레드 1개만 사용한다.</li>
<li>큐 사이즈에 제한이 없다. (<code>LinkedBlockingQueue</code>)</li>
<li>주로 간단히 사용하거나, 테스트 용도로 사용한다.</li>
</ul>
<p>위의 전략은 아래와 같은 코드이다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<h3>Executor 스레드 풀 관리 - 고정 풀 전략</h3>
<h4><strong>newFixedThreadPool(nThreads)</strong></h4>
<ul>
<li>스레드 풀에 <code>nThreads</code> 만큼의 기본 스레드를 생성한다. 초과 스레드는 생성하지 않는다.</li>
<li>큐 사이즈에 제한이 없다. (<code>LinkedBlockingQueue</code>)</li>
<li>스레드 수가 고정되어 있기 때문에 CPU, 메모리 리소스가 어느정도 예측 가능한 안정적인 방식이다.</li>
</ul>
<p>위의 전략은 아래와 같은 코드이다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span> <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<h4>특징</h4>
<p>스레드 수가 고정되어 있기 때문에 CPU, 메모리 리소스가 어느정도 예측 가능한 안정적인 방식이다. 큐 사이즈도 제한이 없어서 작업을 많이 담아두어도 문제가 없다.</p>
<blockquote>
<p>⚠️ 주의</p>
<p>이 방식의 가장 큰 장점은 스레드 수가 고정되어서 CPU, 메모리 리소스가 어느정도 예측 가능하다는 점이다. 따라서 일 반적인 상황에 가장 안정적으로 서비스를 운영할 수 있다. 하지만 상황에 따라 장점이 가장 큰 단점이 되기도 한다.</p>
</blockquote>
<h4><strong>상황1 - 점진적인 사용자 확대</strong></h4>
<ul>
<li>개발한 서비스가 잘 되어서 사용자가 점점 늘어난다.</li>
<li>고정 스레드 전략을 사용해서 서비스를 안정적으로 잘 운영했는데, 언젠가부터 사용자들이 서비스 응답이 점점 느리진다고 항의한다.</li>
</ul>
<h4><strong>상황2 - 갑작스런 요청 증가</strong></h4>
<ul>
<li>마케팅 팀의 이벤트가 대성공 하면서 갑자기 사용자가 폭증했다.</li>
<li>고객은 응답을 받지 못한다고 항의한다.</li>
</ul>
<h4>확인</h4>
<ul>
<li>개발자는 급하게 CPU, 메모리 사용량을 확인해보는데, 아무런 문제 없이 여유있고, 안정적으로 서비스가 운영되고 있다.</li>
<li>고정 스레드 전략은 실행되는 스레드 수가 고정되어 있다. 따라서 사용자가 늘어나도 CPU, 메모리 사용량이 확 늘어나지 않는다.</li>
<li>큐의 사이즈를 확인해보니 요청이 수 만 건이 쌓여있다. 요청이 처리되는 시간보다 쌓이는 시간이 더 빠른 것이다. 참고로 고정 풀 전략의 큐 사이즈는 무한이다.</li>
<li>서비스 초기에는 사용자가 적기 때문에 이런 문제가 없지만, 사용자가 늘어나면 문제가 될 수 있다.</li>
<li>선착순 이벤트 같은 갑작스러운 요청도 마찬가지다.</li>
</ul>
<p>결국 서버 자원은 여유가 있는데, 사용자만 점점 느려지는 문제가 발생한 것이다.</p>
<h2>Executor 전략 - 캐시 풀 전략</h2>
<h3><strong>newCachedThreadPool()</strong></h3>
<ul>
<li>기본 스레드를 사용하지 않고, 60초 생존 주기를 가진 초과 스레드만 사용한다.</li>
<li>초과 스레드의 수는 제한이 없다.</li>
<li>큐에 작업을 저장하지 않는다. (<code>SynchronousQueue</code>)
<ul>
<li>대신에 생산자의 요청을 스레드 풀의 소비자 스레드가 직접 받아서 바로 처리한다.</li>
</ul>
</li>
<li>모든 요청이 대기하지 않고 스레드가 바로바로 처리한다. 따라서 빠른 처리가 가능하다.</li>
</ul>
<p>위의 전략은 아래의 코드와 같은 것이다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">,</span> <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<p><code>SynchronousQueue</code>는 아주 특별한 블로킹 큐이다.</p>
<ul>
<li><code>BlockingQueue</code> 인터페이스의 구현체 중 하나이다.</li>
<li>이 큐는 내부에 저장 공간이 없다. 대신에 생산자의 작업을 소비자 스레드에게 직접 전달한다.</li>
<li>쉽게 이야기해서 저장 공간의 크기가 0이고, 생산자 스레드가 큐가 작업을 전달하면 소비자 스레드가 큐에서 작업을 꺼낼 때 까지 대기한다.</li>
<li>소비자 작업을 요청하면 기다리던 생산자가 소비자에게 직접 작업을 전달하고 반환된다. 그 반대의 경우도 같다.</li>
<li>이름 그대로 생산자와 소비자를 동기화하는 큐이다.</li>
<li>쉽게 이야기해서 중간에 버퍼를 두지 않는 스레드간 직거래라고 생각하면 된다.</li>
</ul>
<p>캐시 스레드 풀 전략은 매우 빠르고, 유연한 전략이다. 이 전략은 기본 스레드도 없고, 대기 큐에 작업도 쌓이지 않는다. 대신에 작업 요청이 오면 초과 스레드로 작업을 바로바로 처리한다. 따라서 빠른 처리가 가능하다. 초과 스레드의 수도 제한이 없기 때문에 CPU, 메모리 자원만 허용한다면 시스템의 자원을 최대로 사용할 수 있다. 추가로 초과 스레드는 60초간 생존하기 때문에 작업 수에 맞추어 적절한 수의 스레드가 재사용된다. 이런 특징 때문에 요청이 갑자기 증가하면 스레드도 갑자기 증가하고, 요청이 줄어들면 스레드도 점점 줄어든다.</p>
<p>동작 과정은 다음과 같다.</p>
<ul>
<li>사용자 작업 요청이 온다. 그러면 Executor는 coreSize를 확인하여 기본 스레드를 몇개 만들 수 있는지 확인한다.</li>
<li>캐시 풀 전략은 기본 스레드가 0이므로 대기 큐 사이즈로 보낼 것이다.</li>
<li>그런데 대기 큐 사이즈도 0이다. 따라서 초과 스레드를 생성하는 것이다.</li>
<li>해당 초과 스레드는 60초동안 유지하므로 재사용도 가능하다.</li>
</ul>
<blockquote>
<p>⚠️ 주의</p>
<p>이 방식은 작업 수에 맞추어 스레드 수가 변하기 때문에, 작업의 처리 속도가 빠르고, CPU, 메모리를 매우 유연하게 사용할 수 있다는 장점이 있다. 하지만 상황에 따라서 장점이 가장 큰 단점이 되기도 한다.</p>
</blockquote>
<h4><strong>상황1 - 점진적인 사용자 확대</strong></h4>
<ul>
<li>개발한 서비스가 잘 되어서 사용자가 점점 늘어난다.</li>
<li>캐시 스레드 전략을 사용하면 이런 경우 크게 문제가 되지 않는다.</li>
<li>캐시 스레드 전략은 이런 경우에는 문제를 빠르게 찾을 수 있다. 사용자가 점점 증가하면서 스레드 사용량도 함께 늘어난다. 따라서 CPU 메모리의 사용량도 자연스럽게 증가한다.</li>
<li>물론 CPU, 메모리 자원은 한계가 있기 때문에 적절한 시점에 시스템을 증설해야 한다. 그렇지 않으면 CPU, 메모리 같은 시스템 자원을 너무 많이 사용하면서 시스템이 다운될 수 있다.</li>
</ul>
<h4><strong>상황2 - 갑작스런 요청 증가</strong></h4>
<ul>
<li>마케팅 팀의 이벤트가 대성공 하면서 갑자기 사용자가 폭증했다.</li>
<li>고객은 응답을 받지 못한다고 항의한다.</li>
</ul>
<h4><strong>상황2 - 확인</strong></h4>
<ul>
<li>개발자는 급하게 CPU, 메모리 사용량을 확인해보는데, CPU 사용량이 100%이고, 메모리 사용량도 지나치게 높아져있다.</li>
<li>스레드 수를 확인해보니 스레드가 수 천개 실행되고 있다. 너무 많은 스레드가 작업을 처리하면서 시스템 전체가 느려지는 현상이 발생한다.</li>
<li>캐시 스레드 풀 전략은 스레드가 무한으로 생성될 수 있다.</li>
<li>수 천개의 스레드가 처리하는 속도 보다 더 많은 작업이 들어온다.</li>
<li>시스템은 너무 많은 스레드에 잠식 당해서 거의 다운된다. 메모리도 거의 다 사용되어 버린다.</li>
<li>시스템이 멈추는 장애가 발생한다.</li>
</ul>
<p>고정 스레드 풀 전략은 서버 자원은 여유가 있는데, 사용자만 점점 느려지는 문제가 발생할 수 있다. 반면에 캐시 스레드 풀 전략은 서버의 자원을 최대한 사용하지만, 서버가 감당할 수 있는 임계점을 넘는 순간 시스템이 다운될 수 있다.</p>
<h2>Executor 전략 - 사용자 정의 풀 전략</h2>
<p>위와 같은 두 상황에서 고정 풀 전략을 쓰기도 좀 그렇고 캐시 풀 전략을 쓰기도 그렇다. 이럴 때는 우리가 커스터마이징을 하면 된다. 즉, 일반적인 상황에서는 고정 풀 전략을 가져가다가 사용자 요청이 급증하면 캐시 풀 전략으로 잠시 바꾸다가 요청이 폭증하면 새로운 요청을 거절하는 방식으로 하면 좋을 것 같다. 그래서 보통 실무에서는 아래와 같이 가져간다고 한다.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<p>코드를 통하여 살펴보자.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>poolsize</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">RunnableTask</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">ExecutorUtils</span><span class="token punctuation">.</span><span class="token static">printState</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">util<span class="token punctuation">.</span></span><span class="token class-name">MyLogger</span><span class="token punctuation">.</span><span class="token static">log</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PoolSizeMainV4</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TASK_SIZE</span> <span class="token operator">=</span> <span class="token number">1100</span><span class="token punctuation">;</span> <span class="token comment">// 1. 일반</span>
<span class="token comment">//    static final int TASK_SIZE = 1200; // 2. 긴급</span>
<span class="token comment">//    static final int TASK_SIZE = 1201; // 3. 거절</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span>
                <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> startMs <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token constant">TASK_SIZE</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> taskName <span class="token operator">=</span> <span class="token string">"task"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span>taskName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">printState</span><span class="token punctuation">(</span>es<span class="token punctuation">,</span> taskName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RejectedExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">log</span><span class="token punctuation">(</span>taskName <span class="token operator">+</span> <span class="token string">" -> "</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        es<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> endMs <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"time: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endMs <span class="token operator">-</span> startMs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>일반적인 상황을 보자. 1000개의 작업이 대기 큐에 있고 100개의 기본 스레드가 작업을 수행하고 있다고 하자. 하나의 작업이 1초정도 걸린다면 대략 11초 정도 걸린다.</p>
<p>긴급 상황을 보자. 큐에 작업이 1000개 대기하고 있는데 그것을 초과하는 요청이 온다. 물론 기본 스레드가 100개 작업을 돌리고 있다. 그러면 초과 스레드를 생성하여 작업을 수행한다. 해당 초과 스레드 덕분에 일반적인 상황보다 더 빨리 끝난다. 대략 6초정도 걸린다.</p>
<p>이제 거절 상황을 보자. 큐에 작업이 1000개 대기 하고 있고 초과 스레드도 100개 기본 스레드도 100개를 작업을 돌린다. 그런데 새로운 요청이 오면 <code>RejectedExecutionException</code>을 발생한다.</p>
<h3>실무에서 자주 하는 실수</h3>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<p>만약 이렇게 설정하면 문제가 발생한다. 왜냐하면 <code>LinkedBlockingQueue</code>는 사이즈가 무한대라서 초과 스레드가 생기지 않아서 긴급 상황이 오지를 않는 것이다.</p>
<h2>Executor 예외 정책</h2>
<p>Executor에는 다양한 예외 정책이 존재한다. 한번 살펴보자.</p>
<h3>AbortPolicy</h3>
<p>작업이 거절되면 <code>RejectedExecutionException</code>을 던진다. 기본적으로 설정되어 있는 정책이다.</p>
<ul>
<li><code>ThreadPoolExecutor</code> 생성자 마지막에 <code>new ThreadPoolExecutor.AbortPolicy()</code>를 제공하면 된다.</li>
<li>참고로 이것이 기본 정책이기 때문에 생략해도 된다.</li>
<li><code>ThreadPoolExecutor</code>를 <code>shutdown()</code>을 하면 이후에 요청하는 작업을 거절하는데, 이때도 같은 정책이 적용된다.</li>
</ul>
<p>실무에서는 보통 <code>RejectedExecutionException</code>을 잡아서 재시도 로직을 수행하거나 예외 응답을 보낸다.</p>
<h3>DiscardPolicy</h3>
<p>거절된 작업을 무시하고 아무런 예외도 발생시키지 않는다.</p>
<ul>
<li><code>ThreadPoolExecutor</code> 생성자 마지막에 <code>new ThreadPoolExecutor.DiscardPolicy()</code>를 제공하면 된다.</li>
<li><code>ThreadPoolExecutor</code>를 <code>shutdown()</code>을 하면 이후에 요청하는 작업을 거절하는데, 이때도 같은 정책이 적용된다.</li>
</ul>
<h3>CallerRunsPolicy</h3>
<p>호출한 스레드가 직접 작업을 수행하게 한다. 이로 인해 새로운 작업을 제출하는 스레드의 속도가 느려질 수 있다.</p>
<p>이 정책의 특징은 생산자 스레드가 소비자 대신 일을 수행하는 것도 있지만, 생산자 스레드가 대신 일을 수행하는 덕분에 작업의 생산 자체가 느려진다는 점이다. 덕분에 작업의 생산 속도가 너무 빠르다면, 생산 속도를 조절할 수 있다. 즉, <code>main</code>스레드가 생산자라면 <code>main</code>스레드가 요청한 작업을 직접 수행하는 것이다. 엄밀히 보면 수행하는 동안은 당연히 블로킹이 된다. 참고로 <code>ThreadPoolExecutor</code> 를 <code>shutdown()</code> 을 하면 이후에 요청하는 작업을 거절하는데, 이때도 같은 정책이 적용된다. 그런데 <code>CallerRunsPolicy</code> 정책은 <code>shutdown()</code> 이후에도 작업을 수행해버린다. 따라서 <code>shutdown()</code> 조건을 체크해서 이 경우에는 작업을 수행하지 않도록 한다.</p>
<h3>사용자 정의</h3>
<p>사용자는 <code>RejectedExecutionHandler</code> 인터페이스를 구현하여 자신만의 거절 처리 전략을 정의할 수 있다. 이를 통해 특정 요구사항에 맞는 작업 거절 방식을 설정할 수 있다. 코드를 보자.</p>
<div class="gatsby-highlight" data-language="java"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-java line-numbers"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>reject</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">thread<span class="token punctuation">.</span>executor<span class="token punctuation">.</span></span><span class="token class-name">RunnableTask</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">util<span class="token punctuation">.</span></span><span class="token class-name">MyLogger</span><span class="token punctuation">.</span><span class="token static">log</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RejectMainV4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyRejectedExecutionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunnableTask</span><span class="token punctuation">(</span><span class="token string">"task4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        executor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyRejectedExecutionHandler</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">{</span>

        <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rejectedExecution</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">ThreadPoolExecutor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"[경고] 거절된 누적 작업의 수: "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>위의 코드에서는 task1을 스레드 풀의 스레드를 생성하여 수행하고 나머지 작업은 우리가 구현한 핸들러가 처리를 하는데 여기서는 <code>main</code>스레드가 처리하게 될 것이다.</p>
<blockquote>
<p>잘못된 지식이 있을 경우 댓글로 남겨주시면 빠르게 반영하겠습니다!</p>
</blockquote></section></div><style data-emotion="css 1aem3cm">.css-1aem3cm{max-width:900px;width:100%;margin:0 auto;box-sizing:border-box;padding:0;}</style><div class="css-1aem3cm etanzsa0"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8854437638395695" data-ad-slot="5104795204" data-ad-format="auto" data-full-width-responsive="true"></ins></div><section id="comments"></section><style data-emotion="css 1ylimja">.css-1ylimja{max-width:900px;width:100%;margin:4rem auto;box-sizing:border-box;padding:2rem 2rem;border-top:1px solid #EAEAEA;}.css-1ylimja>p{margin-bottom:1.5rem;font-size:1.8rem;color:#000;}.css-1ylimja>a{border:none!important;outline:none!important;-webkit-transition:none!important;transition:none!important;background:none!important;}.css-1ylimja>a:hover{background:none!important;border-color:none!important;}</style><div class="css-1ylimja e1x2ajq20"><style data-emotion="css toutqs">.css-toutqs{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:50px;height:50px;}</style><div size="50" class="css-toutqs e3bks2o1"><style data-emotion="css 1rrjf5z animation-8013mu">.css-1rrjf5z{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-1.2s;animation-delay:-1.2s;-webkit-transform:rotate(0deg) translate(146%);-moz-transform:rotate(0deg) translate(146%);-ms-transform:rotate(0deg) translate(146%);transform:rotate(0deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1rrjf5z e3bks2o0"></div><style data-emotion="css rcjasa animation-8013mu">.css-rcjasa{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-1.0999999999999999s;animation-delay:-1.0999999999999999s;-webkit-transform:rotate(30deg) translate(146%);-moz-transform:rotate(30deg) translate(146%);-ms-transform:rotate(30deg) translate(146%);transform:rotate(30deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-rcjasa e3bks2o0"></div><style data-emotion="css 1gsjy2j animation-8013mu">.css-1gsjy2j{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-1s;animation-delay:-1s;-webkit-transform:rotate(60deg) translate(146%);-moz-transform:rotate(60deg) translate(146%);-ms-transform:rotate(60deg) translate(146%);transform:rotate(60deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1gsjy2j e3bks2o0"></div><style data-emotion="css vgd4ml animation-8013mu">.css-vgd4ml{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.8999999999999999s;animation-delay:-0.8999999999999999s;-webkit-transform:rotate(90deg) translate(146%);-moz-transform:rotate(90deg) translate(146%);-ms-transform:rotate(90deg) translate(146%);transform:rotate(90deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-vgd4ml e3bks2o0"></div><style data-emotion="css nlaijy animation-8013mu">.css-nlaijy{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.7999999999999999s;animation-delay:-0.7999999999999999s;-webkit-transform:rotate(120deg) translate(146%);-moz-transform:rotate(120deg) translate(146%);-ms-transform:rotate(120deg) translate(146%);transform:rotate(120deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-nlaijy e3bks2o0"></div><style data-emotion="css ljpo5z animation-8013mu">.css-ljpo5z{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.7s;animation-delay:-0.7s;-webkit-transform:rotate(150deg) translate(146%);-moz-transform:rotate(150deg) translate(146%);-ms-transform:rotate(150deg) translate(146%);transform:rotate(150deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-ljpo5z e3bks2o0"></div><style data-emotion="css 1lesjdn animation-8013mu">.css-1lesjdn{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.5999999999999999s;animation-delay:-0.5999999999999999s;-webkit-transform:rotate(180deg) translate(146%);-moz-transform:rotate(180deg) translate(146%);-ms-transform:rotate(180deg) translate(146%);transform:rotate(180deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1lesjdn e3bks2o0"></div><style data-emotion="css s8balg animation-8013mu">.css-s8balg{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.4999999999999999s;animation-delay:-0.4999999999999999s;-webkit-transform:rotate(210deg) translate(146%);-moz-transform:rotate(210deg) translate(146%);-ms-transform:rotate(210deg) translate(146%);transform:rotate(210deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-s8balg e3bks2o0"></div><style data-emotion="css q46j30 animation-8013mu">.css-q46j30{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.3999999999999999s;animation-delay:-0.3999999999999999s;-webkit-transform:rotate(240deg) translate(146%);-moz-transform:rotate(240deg) translate(146%);-ms-transform:rotate(240deg) translate(146%);transform:rotate(240deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-q46j30 e3bks2o0"></div><style data-emotion="css vl20np animation-8013mu">.css-vl20np{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.29999999999999993s;animation-delay:-0.29999999999999993s;-webkit-transform:rotate(270deg) translate(146%);-moz-transform:rotate(270deg) translate(146%);-ms-transform:rotate(270deg) translate(146%);transform:rotate(270deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-vl20np e3bks2o0"></div><style data-emotion="css 1qbghc9 animation-8013mu">.css-1qbghc9{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.19999999999999996s;animation-delay:-0.19999999999999996s;-webkit-transform:rotate(300deg) translate(146%);-moz-transform:rotate(300deg) translate(146%);-ms-transform:rotate(300deg) translate(146%);transform:rotate(300deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1qbghc9 e3bks2o0"></div><style data-emotion="css q9vvjz animation-8013mu">.css-q9vvjz{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.09999999999999987s;animation-delay:-0.09999999999999987s;-webkit-transform:rotate(330deg) translate(146%);-moz-transform:rotate(330deg) translate(146%);-ms-transform:rotate(330deg) translate(146%);transform:rotate(330deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-q9vvjz e3bks2o0"></div></div><div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-YLQTEB1PVV',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-YLQTEB1PVV', 'sungbin.kr', {"sampleRate":5,"siteSpeedSampleRate":10});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/스레드-풀과-Executor-프레임워크2/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-7b05682e3655fba37948.js"],"app":["/app-3fa8deb48819dbe669b2.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-761f28f8d0a06f05d514.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-56d5a7640e67e093d479.js"],"component---src-pages-posts-tsx":["/component---src-pages-posts-tsx-1ff6a41539a3b7a0f927.js"],"component---src-pages-resume-tsx":["/component---src-pages-resume-tsx-cbb5bfcf78b5294eadd4.js"],"component---src-template-post-tsx":["/component---src-template-post-tsx-7cd278bcc6c6bc262434.js"]};/*]]>*/</script><script src="/polyfill-7b05682e3655fba37948.js" nomodule=""></script><script src="/component---src-template-post-tsx-7cd278bcc6c6bc262434.js" async=""></script><script src="/386142cf738b86b246078cd67abf8098b07f27c7-c2f146ac4a2834844fc5.js" async=""></script><script src="/app-3fa8deb48819dbe669b2.js" async=""></script><script src="/48aa8186-67735c86ae4015d55662.js" async=""></script><script src="/1593e758-7868fce8d5ccd9520ad2.js" async=""></script><script src="/cc76255b-3222831408842f40a1cb.js" async=""></script><script src="/d0007318-557f95e6f5b855c64727.js" async=""></script><script src="/2425c7c2-8c4925ac74b0ebf7da0a.js" async=""></script><script src="/aec3edcd-33ff14c394bc1bedc44a.js" async=""></script><script src="/3e15977f-5148ca5d1a687341b4e3.js" async=""></script><script src="/f3fee096-8a3be85b266f9ba6922d.js" async=""></script><script src="/63a121f2-37023b2342386794d0fe.js" async=""></script><script src="/b633362c-429f9f687c864375c1ce.js" async=""></script><script src="/framework-96f35882fb1b7fa32ef9.js" async=""></script><script src="/webpack-runtime-0fe85aec75a31f0a2507.js" async=""></script></body></html>