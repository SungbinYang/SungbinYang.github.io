<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, minimal-ui"/><style data-href="/styles.06884e94fa8e7f768648.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}</style><meta name="generator" content="Gatsby 4.4.0"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="Sungbin&#x27;s Blog RSS Feed" href="/rss.xml"/><title data-react-helmet="true">[코루틴] 코루틴의 구성 요소와 원리 · Sungbin</title><meta data-react-helmet="true" name="description" content="양성빈의 블로그"/><meta data-react-helmet="true" name="image" content="https://sungbin.kr/static/04341d4252ddede34778002280a915f7/banner.png"/><meta data-react-helmet="true" property="og:url" content="https://sungbin.kr/coroutine-코루틴의-구성-요소와-원리/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="[코루틴] 코루틴의 구성 요소와 원리"/><meta data-react-helmet="true" property="og:description" content="양성빈의 블로그"/><meta data-react-helmet="true" property="og:image" content="https://sungbin.kr/static/04341d4252ddede34778002280a915f7/banner.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="[코루틴] 코루틴의 구성 요소와 원리"/><meta data-react-helmet="true" name="twitter:description" content="양성빈의 블로그"/><meta data-react-helmet="true" name="twitter:image" content="https://sungbin.kr/static/04341d4252ddede34778002280a915f7/banner.png"/><meta data-react-helmet="true" name="google-site-verification" content="1PmwbFiy4YMimCQ6EmhZyUp2c7m23NNnr5NQRRXwQzM"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>            
              (adsbygoogle = window.adsbygoogle || []).push({
                google_ad_client: "ca-pub-8854437638395695",
                enable_page_level_ads: true
              });
          </script><link rel="icon" href="/favicon-32x32.png?v=64afaa923d984d8eeb697e501bbca8ed" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="36x36" href="/favicons/android-icon-36x36.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="48x48" href="/favicons/android-icon-48x48.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="72x72" href="/favicons/android-icon-72x72.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="96x96" href="/favicons/android-icon-96x96.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="144x144" href="/favicons/android-icon-144x144.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link rel="apple-touch-icon" sizes="192x192" href="/favicons/android-icon-192x192.png?v=64afaa923d984d8eeb697e501bbca8ed"/><link as="script" rel="preload" href="/webpack-runtime-8bd3326d799737bed84d.js"/><link as="script" rel="preload" href="/framework-96f35882fb1b7fa32ef9.js"/><link as="script" rel="preload" href="/b633362c-429f9f687c864375c1ce.js"/><link as="script" rel="preload" href="/63a121f2-37023b2342386794d0fe.js"/><link as="script" rel="preload" href="/f3fee096-8a3be85b266f9ba6922d.js"/><link as="script" rel="preload" href="/3e15977f-5148ca5d1a687341b4e3.js"/><link as="script" rel="preload" href="/aec3edcd-33ff14c394bc1bedc44a.js"/><link as="script" rel="preload" href="/2425c7c2-8c4925ac74b0ebf7da0a.js"/><link as="script" rel="preload" href="/d0007318-557f95e6f5b855c64727.js"/><link as="script" rel="preload" href="/cc76255b-3222831408842f40a1cb.js"/><link as="script" rel="preload" href="/1593e758-7868fce8d5ccd9520ad2.js"/><link as="script" rel="preload" href="/48aa8186-67735c86ae4015d55662.js"/><link as="script" rel="preload" href="/app-3fa8deb48819dbe669b2.js"/><link as="script" rel="preload" href="/386142cf738b86b246078cd67abf8098b07f27c7-c2f146ac4a2834844fc5.js"/><link as="script" rel="preload" href="/component---src-template-post-tsx-7f5def86146fc29c9ead.js"/><link as="fetch" rel="preload" href="/page-data/coroutine-코루틴의-구성-요소와-원리/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2580406332.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3810308631.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><style data-emotion="css-global 19c91lz">@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');:root{--font-family:'Pretendard',-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;--code-font-family:Menlo,'DM Mono','Roboto Mono',Courier New,monospace;--scrollbar-background:#1e1e1e;--scrollbar-thumb:#666;--scrollbar-thumb-highlight:#9195F6;}html{font-size:16px;height:100%;overflow-x:hidden;overflow-y:scroll;-webkit-overflow-scrolling:touch;scrollbar-width:8px;scrollbar-color:var(--scrollbar-thumb-highlight) var(--scrollbar-background);}@media screen and (max-width: 1024px){html{font-size:14px;}}html::-webkit-scrollbar{background:var(--scrollbar-background);height:8px;width:8px;}html::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb-highlight);border-radius:0;}html,body{font-family:var(--font-family)!important;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;font-size:1rem;}div,article,section{box-sizing:border-box;}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:1rem;font:inherit;vertical-align:baseline;}label,input,button,a{-webkit-tap-highlight-color:transparent;}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block;}body{line-height:1;}ol,ul{list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none;}table{border-collapse:collapse;border-spacing:0;}string{font-weight:600!important;}</style><style data-emotion="css pyz3l8">.css-pyz3l8{-webkit-transition:opacity 0.2s ease;transition:opacity 0.2s ease;opacity:0;}</style><div class="css-pyz3l8 e1l8l1ek0"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><style data-emotion="css 1azakc">.css-1azakc{text-align:center;}</style><header class="css-1azakc ebd5ed87"><style data-emotion="css 1j1kikd">.css-1j1kikd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:900px;padding:2rem;margin-left:auto;margin-right:auto;}@media screen and (max-width: 1024px){.css-1j1kikd{padding:1.5rem 1rem;}}</style><div class="css-1j1kikd ebd5ed86"><style data-emotion="css 1cdt2kf">.css-1cdt2kf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;width:100%;padding:0 1.5rem;}.css-1cdt2kf>h1{text-align:left;}</style><div class="css-1cdt2kf ebd5ed81"><style data-emotion="css 1gw8sdl">.css-1gw8sdl{color:inherit;font-size:2.5rem;line-height:1.5;font-weight:800;}white-space:nowrap;strong,bold{font-weight:800;}</style><h1 size="40" class="css-1gw8sdl eye3s1s1">[코루틴] 코루틴의 구성 요소와 원리</h1><style data-emotion="css 1ixtmro">.css-1ixtmro{margin-left:calc(1.5rem - 1px);margin-top:calc(1.5rem - 1px);width:1px;height:1px;min-width:1px;min-height:1px;}</style><span x="1" y="1" class="css-1ixtmro ez28pf0"></span><style data-emotion="css lc9od6">.css-lc9od6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:1px;max-width:100%;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;box-sizing:border-box;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-lc9od6>*:not(:first-of-type){margin-left:calc(0.5 * 1rem);}</style><div wrap="wrap" class="css-lc9od6 e9vu7as0"><style data-emotion="css 9xks5q">.css-9xks5q{display:inline-block;vertical-align:middle;border-radius:16px;font-weight:500;line-height:1;cursor:inherit;font-feature-settings:tnum;font-variant:tabular-nums;text-transform:capitalize;white-space:nowrap;background:#000;color:#ffffff;border:1px solid #000;padding:3px 10px;font-size:1rem;}</style><span type="primary" class="css-9xks5q e1tg7sbi0">#<!-- -->kotlin</span></div><span x="1" y="1" class="css-1ixtmro ez28pf0"></span><style data-emotion="css 715507">.css-715507{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;}@media screen and (max-width: 1024px){.css-715507{-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}}</style><div class="css-715507 ebd5ed85"><style data-emotion="css 1u6n871">.css-1u6n871{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1u6n871 ebd5ed84"><style data-emotion="css zdebxm">.css-zdebxm{color:inherit;font-size:1rem;line-height:1.5;}white-space:nowrap;strong,bold{font-weight:800;}</style><span size="16" class="css-zdebxm eye3s1s1">Written by <a href="/">Sungbin</a></span><style data-emotion="css 69wa56">.css-69wa56{margin-left:calc(1.5rem - 1px);margin-top:calc(0.375rem - 1px);width:1px;height:1px;min-width:1px;min-height:1px;}</style><span x="1" y="0.25" class="css-69wa56 ez28pf0"></span><style data-emotion="css 4f3fw3">.css-4f3fw3{color:inherit;font-size:0.875rem;line-height:1.5;}white-space:nowrap;strong,bold{font-weight:800;}</style><span size="14" class="css-4f3fw3 eye3s1s1">2026년 2월 28일<!-- --> · <!-- -->13<!-- --> min read</span></div><style data-emotion="css 1yvy03y">.css-1yvy03y{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0.5rem;margin-bottom:1.5rem;}</style><div class="css-1yvy03y ebd5ed83"><style data-emotion="css 18zu07s">.css-18zu07s{position:relative;}.css-18zu07s:hover>div:last-of-type{opacity:1;}</style><div class="css-18zu07s emo2hur2"><style data-emotion="css cssveg">.css-cssveg{position:relative;}</style><div class="css-cssveg emo2hur1"><style data-emotion="css 7a8mbj">.css-7a8mbj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:30px;height:30px;outline:none;border:none;border-radius:15px;cursor:pointer;padding:0;background:#000;color:#ffffff;}</style><button class="css-7a8mbj ebd5ed82"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path></svg></button></div></div><div class="css-18zu07s emo2hur2"><div class="css-cssveg emo2hur1"><button class="css-7a8mbj ebd5ed82"><svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></button></div></div></div></div></div><span x="1" y="1" class="css-1ixtmro ez28pf0"></span><style data-emotion="css 1d3w5wq">.css-1d3w5wq{width:100%;}</style><div class="css-1d3w5wq ebd5ed80"><style data-emotion="css a1pnd7">.css-a1pnd7{text-align:left;border-top:1px solid #EAEAEA;border-bottom:1px solid #EAEAEA;padding:1.5rem;box-shadow:0 5px 10px rgba(0, 0, 0, 0.12);border-radius:5px;border:none;}</style><div class="css-a1pnd7 e1xjf9tq6"><style data-emotion="css b54kzr">.css-b54kzr{font-weight:600;font-size:1.25rem;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;margin-top:0;margin-bottom:0;}</style><h3 class="css-b54kzr e1xjf9tq5"><style data-emotion="css 16yxw0r">.css-16yxw0r{width:100%;margin-bottom:0;margin-top:0;border:unset;background:unset;padding:unset;margin:unset;font:unset;text-align:unset;-webkit-appearance:unset;-moz-appearance:unset;-ms-appearance:unset;appearance:unset;}</style><button class="css-16yxw0r e1xjf9tq3"><style data-emotion="css ml2823">.css-ml2823{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;cursor:pointer;vertical-align:baseline;padding:1.5rem 0;color:#000;}</style><span class="css-ml2823 e1xjf9tq2">코루틴<style data-emotion="css mzobh8">.css-mzobh8{-webkit-transition:-webkit-transform 0.2s ease;transition:transform 0.2s ease;-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg);}</style><span class="css-mzobh8 e1xjf9tq1"><svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M18 15l-6-6-6 6"></path></svg></span></span></button><style data-emotion="css 153tcrd">.css-153tcrd{font-size:0.75rem;font-weight:400;letter-spacing:normal;margin-bottom:0;display:block;color:#666;}</style><span class="css-153tcrd e1xjf9tq4">시리즈의 글 (2개)</span></h3><style data-emotion="css 10lbtih">.css-10lbtih{font-size:1rem;line-height:26px;overflow-y:hidden;will-change:height;-webkit-transition:height 0.2s ease;transition:height 0.2s ease;}.css-10lbtih>div{margin:1rem 0;}</style><div class="css-10lbtih e1xjf9tq0"><div><style data-emotion="css 6z6c3m">.css-6z6c3m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:relative;min-width:1px;max-width:100%;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-flex-basis:auto;-ms-flex-preferred-size:auto;flex-basis:auto;box-sizing:border-box;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}.css-6z6c3m>section,.css-6z6c3m>div,.css-6z6c3m>article,.css-6z6c3m>header,.css-6z6c3m>footer{gap:calc(1 * 1rem);}.css-6z6c3m:last-of-type{margin-bottom:0;}</style><div class="css-6z6c3m e9vu7as0"><style data-emotion="css 1o02nna">.css-1o02nna{padding-left:1.5rem;box-sizing:border-box;line-height:1.6;list-style:decimal;}</style><ol class="css-1o02nna e1k9d3a01"><style data-emotion="css zsnwin">.css-zsnwin{margin-bottom:0.5rem;}.css-zsnwin::marker{font-weight:600;color:#9195F6;}.css-zsnwin::after{content:'- 13분';margin-left:0.2rem;font-size:0.8rem;}.css-zsnwin>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-zsnwin>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-zsnwin e1k9d3a00"><span>[코루틴] 코루틴의 구성 요소와 원리</span></li><style data-emotion="css sym2eg">.css-sym2eg{margin-bottom:0.5rem;}.css-sym2eg::marker{font-weight:600;color:#9195F6;}.css-sym2eg::after{content:'- 15분';margin-left:0.2rem;font-size:0.8rem;}.css-sym2eg>span{cursor:pointer;border-bottom:2px solid #9195F6;font-weight:600;-webkit-text-decoration:none;text-decoration:none;color:#000;-webkit-transition:all 0.1s ease-out;transition:all 0.1s ease-out;}.css-sym2eg>span:hover{background:#9195F6;border-top:2px solid #9195F6;color:#ffffff;}</style><li class="css-sym2eg e1k9d3a00"><span>[코루틴] 코루틴 기초</span></li></ol></div></div></div></div></div></div></header><div><style data-emotion="css ifrico">.css-ifrico{width:100%;max-width:900px;padding:2rem;margin-left:auto;margin-right:auto;width:calc(100vw - 400px);}@media screen and (max-width: 1024px){.css-ifrico{padding:1rem;}}@media screen and (max-width: 1308px){.css-ifrico{width:calc(100vw - 408px);}}@media screen and (max-width: 1024px){.css-ifrico{width:calc(100vw - 8px);}}.css-ifrico p>img{width:100%;}.css-ifrico p{color:#111;font-weight:400;line-height:1.6;letter-spacing:-0.02rem;}.css-ifrico p,.css-ifrico table,.css-ifrico ul,.css-ifrico blockquote,.css-ifrico ol{font-size:1rem;margin:0 0 2rem;}.css-ifrico center{color:#666;font-size:0.8rem;font-weight:400;line-height:1.5;letter-spacing:-0.02rem;margin:0 0 2rem;}.css-ifrico p+center,.css-ifrico iframe+center{margin-top:-1rem;}.css-ifrico h1,.css-ifrico h2,.css-ifrico h3,.css-ifrico h4,.css-ifrico h5{position:relative;color:#000;line-height:1.2;scroll-margin-top:60px;letter-spacing:-0.02rem;font-weight:600;background:none;}.css-ifrico h1>a,.css-ifrico h2>a,.css-ifrico h3>a,.css-ifrico h4>a,.css-ifrico h5>a{color:#000;opacity:0;border:none;position:absolute;top:50%;left:0;-webkit-transform:translate(-100%, -50%);-moz-transform:translate(-100%, -50%);-ms-transform:translate(-100%, -50%);transform:translate(-100%, -50%);padding-right:4px;}.css-ifrico h1:hover>a,.css-ifrico h2:hover>a,.css-ifrico h3:hover>a,.css-ifrico h4:hover>a,.css-ifrico h5:hover>a{color:#000;background:none;border:none;opacity:1;}.css-ifrico h2:not(:first-of-type),.css-ifrico h3:not(:first-of-type),.css-ifrico h4:not(:first-of-type){margin-top:3rem;}.css-ifrico h1,.css-ifrico h2,.css-ifrico h3,.css-ifrico h4,.css-ifrico h5{margin:0 0 1.25rem;}.css-ifrico h1,.css-ifrico h2{font-size:1.8rem;-webkit-filter:brightness(1);filter:brightness(1);}.css-ifrico h3{font-size:1.4rem;-webkit-filter:brightness(1.3);filter:brightness(1.3);}.css-ifrico h4{-webkit-filter:brightness(1.5);filter:brightness(1.5);font-size:1.1rem;padding-bottom:0.25rem;text-transform:uppercase;}.css-ifrico ul,.css-ifrico ol{padding-left:1.5rem;box-sizing:border-box;line-height:1.6;}.css-ifrico ul ul,.css-ifrico ol ul{margin-top:8px;}.css-ifrico ul ul,.css-ifrico ol ul,.css-ifrico ul ol,.css-ifrico ol ol{margin-bottom:0;}.css-ifrico ul{list-style:disc;}.css-ifrico ol{list-style:decimal;}.css-ifrico ul li{margin-bottom:0.5rem;}.css-ifrico ul li::marker{font-weight:600;color:#9195F6;}.css-ifrico ol li{margin-bottom:0.5rem;}.css-ifrico ol li::marker{font-weight:600;color:#9195F6;}.css-ifrico li>a{white-space:inherit;word-wrap:break-word;}.css-ifrico li{color:#000;}.css-ifrico li code{font-weight:600;color:#9195F6;white-space:inherit;}.css-ifrico li code * span{white-space:inherit;}.css-ifrico li code * span:not([class='grvsc-source']){padding-left:0!important;}.css-ifrico iframe{margin-bottom:2rem;}.css-ifrico div[class*='markdown-wrapper']{font-size:0.9rem;-webkit-text-size-adjust:none;-moz-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none;margin:1rem -1rem;overflow-x:auto;overflow-y:hidden;box-sizing:border-box;scrollbar-width:8px;scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-background);}.css-ifrico div[class*='markdown-wrapper']::-webkit-scrollbar{background:var(--scrollbar-background);height:8px;width:8px;}.css-ifrico div[class*='markdown-wrapper']::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:0;}@media screen and (min-width: 1350px){.css-ifrico div[class*='markdown-wrapper']{margin-left:-3.5rem;margin-right:-3.5rem;margin-bottom:2rem;}}@media screen and (max-width: 1024px){.css-ifrico div[class*='markdown-wrapper']{padding-left:1rem;}}.css-ifrico pre{border-radius:0;float:left;margin-bottom:0;margin-top:0;min-width:calc(100% + 1rem);padding:1rem 1rem 1rem 0;-webkit-font-smoothing:subpixel-antialiased;overflow:initial;white-space:pre;font-family:var(--code-font-family);word-wrap:normal;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;tab-size:2;word-break:normal;word-spacing:normal;}.css-ifrico pre>code{font-weight:600;color:#9195F6;white-space:inherit;}.css-ifrico pre>code * span{white-space:inherit;}.css-ifrico pre>code * span:not([class='grvsc-source']){padding-left:0!important;}.css-ifrico .line-numbers-rows{padding-left:1em;padding-top:1em;}.css-ifrico p>code{font-weight:600;color:#9195F6;white-space:inherit;}.css-ifrico p>code * span{white-space:inherit;}.css-ifrico p>code * span:not([class='grvsc-source']){padding-left:0!important;}.css-ifrico img[class='gatsby-resp-image-image']{box-shadow:none!important;}.css-ifrico img[class='gatsby-resp-image-image'][alt]:after{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;top:0;left:0;width:100%;height:100%;background:#ffffff;font-weight:200;content:'이미지를 표시할 수 없어요. :(';}.css-ifrico blockquote{background:#EAEAEA;margin:0 -1rem;margin-bottom:2rem;padding:1rem 1rem;border-left:6px solid #9195F6;}.css-ifrico blockquote>p{margin-bottom:0;}@media screen and (min-width: 1350px){.css-ifrico blockquote{margin-left:-3.5rem;margin-right:-3.5rem;}}@media screen and (max-width: 1024px){.css-ifrico blockquote{padding-left:1rem;}}</style><section class="css-ifrico e17f2jor0"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 700px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0klEQVQoz2NY5bPjPzUxAzGKVnpvx8vHaSCKQl9MvNJrOxjDxbAYzoBu2AqPbf+Xu2/7v8xlKwS7gugtYPZq/51gvMx5y/+lzlv+r/DchmEoigtBBm1LPfT/aOu5/6cnXf5/ovvi/zOTr/w/2X8JzL84/yYYn5505f/5Wdf/b08/BHYAdi/7QgzcnnH4//GuC//Pz77+/3j3xf+nJ1/5f2HOdTAGiZ+ddhUsBjJ4S+IB3AaieNkN6k1XZC9vgYi7QoKCKC8TihQMjC9S6JoOSTEQAN1mISBmM6oCAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="banner"
        title="banner"
        src="/static/04341d4252ddede34778002280a915f7/8c557/banner.png"
        srcset="/static/04341d4252ddede34778002280a915f7/6f3f2/banner.png 256w,
/static/04341d4252ddede34778002280a915f7/01e7c/banner.png 512w,
/static/04341d4252ddede34778002280a915f7/8c557/banner.png 700w"
        sizes="(max-width: 700px) 100vw, 700px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<blockquote>
<p>해당 포스팅은 인프런의 <a href="https://inf.run/Rm45L">2시간으로 끝내는 코루틴</a> 강의를 참조하여 작성한 글입니다.</p>
</blockquote>
<h2>Structured Concurrency</h2>
<p>코루틴이 나타내는 Job의 life cycle에 대해 살펴보자. 코루틴이 생성되면 <code>NEW</code>상태가 되었다가 활성화되면 <code>ACTIVE</code>상태가 된다. 그러다가 예외가 되면 <code>CANCELING</code> 상태가 되었다가 <code>CANCELED</code> 상태로 돌아가며 만약 성공한다면 <code>COMPLETING</code> 상태가 되었다가 <code>COMPLETED</code>로 간다. 이때 주어진 작업이 완료된 코루틴은 <code>COMPLETED</code> 상태가 되는 것이 아니라 <code>COMPLETING</code> 상태로 처리되었다. 작업이 완료된 경우 <code>COMPLETED</code>가 되는 것이 아니라 왜 한 단계를 거쳐갈까?</p>
<p>그 이유는 자식 코루틴이 있을 경우, 자식 코루틴들이 모두 완료될 때까지 기다릴 수 있고, 자식 코루틴들 중 하나에서 예외가 발생하면 다른 자식 코루틴들에게도 취소 요청을 보내기 때문이다. 아래의 코드를 살펴보자.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> me<span class="token punctuation">.</span>sungbin<span class="token punctuation">.</span>coroutine

<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>delay
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>runBlocking

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Unit <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    launch <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">600L</span><span class="token punctuation">)</span>
        <span class="token function">printWithThread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"A"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    launch <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500L</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token function">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"코루틴 실패!"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>이 코드에서는 첫 번째 코루틴이 A를 출력하고 있고, 두 번째 코루틴이 예외를 던지고 있다. 두 코루틴은 독립적이기 때문에 예외도 발생하고 A도 출력될 것 같지만, 실제로는 예외만 발생되는 것을 확인할 수 있다. 그 이유는, 두 번째 코루틴에서 발생한 예외가 <code>runBlocking</code>에 의해 만들어진 부모 코루틴에게 취소 신호를 보내게 되고, 이 취소 신호를 받은 부모 코루틴이 다른 자식 코루틴인 첫 번째 코루틴까지 취소시키기 때문이다. 이렇게 부모 - 자식 관계의 코루틴이 한 몸 처럼 움직이는 것을 “Structured Concurrency”라고 부른다.</p>
<p>코틀린 공식 문서에서는 Structured Concurrency에 대해 다음과 같이 이야기하고 있다.</p>
<ul>
<li>Structured Concurrency는 수많은 코루틴이 유실되거나 누수되지 않도록 보장한다.</li>
<li>Structured Concurrency는 코드 내의 에러가 유실되지 않고 적절히 보고될 수 있도록 보장한다.</li>
</ul>
<p>그럼 내용을 정리해보자.</p>
<ul>
<li>자식 코루틴에서 예외가 발생할 경우, Structured Concurrency에 의해 부모 코루틴이 취소되고, 부모 코루틴의 다른 자식 코루틴들도 취소된다.</li>
<li>자식 코루틴에서 예외가 발생하지 않더라도 부모 코루틴이 취소되면, 자식 코루틴들이 취소된다.</li>
<li>다만 <code>CancellationException</code>의 경우 정상적인 취소로 간주하기 때문에 부모 코루틴에게 전파되지 않고, 부모 코루틴의 다른 자식 코루틴을 취소시키지도 않는다.</li>
</ul>
<h2>CoroutineScope과 CoroutineContext</h2>
<p>이번에는 <code>CoroutineScope</code>과 <code>CoroutineContext</code>에 대해 알아보자. 사실 <code>CoroutineScope</code>은 사용해본 경험이 존재한다. 바로 root 코루틴을 만들기 위해서, 새로운 영역을 만든 후 <code>launch</code>를 이용해 코루틴을 만들었던 것이다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">lec0701</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> job <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Default<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token function">printWithThread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Job 1"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    job<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>그렇다면, 이 <code>CoroutineScope</code>은 도대체 무엇일까? 사실 우리가 사용했던 <code>launch</code> 혹은 <code>async</code>와 같은 코루틴 빌더는 <code>CoroutineScope</code>의 확장함수이다. 즉, <code>launch</code>와 <code>async</code>를 사용하려면 <code>CoroutineScope</code>이 필요했던 것이다. 때문에 지금까지 사실은 <code>runBlocking</code>이 코루틴과 루틴의 세계를 이어주며, <code>CoroutineScope</code>를 제공해주었고, <code>runBlocking</code> 안에서 <code>launch</code>와 <code>async</code>를 사용했었다. 만약 우리가 직접 <code>CoroutineScope</code>을 만든다면 <code>runBlocking</code>이 굳이 필요하지 않다. main 함수를 일반 함수로 만들어 코루틴이 끝날 때까지 main 스레드를 대기시킬 수도 있고, main 함수 자체를 <code>suspend</code> 함수로 만들어 <code>join()</code> 시킬 수도 있다.</p>
<p>이 <code>CoroutineScope</code>의 주요 역할은 <code>CoroutineContext</code>라는 데이터를 보관하는 것이다. 실제 <code>CoroutineScope</code> 인터페이스 역시 매우 단순하다. <code>CoroutineContext</code>는 코루틴과 관련된 여러가지 데이터를 갖고 있다. 예를 들어 이 Context 안에는 현재 코루틴의 이름도 들어 있고, 우리가 살펴보았던 <code>CoroutineExceptionHandler</code>가 있을 수도 있으며, 코루틴의 Job 자체도 들어 있고, 우리가 <code>CoroutineScope</code>을 만들 때 넣어주었던 <code>CoroutineDispatcher</code>도 들어 있다. Dispatcher는 코루틴이 어떤 스레드에 배정될지를 관리하는 역할을 맡는다.</p>
<p>지금까지 내용을 정리해보면, <code>CoroutineScope</code>은 코루틴이 탄생할 수 있는 영역이고, <code>CoroutineScope</code> 안에는 <code>CoroutineContext</code>라는 코루틴과 관련된 데이터가 들어 있다. 우리가 부모 코루틴과 자식 코루틴이라고 불렀던 것도 한 영역 안에서 코루틴이 생기는것을 의미하는데 한번 자세히 살펴보자.</p>
<p>최초 한 영역에 부모 코루틴이 있다고 하자. 이때 <code>CoroutineContext</code>에는 이름, <code>Dispatchers.Default</code>, 부모 코루틴이 들어 있다. 이 상황에서 부모 코루틴에서 자식 코루틴을 만든다. 그럼 자식 코루틴은 부모 코루틴과 같은 영역에서 생성되고, 생성될 때 이 영역의 context를 가져온 다음 필요한 정보를 덮어 써 새로운 context를 만든다. 예를 들어 이름을 우리가 직접 지정해주었다고 하자. 그럼 자식 코루틴은 우리가 지정해준 이름을 이용해 필요한 데이터를 context에서 가져와 적절히 덮어 쓰고 새로운 context를 갖게 된다. 이 과정에서 부모 - 자식 간의 관계도 설정해준다. 이 원리가 바로 Structured Concurrency를 작동시킬 수 있는 기반이 된다.</p>
<p>그리고 이렇게 한 영역에 있는 코루틴들은 영역 자체를 <code>cancel()</code> 시킴으로써 모든 코루틴을 종료시킬 수 있다. 예를 들어 다음 코드처럼 클래스 내부에서 독립적인 <code>CoroutineScope</code>을 관리한다면, 해당 클래스에서 사용하던 코루틴을 한 번에 종료시킬 수 있게 된다. 아래의 코드를 보면 이해가 될 것이다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> me<span class="token punctuation">.</span>sungbin<span class="token punctuation">.</span>coroutine

<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>CoroutineScope
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>Dispatchers
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>cancel
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>launch

<span class="token keyword">class</span> AsyncLogic <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> scope <span class="token operator">=</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Default<span class="token punctuation">)</span>

    <span class="token keyword">fun</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scope<span class="token punctuation">.</span><span class="token function">launch</span> <span class="token punctuation">{</span>
            <span class="token comment">// 무언가 코루틴이 시작되어 작업</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scope<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>이제 <code>CoroutineContext</code>에 대해 조금 더 자세히 살펴보자. <code>CoroutineContext</code>는 <code>Map</code>과 <code>Set</code>을 섞어 둔 자료구조와 같다. <code>CoroutineContext</code>에 저장되는 데이터는 <code>key - value</code>로 이루어져 있고, <code>Set</code>과 비슷하게 동일한 <code>Key</code>를 가진 데이터는 하나만 존재할 수 있다. 이 key - value 하나하나를 Element라 부르고, + 기호를 이용해 각 Element를 합치거나 context에 Element를 추가할 수 있다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token comment">// + 기호를 이용한 Element 합성</span>
<span class="token function">CoroutineName</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"나만의 코루틴"</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">SupervisorJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// context에 Element를 추가</span>
coroutineContext <span class="token operator">+</span> <span class="token function">CoroutineName</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"나만의 코루틴"</span></span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>만약 context에서 Element를 제거하고 싶다면, <code>minusKey</code> 함수를 이용해 제거할 수 있다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin">coroutineContext<span class="token punctuation">.</span><span class="token function">minusKey</span><span class="token punctuation">(</span>CoroutineName<span class="token punctuation">.</span>Key<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div></div>
<p>마지막으로 context에 들어갈 수 있는 <code>Dispatcher</code>에 대해 조금 더 자세히 살펴보자. 코루틴이 스레드에 배정되어 실행된다고 살펴보았다. 또한 코루틴은 중단되었다가 다른 스레드에 배정될 수도 있는데, 이렇게 코루틴을 스레드에 배정하는 역할을 <code>Dispatcher</code>가 수행한다. Dispatcher의 대표적인 종류는 다음과 같다.</p>
<ul>
<li>Dispatchers.Default
<ul>
<li>가장 기본적인 디스패쳐. CPU 자원을 많이 쓸 때 권장되며 별 다른 설정이 없다면 <code>Dispatchers.Default</code>가 사용된다.</li>
</ul>
</li>
<li>Dispatchers.IO
<ul>
<li>I/O 작업에 최적화된 디스패처.</li>
</ul>
</li>
<li>Dispatchers.Main
<ul>
<li>보통 UI 컴포넌트를 조작하기 위한 디스패처. 특정 의존성을 가지고 있어야 정상적으로 활용할 수 있다.</li>
</ul>
</li>
<li>Java의 스레드풀인 ExecutorService를 디스패처로 변환
<ul>
<li><code>asCoroutineDispatcher()</code>이라는 확장함수를 이용해 <code>ExecutorService</code>를 디스패처로 전환할 수 있다.</li>
</ul>
</li>
</ul>
<h2>suspending function</h2>
<p>이번에는 suspending function과 scoping function에 대해 알아보자.</p>
<p>먼저, suspending function이란 우리가 지금까지 사용해왔던 것으로 suspend 지시어가 붙은 함수를 의미한다. 이렇게 들으면 굉장히 간단한데 suspend 지시어가 붙으면 무엇이 달라지는 것일까? 바로 suspend 함수를 부를 수 있는 능력이 생긴다. 그런데 가만히 생각해보면 우리는 main함수에서 suspend 함수를 불러도 큰 문제가 안 생겼다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Unit <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    launch <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>이 코드는 어떻게 가능한 것일까? 사실 우리가 사용한 runBlocking 코루틴 빌더나 launch 코루틴 빌더에서 다른 함수를 받을 때, 이 함수는 suspend 함수로 간주된다. 실제 launch의 시그니처에서도 suspend 함수를 받고 있다. 이렇게 함수 타입에 suspend를 붙인 것을 가리켜 <code>suspending lambda</code>라고 부른다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token comment">// launch의 시그니처, suspend 함수를 받고 있다.</span>
<span class="token keyword">public</span> <span class="token keyword">fun</span> CoroutineScope<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>
    context<span class="token operator">:</span> CoroutineContext <span class="token operator">=</span> EmptyCoroutineContext<span class="token punctuation">,</span>
    start<span class="token operator">:</span> CoroutineStart <span class="token operator">=</span> CoroutineStart<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">,</span>
    block<span class="token operator">:</span> <span class="token keyword">suspend</span> CoroutineScope<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> Unit
<span class="token punctuation">)</span><span class="token operator">:</span> Job</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>suspend 함수에서 또 다른 suspend 함수를 호출할 수 있다는 것을 알았다. 그 외에 또 다른 의미는 없을까? “suspend”라는 단어의 뜻을 사전에서 찾아보면, 정지 / 중지 / 유예와 같은 의미가 나온다. 실제 코루틴에서 사용하는 suspend 함수 역시 코루틴이 중지 되었다가 재개될 수 있는 지점이 된다. 이를 가리켜 <code>suspension point</code>라고 부른다. 여기서 핵심은 <strong>될 수 있는</strong> 이다. suspend 함수를 호출한다고 해서 무조건 중지되는 것이 아니다. 중지가 될 수도 있고, 중지가 되지 않을 수도 있다는 의미이다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">lec0801</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Unit <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    launch <span class="token punctuation">{</span>
        <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    launch <span class="token punctuation">{</span>
        <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printWithThread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"A"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printWithThread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"B"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printWithThread</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"C"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>첫 번째 코루틴에서는 suspend 함수인 <code>a()</code>와 <code>b()</code>를 각각 호출하고 있어서, <code>a()</code>가 호출된 다음 중지되어 두 번째 코루틴이 실행될 것 같지만, 사실은 suspend 함수를 호출하더라도 반드시 중지되는 것은 아니기에 A와 B가 먼저 출력되고 나중에 C가 출력되게 된다.</p>
<p>그렇다면 이런 suspend 함수는 어떻게 활용할 수 있을까? 연쇄적인 API를 호출해야 하는 상황이라고 생각해보자. 첫 번째 API 호출에서 나온 결과를 두 번째 API 호출 때 사용해야 한다. 그렇다면, 우리는 다음과 같이 코드를 작성할 수 있을 것이다. 원래 <code>Thread.sleep()</code>은 non blocking 상황에서 스레드 자체를 막을 수 있어 사용하면 안되지만, 1초간의 대기를 가정하기 위해 작성했다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">lec0802</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Unit <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token keyword">val</span> result1 <span class="token operator">=</span> async <span class="token punctuation">{</span>
        <span class="token function">call1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">val</span> result2 <span class="token operator">=</span> async <span class="token punctuation">{</span>
        <span class="token function">call2</span><span class="token punctuation">(</span>result1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">printWithThread</span><span class="token punctuation">(</span>result2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fun</span> <span class="token function">call1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">100</span>
<span class="token punctuation">}</span>
<span class="token keyword">fun</span> <span class="token function">call2</span><span class="token punctuation">(</span>num<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> num <span class="token operator">*</span> <span class="token number">2</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>우리는 <code>async</code>와 <code>Deferred</code>를 활용해 콜백을 활용하지 않고 코드를 작성했다. 하지만, <code>runBlocking</code> 입장에서 result1과 result2의 타입이 <code>Deferred</code>이기에 <code>Deffered</code>에 의존적인 코드가 되는 것은 아쉽다. <code>Deferred</code> 대신에 <code>CompletableFuture</code> 또는 <code>Reactor</code>와 같은 다른 비동기 라이브러리 코드로 갈아 끼워야 할 수도 있다. 이럴 때 우리는 suspend 함수를 활용할 수 있다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">lec0802</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Unit <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token keyword">val</span> result1 <span class="token operator">=</span> <span class="token function">call1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> result2 <span class="token operator">=</span> <span class="token function">call2</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span>

    <span class="token function">printWithThread</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">call1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">CoroutineScope</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Default<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">async</span> <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token number">100</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">call2</span><span class="token punctuation">(</span>num<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{</span>
    <span class="token keyword">return</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span> <span class="token punctuation">{</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        num <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>call1함수와 call2함수를 <code>suspend fun</code>으로 변경해 이 안에서 어떤 비동기 구현체 라이브러리를 사용하던지 해당 함수의 선택으로 남겨둔 것이다. <code>CompletabueFuture</code>에 사용한 <code>await()</code> 함수 역시 코루틴에서 만들어 둔 suspend 함수이다. 코루틴에는 다양한 비동기 라이브러리와 변환 코드를 제공한다.</p>
<p>그렇다면 코루틴 라이브러리에서 제공하는 suspend 함수를 몇 가지 살펴보자. 첫 번째 함수는 <code>coroutineScope</code>이다. 이 함수도 <code>launch</code>나 <code>async</code>처럼 새로운 코루틴을 만들지만, 주어진 함수 블록이 바로 실행되는 특징을 갖고 있다. 또한, 새로 생긴 코루틴과 자식 코루틴들이 모두 완료된 이후, 반환된다. coroutineScope으로 만든 코루틴은 이전 코루틴의 자식 코루틴이 된다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">calculateResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token operator">=</span> coroutineScope <span class="token punctuation">{</span>
    <span class="token keyword">val</span> num1 <span class="token operator">=</span> async <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token number">10</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> num2 <span class="token operator">=</span> async <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token number">20</span>
    <span class="token punctuation">}</span>

    num1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> num2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>다음으로 살펴볼 함수는 <code>withContext</code>이다. <code>withContext</code> 역시 주어진 코드 블록이 즉시 호출되며 새로운 코루틴이 만들어지고, 이 코루틴이 완전히 종료되어야 반환된다. 즉 기본적으로는 <code>coroutineScope</code>과 같다. 하지만 <code>withContext</code>를 사용할 때 context에 변화를 줄 수 있어 다음과 같이 Dispatcher를 바꿔 사용할 때 활용해볼 수 있다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">calculateResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>Default<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> num1 <span class="token operator">=</span> async <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token number">10</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">val</span> num2 <span class="token operator">=</span> async <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span>
        <span class="token number">20</span>
    <span class="token punctuation">}</span>

    num1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> num2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>마지막으로 <code>withTimeout</code>과 <code>withTimeoutOrNull</code>이 있다. 이 함수들 역시 coroutineScope과 유사하지만 주어진 함수 블록이 시간 내에 완료되어야 한다는 차이점이 있다. 주어진 시간 안에 코루틴이 완료되지 않으면 <code>withTimeout</code>은 <code>TimeoutCancellationException</code>을 던지게 되고, <code>withTimeoutOrNull</code>은 <code>null</code>을 반환하게 된다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
    <span class="token keyword">val</span> result<span class="token operator">:</span> Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">withTimeoutOrNull</span><span class="token punctuation">(</span><span class="token number">1_000L</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1_500L</span><span class="token punctuation">)</span>
        <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">20</span>
    <span class="token punctuation">}</span>

    <span class="token function">printWithThread</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<h2>코루틴과 Continuation</h2>
<p>이번에는 코루틴이 어떤 원리로 동작하고 있는지 구체적으로 알아보자. 코루틴의 동작 원리를 알아보기 위한 예제를 준비했다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">class</span> UserService <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userProfileRepository <span class="token operator">=</span> <span class="token function">UserProfileRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userImageRepository <span class="token operator">=</span> <span class="token function">UserImageRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"유저를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>

        <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>profile<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>
    <span class="token keyword">val</span> profile<span class="token operator">:</span> Profile<span class="token punctuation">,</span>
    <span class="token keyword">val</span> image<span class="token operator">:</span> Image<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">class</span> UserProfileRepository <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Profile <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Profile

<span class="token keyword">class</span> UserImageRepository <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token operator">:</span> Profile<span class="token punctuation">)</span><span class="token operator">:</span> Image <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Image</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>우리는 중단함수인 <code>findUser</code>가 어떻게 구현되는지 알아볼 것이다. 가장 먼저 findUser에서 중단 될 수 있는 지점을 확인해보자. suspend 함수의 의미는 “중단이 될 수 있다”는 의미이기에, suspend 함수를 호출하는 두 곳이 우리의 중단될 수 있는 지점이 된다. 이 지점을 경계로 메소드를 나누면 총 3단계로 나누어진다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
    <span class="token comment">// 0단계 - 초기 시작</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
    
    <span class="token comment">// 1단계 - 1차 중단 후 재시작</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span>
    
    <span class="token comment">// 2단계 - 2차 중단 후 재시작</span>
    <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>profile<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>이제 우리는 이 각 단계를 라벨로 표시할 것이다. 라벨을 표시하기 위해, 라벨 정보를 갖고있는 객체를 하나 만들어야 한다. 이 객체는 우선 인터페이스로 만들고, findUser 메소드 안에서 익명 클래스로 라벨을 갖고 있게 처리하겠다. 그럼 다음과 같은 코드로 변경된다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">interface</span> Continuation <span class="token punctuation">{</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div></div>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
    <span class="token comment">// state machine의 약자, 라벨을 기준으로 상태를 관리</span>
    <span class="token keyword">val</span> sm <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> Continuation <span class="token punctuation">{</span>
        <span class="token keyword">var</span> label <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 익명 클래스를 만들어 라벨을 갖게 만든다. 하므로 sm이라 이름 지었다.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">when</span> <span class="token punctuation">(</span>sm<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token number">2</span> <span class="token operator">-></span> <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>profile<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>이렇게까지 코드가 변경되면, 에러가 발생하기 시작한다. 가장 먼저 눈에 띄는 에러는 1번 라벨과 2번 라벨에서 profile, image를 가져올 수 없다는 에러이다. 이를 해결하기 위해 우리가 만들었던 sm에 profile과 image를 갖고 있게 하자. 그리고 해당 데이터가 필요한 순간에 sm에서 데이터를 꺼내 사용하게 변경하자.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
    <span class="token comment">// state machine의 약자, 라벨을 기준으로 상태를 관리</span>
    <span class="token keyword">val</span> sm <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> Continuation <span class="token punctuation">{</span>
        <span class="token keyword">var</span> label <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">var</span> profile<span class="token operator">:</span> Profile<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">var</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">when</span> <span class="token punctuation">(</span>sm<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token number">2</span> <span class="token operator">-></span> <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>profile<span class="token punctuation">,</span> image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>다음으로 이제 sm에 이 데이터를 갖고 있을 수 있게 처리해주어야 한다. 또한, 현재는 라벨이 0으로 고정되어 있으므로 중단 지점 직전에 label을 하나씩 올려주도록 하자.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
    <span class="token keyword">val</span> sm <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> Continuation <span class="token punctuation">{</span>
        <span class="token keyword">var</span> label <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">var</span> profile<span class="token operator">:</span> Profile<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">var</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">when</span> <span class="token punctuation">(</span>sm<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>profile <span class="token operator">=</span> profile
        <span class="token punctuation">}</span>

        <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token number">2</span>
            <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>image <span class="token operator">=</span> image
        <span class="token punctuation">}</span>

        <span class="token number">2</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">.</span>image<span class="token operator">!!</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>그러면 어떻게 1번 라벨과 2번 라벨이 호출되게 할 수 있을까? 현재는 <code>findUser</code>가 호출되면, sm 이라는 변수가 만들어지며 0번 라벨을 갖게 되고, <code>userProfileRepository.findProfile()</code>를 호출 직전 1번 라벨로 변경되긴 하지만, 그대로 함수가 종료되어 버린다. 이를 해결하기 위해, <code>suspend</code> 함수는 가장 마지막 매개변수로 <code>Continuation</code>을 받도록 변경할 것이다. 우리가 살펴보고 있는 <code>findUser</code> 중단 함수도 마찬가지이고, <code>findUser</code>에서 사용하고 있는 <code>findProfile</code>이나 <code>findImage</code>도 마찬가지이다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">class</span> UserImageRepository <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token operator">:</span> Profile<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token punctuation">)</span><span class="token operator">:</span> Image <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> UserProfileRepository <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token punctuation">)</span><span class="token operator">:</span> Profile <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> UserService <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userProfileRepository <span class="token operator">=</span> <span class="token function">UserProfileRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userImageRepository <span class="token operator">=</span> <span class="token function">UserImageRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
        <span class="token keyword">val</span> sm <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> Continuation <span class="token punctuation">{</span>
            <span class="token keyword">var</span> label <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">var</span> profile<span class="token operator">:</span> Profile<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token keyword">var</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">when</span> <span class="token punctuation">(</span>sm<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> sm<span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>profile <span class="token operator">=</span> profile
        <span class="token punctuation">}</span>
        <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token number">2</span>
            <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span>
            sm<span class="token punctuation">.</span>image <span class="token operator">=</span> image
        <span class="token punctuation">}</span>
        <span class="token number">2</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">.</span>image<span class="token operator">!!</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>그리고 이제 <code>Continuation</code>에 <code>resumeWith(data: Any?)</code>라는 함수를 하나 만들고, findUser에서 익명 클래스로 만든 sm에 <code>resumeWith</code>를 오버라이드 하도록 한다. 오버라이드된 <code>resumeWith</code>에서는 다시 한 번 findUser를 호출할 것이다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">interface</span> Continuation <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> UserService <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userProfileRepository <span class="token operator">=</span> <span class="token function">UserProfileRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userImageRepository <span class="token operator">=</span> <span class="token function">UserImageRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token function">FindUserContinuation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Continuation <span class="token punctuation">{</span>
        <span class="token keyword">var</span> label <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">var</span> profile<span class="token operator">:</span> Profile<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">var</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
        <span class="token keyword">val</span> sm <span class="token operator">=</span> continuation <span class="token keyword">as</span><span class="token operator">?</span> FindUserContinuation <span class="token operator">?:</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">FindUserContinuation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">when</span> <span class="token punctuation">(</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                        profile <span class="token operator">=</span> <span class="token keyword">data</span> <span class="token keyword">as</span> Profile
                        label <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token punctuation">}</span>

                    <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                        image <span class="token operator">=</span> <span class="token keyword">data</span> <span class="token keyword">as</span> Image
                        label <span class="token operator">=</span> <span class="token number">2</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">when</span> <span class="token punctuation">(</span>sm<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다"</span></span><span class="token punctuation">)</span>
                sm<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token number">1</span>
                <span class="token keyword">val</span> profile <span class="token operator">=</span> userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> sm<span class="token punctuation">)</span>
                sm<span class="token punctuation">.</span>profile <span class="token operator">=</span> profile
            <span class="token punctuation">}</span>

            <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다"</span></span><span class="token punctuation">)</span>
                sm<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token number">2</span>
                <span class="token keyword">val</span> image <span class="token operator">=</span> userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span>
                sm<span class="token punctuation">.</span>image <span class="token operator">=</span> image
            <span class="token punctuation">}</span>

            <span class="token number">2</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">.</span>image<span class="token operator">!!</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>자 그럼 이제 우리가 findUser에서 호출하는 또 다른 suspend 함수인 findProfile과 findImage에 넘겨준 이 Continuation 객체를 이용해 resumeWith를 호출한다면, 다음 라벨 영역의 코드가 호출되게 만들 수 있을 것이다. 이렇게 동작하기 위해서, findUser가 호출 될 때마다 sm을 새로 만들어주지 않고, 들어온 Continuation 객체의 타입에 따라 새로운 Continuation 객체를 만들도록 수정한다. 또한, Continuation의 resumeWith를 override한 함수에서 라벨과 데이터를 넣어주도록 수정한다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">package</span> me<span class="token punctuation">.</span>sungbin<span class="token punctuation">.</span>coroutine

<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>coroutines<span class="token punctuation">.</span>delay

<span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> userService <span class="token operator">=</span> <span class="token function">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">println</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">findUser</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> Continuation <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> UserService <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userProfileRepository <span class="token operator">=</span> <span class="token function">UserProfileRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> userImageRepository <span class="token operator">=</span> <span class="token function">UserImageRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token function">FindUserContinuation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Continuation <span class="token punctuation">{</span>
        <span class="token keyword">var</span> label <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">var</span> profile<span class="token operator">:</span> Profile<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">var</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> UserDto <span class="token punctuation">{</span>
        <span class="token keyword">val</span> sm <span class="token operator">=</span> continuation <span class="token keyword">as</span><span class="token operator">?</span> FindUserContinuation <span class="token operator">?:</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">FindUserContinuation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">when</span> <span class="token punctuation">(</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                        profile <span class="token operator">=</span> <span class="token keyword">data</span> <span class="token keyword">as</span> Profile
                        label <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token punctuation">}</span>

                    <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                        image <span class="token operator">=</span> <span class="token keyword">data</span> <span class="token keyword">as</span> Image
                        label <span class="token operator">=</span> <span class="token number">2</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token function">findUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">when</span> <span class="token punctuation">(</span>sm<span class="token punctuation">.</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token number">0</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                <span class="token comment">// 0단계 - 초기 시작</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"프로필을 가져오겠습니다."</span></span><span class="token punctuation">)</span>
                userProfileRepository<span class="token punctuation">.</span><span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> sm<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token number">1</span> <span class="token operator">-></span> <span class="token punctuation">{</span>
                <span class="token comment">// 1단계 - 1차 중단 후 재시작</span>
                <span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"이미지를 가져오겠습니다."</span></span><span class="token punctuation">)</span>
                userImageRepository<span class="token punctuation">.</span><span class="token function">findImage</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 2단계 - 2차 중단 후 재시작</span>
        <span class="token keyword">return</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>profile<span class="token operator">!!</span><span class="token punctuation">,</span> sm<span class="token punctuation">.</span>image<span class="token operator">!!</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">UserDto</span><span class="token punctuation">(</span>
    <span class="token keyword">val</span> profile<span class="token operator">:</span> Profile<span class="token punctuation">,</span>
    <span class="token keyword">val</span> image<span class="token operator">:</span> Image<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">class</span> UserProfileRepository <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findProfile</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> Long<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
        continuation<span class="token punctuation">.</span><span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> Profile

<span class="token keyword">class</span> Image

<span class="token keyword">class</span> UserImageRepository <span class="token punctuation">{</span>
    <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findImage</span><span class="token punctuation">(</span>profile<span class="token operator">:</span> Profile<span class="token punctuation">,</span> continuation<span class="token operator">:</span> Continuation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100L</span><span class="token punctuation">)</span>
        continuation<span class="token punctuation">.</span><span class="token function">resumeWith</span><span class="token punctuation">(</span><span class="token function">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div>
<p>이렇게 되면, 우리가 그림에서 살펴보았던 것처럼, Continuation 을 통해 최초 호출인지 아니면 callback 호출인지를 구분할 수 있게 되고, Continuation 의 구현 클래스에서 라벨과 전달할 데이터 등을 관리할 수 있게 된다. 이렇게 코루틴의 내부 동작 원리를 살펴보았다. 실제 우리가 최초 작성했던 간단한 findUser 함수는 컴파일을 하게 되면, 우리가 만들어봤던 Continuation을 사용한 Continuation Passing Style (CPS)로 변하게 된다. 실제 코루틴에서 사용되는 Continuation 인터페이스와 주요 함수는 다음과 같다.</p>
<div class="gatsby-highlight" data-language="kotlin"><div class="markdown-wrapper"><pre style="counter-reset: linenumber NaN" class="language-kotlin line-numbers"><code class="language-kotlin"><span class="token keyword">public</span> <span class="token keyword">interface</span> Continuation<span class="token operator">&lt;</span><span class="token keyword">in</span> T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">val</span> context<span class="token operator">:</span> CoroutineContext
    <span class="token keyword">public</span> <span class="token keyword">fun</span> <span class="token function">resumeWith</span><span class="token punctuation">(</span>result<span class="token operator">:</span> Result<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div></div></section></div><style data-emotion="css 1aem3cm">.css-1aem3cm{max-width:900px;width:100%;margin:0 auto;box-sizing:border-box;padding:0;}</style><div class="css-1aem3cm etanzsa0"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8854437638395695" data-ad-slot="5104795204" data-ad-format="auto" data-full-width-responsive="true"></ins></div><section id="comments"></section><style data-emotion="css 1ylimja">.css-1ylimja{max-width:900px;width:100%;margin:4rem auto;box-sizing:border-box;padding:2rem 2rem;border-top:1px solid #EAEAEA;}.css-1ylimja>p{margin-bottom:1.5rem;font-size:1.8rem;color:#000;}.css-1ylimja>a{border:none!important;outline:none!important;-webkit-transition:none!important;transition:none!important;background:none!important;}.css-1ylimja>a:hover{background:none!important;border-color:none!important;}</style><div class="css-1ylimja e1x2ajq20"><style data-emotion="css toutqs">.css-toutqs{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:50px;height:50px;}</style><div size="50" class="css-toutqs e3bks2o1"><style data-emotion="css 1rrjf5z animation-8013mu">.css-1rrjf5z{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-1.2s;animation-delay:-1.2s;-webkit-transform:rotate(0deg) translate(146%);-moz-transform:rotate(0deg) translate(146%);-ms-transform:rotate(0deg) translate(146%);transform:rotate(0deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1rrjf5z e3bks2o0"></div><style data-emotion="css rcjasa animation-8013mu">.css-rcjasa{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-1.0999999999999999s;animation-delay:-1.0999999999999999s;-webkit-transform:rotate(30deg) translate(146%);-moz-transform:rotate(30deg) translate(146%);-ms-transform:rotate(30deg) translate(146%);transform:rotate(30deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-rcjasa e3bks2o0"></div><style data-emotion="css 1gsjy2j animation-8013mu">.css-1gsjy2j{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-1s;animation-delay:-1s;-webkit-transform:rotate(60deg) translate(146%);-moz-transform:rotate(60deg) translate(146%);-ms-transform:rotate(60deg) translate(146%);transform:rotate(60deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1gsjy2j e3bks2o0"></div><style data-emotion="css vgd4ml animation-8013mu">.css-vgd4ml{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.8999999999999999s;animation-delay:-0.8999999999999999s;-webkit-transform:rotate(90deg) translate(146%);-moz-transform:rotate(90deg) translate(146%);-ms-transform:rotate(90deg) translate(146%);transform:rotate(90deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-vgd4ml e3bks2o0"></div><style data-emotion="css nlaijy animation-8013mu">.css-nlaijy{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.7999999999999999s;animation-delay:-0.7999999999999999s;-webkit-transform:rotate(120deg) translate(146%);-moz-transform:rotate(120deg) translate(146%);-ms-transform:rotate(120deg) translate(146%);transform:rotate(120deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-nlaijy e3bks2o0"></div><style data-emotion="css ljpo5z animation-8013mu">.css-ljpo5z{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.7s;animation-delay:-0.7s;-webkit-transform:rotate(150deg) translate(146%);-moz-transform:rotate(150deg) translate(146%);-ms-transform:rotate(150deg) translate(146%);transform:rotate(150deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-ljpo5z e3bks2o0"></div><style data-emotion="css 1lesjdn animation-8013mu">.css-1lesjdn{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.5999999999999999s;animation-delay:-0.5999999999999999s;-webkit-transform:rotate(180deg) translate(146%);-moz-transform:rotate(180deg) translate(146%);-ms-transform:rotate(180deg) translate(146%);transform:rotate(180deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1lesjdn e3bks2o0"></div><style data-emotion="css s8balg animation-8013mu">.css-s8balg{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.4999999999999999s;animation-delay:-0.4999999999999999s;-webkit-transform:rotate(210deg) translate(146%);-moz-transform:rotate(210deg) translate(146%);-ms-transform:rotate(210deg) translate(146%);transform:rotate(210deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-s8balg e3bks2o0"></div><style data-emotion="css q46j30 animation-8013mu">.css-q46j30{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.3999999999999999s;animation-delay:-0.3999999999999999s;-webkit-transform:rotate(240deg) translate(146%);-moz-transform:rotate(240deg) translate(146%);-ms-transform:rotate(240deg) translate(146%);transform:rotate(240deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-q46j30 e3bks2o0"></div><style data-emotion="css vl20np animation-8013mu">.css-vl20np{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.29999999999999993s;animation-delay:-0.29999999999999993s;-webkit-transform:rotate(270deg) translate(146%);-moz-transform:rotate(270deg) translate(146%);-ms-transform:rotate(270deg) translate(146%);transform:rotate(270deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-vl20np e3bks2o0"></div><style data-emotion="css 1qbghc9 animation-8013mu">.css-1qbghc9{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.19999999999999996s;animation-delay:-0.19999999999999996s;-webkit-transform:rotate(300deg) translate(146%);-moz-transform:rotate(300deg) translate(146%);-ms-transform:rotate(300deg) translate(146%);transform:rotate(300deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-1qbghc9 e3bks2o0"></div><style data-emotion="css q9vvjz animation-8013mu">.css-q9vvjz{-webkit-animation:animation-8013mu 1.2s linear infinite;animation:animation-8013mu 1.2s linear infinite;position:absolute;width:24%;height:8%;border-radius:5px;background:#333;-webkit-animation-delay:-0.09999999999999987s;animation-delay:-0.09999999999999987s;-webkit-transform:rotate(330deg) translate(146%);-moz-transform:rotate(330deg) translate(146%);-ms-transform:rotate(330deg) translate(146%);transform:rotate(330deg) translate(146%);}@-webkit-keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}@keyframes animation-8013mu{from{opacity:1;}to{opacity:0.15;}}</style><div class="css-q9vvjz e3bks2o0"></div></div><div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-YLQTEB1PVV',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-YLQTEB1PVV', 'sungbin.kr', {"sampleRate":5,"siteSpeedSampleRate":10});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/coroutine-코루틴의-구성-요소와-원리/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-7b05682e3655fba37948.js"],"app":["/app-3fa8deb48819dbe669b2.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-761f28f8d0a06f05d514.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-17ce83b7f594c2c0c1fe.js"],"component---src-pages-posts-tsx":["/component---src-pages-posts-tsx-1ff6a41539a3b7a0f927.js"],"component---src-pages-resume-tsx":["/component---src-pages-resume-tsx-2b2b484591700b0ae13f.js"],"component---src-template-post-tsx":["/component---src-template-post-tsx-7f5def86146fc29c9ead.js"]};/*]]>*/</script><script src="/polyfill-7b05682e3655fba37948.js" nomodule=""></script><script src="/component---src-template-post-tsx-7f5def86146fc29c9ead.js" async=""></script><script src="/386142cf738b86b246078cd67abf8098b07f27c7-c2f146ac4a2834844fc5.js" async=""></script><script src="/app-3fa8deb48819dbe669b2.js" async=""></script><script src="/48aa8186-67735c86ae4015d55662.js" async=""></script><script src="/1593e758-7868fce8d5ccd9520ad2.js" async=""></script><script src="/cc76255b-3222831408842f40a1cb.js" async=""></script><script src="/d0007318-557f95e6f5b855c64727.js" async=""></script><script src="/2425c7c2-8c4925ac74b0ebf7da0a.js" async=""></script><script src="/aec3edcd-33ff14c394bc1bedc44a.js" async=""></script><script src="/3e15977f-5148ca5d1a687341b4e3.js" async=""></script><script src="/f3fee096-8a3be85b266f9ba6922d.js" async=""></script><script src="/63a121f2-37023b2342386794d0fe.js" async=""></script><script src="/b633362c-429f9f687c864375c1ce.js" async=""></script><script src="/framework-96f35882fb1b7fa32ef9.js" async=""></script><script src="/webpack-runtime-8bd3326d799737bed84d.js" async=""></script></body></html>